<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <title>ERGO-S.A. for Office staff</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&family=Montserrat:wght=500;700&family=Noto+Sans+Thai:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      /* Global Styles */
      body {
        font-family: "Sarabun", sans-serif;
        margin: 0;
        padding: 0;
        background-color: #00040a;
      }
      /* Shake animation for error messages */
      @keyframes shake {
        0%,
        100% {
          transform: translateX(0);
        }
        10%,
        30%,
        50%,
        70%,
        90% {
          transform: translateX(-5px);
        }
        20%,
        40%,
        60%,
        80% {
          transform: translateX(5px);
        }
      }

      .fix-css-landing-container {
        background: #ffffffcc;
        backdrop-filter: blur(10px);
        border-radius: 20px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        padding: 3rem 2.5rem;
        max-width: 800px;
        width: 100%;
        text-align: center;
      }

      /* === Headings === */
      .fix-css-landing-container h1 {
        font-size: 2.2rem;
        color: #2c3e50;
        margin-bottom: 0.8rem;
      }

      .fix-css-description {
        font-size: 1.1rem;
        color: #555;
        margin-bottom: 2rem;
      }

      /* === Features Section === */
      .fix-css-features {
        display: flex;
        justify-content: space-around;
        flex-wrap: wrap;
        gap: 1.5rem;
        margin-bottom: 2.5rem;
      }

      .fix-css-feature {
        background: #f9fafc;
        border-radius: 15px;
        padding: 1.5rem;
        flex: 1 1 220px;
        transition: transform 0.25s ease, box-shadow 0.25s ease;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      }

      .fix-css-feature:hover {
        transform: translateY(-5px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
      }

      .fix-css-feature h3 {
        color: #0078d7;
        font-size: 1.3rem;
        margin-bottom: 0.5rem;
      }

      .fix-css-feature p {
        font-size: 1rem;
        color: #555;
      }

      /* === Navigation Tabs === */
      .fix-css-nav-tabs {
        display: flex;
        justify-content: center;
        gap: 1rem;
        flex-wrap: wrap;
      }

      .fix-css-nav-tab {
        background: #0078d7;
        color: #fff;
        border: none;
        border-radius: 25px;
        padding: 0.8rem 1.8rem;
        font-size: 1rem;
        cursor: pointer;
        transition: background 0.25s ease, transform 0.2s ease;
      }

      .fix-css-nav-tab:hover {
        background: #005ea6;
        transform: translateY(-2px);
      }

      .fix-css-nav-tab.fix-css-active {
        background: #0056b3;
      }

      /* === Responsive === */
      @media (max-width: 768px) {
        .fix-css-landing-container {
          padding: 2rem 1.5rem;
        }

        .fix-css-landing-container h1 {
          font-size: 1.8rem;
        }

        .fix-css-features {
          flex-direction: column;
          align-items: center;
        }

        .fix-css-feature {
          width: 90%;
        }

        .fix-css-nav-tab {
          width: 100%;
        }
      }

      .page {
        display: none;
      }

      .page.active {
        display: block;
      }

      .page.landing-page.active {
        display: flex;
      }

      .container {
        max-width: 1150px;
        margin: 0 auto;
        background: rgb(2, 0, 0);
        padding: 20px 24px 30px 24px;
        border-radius: 14px;
        box-shadow: 0 2px 16px rgba(0, 0, 0, 0.1);
        min-height: 95vh;
      }
      /* Landing Page Styles */
      .landing-page {
        background-image: url("https://cdn.pixabay.com/photo/2016/11/21/15/47/laptop-1842297_1280.jpg");
        background-size: cover;
        background-position: center;
        background-attachment: fixed;
        position: relative;
        min-height: 100vh;
        color: #070000;
        margin: 0;
        padding: 0;
      }

      .landing-page::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(149, 218, 245, 0.8);
        z-index: 0;
      }

      .landing-container {
        position: relative;
        z-index: 1;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        padding: 60px 20px;
        min-height: 100vh;
      }

      .landing-page h1 {
        font-size: 2.4rem;
        margin-bottom: 30px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
      }

      .description {
        font-size: 1.2rem;
        margin-bottom: 40px;
        max-width: 600px;
        line-height: 1.6;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
      }

      .features {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin: 40px 0;
        max-width: 800px;
      }

      .feature {
        background: rgba(255, 255, 255, 0.1);
        padding: 20px;
        border-radius: 10px;
        backdrop-filter: blur(10px);
      }

      .feature h3 {
        margin-top: 0;
        color: #030000;
      }

      .btn-enter {
        padding: 14px 32px;
        font-size: 1.1rem;
        font-weight: bold;
        color: #050000;
        background-color: #2196f3;
        border: none;
        border-radius: 10px;
        text-decoration: none;
        transition: background-color 0.3s, transform 0.2s;
        box-shadow: 0 4px 12px rgba(33, 150, 243, 0.4);
        cursor: pointer;
        display: inline-block;
        margin: 10px;
      }

      .btn-enter:hover {
        background-color: #0d47a1;
        transform: translateY(-2px);
      }
      /* Navigation Tabs */
      .nav-tabs {
        display: flex;
        background: #f8f9fa;
        border-radius: 10px;
        margin: 20px 0;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .nav-tab {
        flex: 1;
        padding: 15px 20px;
        background: #e9ecef;
        border: none;
        cursor: pointer;
        font-size: 1.1rem;
        font-weight: bold;
        color: #495057;
        transition: all 0.3s ease;
        border-right: 1px solid #dee2e6;
      }

      .nav-tab:last-child {
        border-right: none;
      }

      .nav-tab.active {
        background: #007bff;
        color: white;
        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .nav-tab:hover:not(.active) {
        background: #f8f9fa;
        color: #007bff;
      }
      /* Data Management Page Styles */
      .data-management-page .container {
        background-color: #f3f4f6;
        padding: 20px;
        max-width: 1200px;
      }

      .data-management-page h1 {
        color: #0077b6;
        text-align: center;
        margin-bottom: 30px;
        font-size: 2.2rem;
        letter-spacing: 1px;
      }

      .data-summary {
        background: white;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 30px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .summary-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
      }

      .stat-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      }

      .stat-number {
        font-size: 2.5rem;
        font-weight: bold;
        margin-bottom: 5px;
      }

      .stat-label {
        font-size: 1rem;
        opacity: 0.9;
      }

      .data-controls {
        background: white;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        align-items: center;
      }

      .search-container {
        flex: 1;
        min-width: 250px;
        position: relative;
      }

      .search-container input {
        width: 100%;
        padding: 10px 40px 10px 15px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 1rem;
      }

      .search-container i {
        position: absolute;
        right: 15px;
        top: 50%;
        transform: translateY(-50%);
        color: #777;
      }

      .filter-container {
        display: flex;
        gap: 10px;
        align-items: center;
      }

      .filter-container select {
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 1rem;
      }

      .action-buttons {
        display: flex;
        gap: 10px;
      }

      .btn-action {
        padding: 10px 20px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: bold;
        transition: all 0.3s ease;
      }

      .btn-export {
        background: #28a745;
        color: white;
      }

      .btn-export:hover {
        background: #218838;
      }

      .btn-clear {
        background: #dc3545;
        color: white;
      }

      .btn-clear:hover {
        background: #c82333;
      }

      .data-table-container {
        background: white;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        overflow-x: auto;
      }

      .data-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }

      .data-table th,
      .data-table td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #e9ecef;
      }

      .data-table th {
        background: #f8f9fa;
        font-weight: bold;
        color: #495057;
        position: sticky;
        top: 0;
      }

      .data-table tr {
        cursor: pointer;
        transition: background-color 0.2s;
      }

      .data-table tr:hover {
        background: #f8f9fa;
      }

      .risk-badge {
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: bold;
        text-align: center;
        display: inline-block;
        min-width: 60px;
      }

      .risk-low {
        background: #d4edda;
        color: #155724;
      }

      .risk-high {
        background: #f8d7da;
        color: #721c24;
      }

      .risk-medium {
        background: #fff3cd;
        color: #856404;
      }

      .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #6c757d;
      }

      .empty-state img {
        width: 120px;
        height: 120px;
        opacity: 0.5;
        margin-bottom: 20px;
      }

      .empty-state h3 {
        margin-bottom: 10px;
        color: #495057;
      }

      .empty-state p {
        margin-bottom: 20px;
        line-height: 1.6;
      }

      .pagination {
        display: flex;
        justify-content: center;
        margin-top: 20px;
        gap: 5px;
      }

      .pagination button {
        padding: 8px 12px;
        border: 1px solid #ddd;
        background: white;
        cursor: pointer;
        border-radius: 4px;
      }

      .pagination button:hover {
        background: #f8f9fa;
      }

      .pagination button.active {
        background: #007bff;
        color: white;
        border-color: #007bff;
      }

      .pagination button:disabled {
        cursor: not-allowed;
        opacity: 0.5;
      }

      /* Assessment Page Styles */
      .assessment-page .container {
        background-color: #f3f4f6;
        padding: 20px;
      }

      .assessment-page h1 {
        color: #0077b6;
        text-align: center;
        margin-bottom: 18px;
        font-size: 2.2rem;
        letter-spacing: 1px;
      }

      .section-title {
        background: linear-gradient(90deg, #ccffff 40%, #ccffcc 100%);
        padding: 10px 16px;
        font-weight: bold;
        font-size: 1.18rem;
        margin-top: 32px;
        margin-bottom: 14px;
        border-radius: 8px;
        color: #000000;
        text-align: left;
        border-left: 6px solid #99ccff;
        box-shadow: 1px 2px 5px #eaf6fa;
      }

      .section-title.section-a {
        background: linear-gradient(90deg, #fff59d 40%, #7fffd4 100%);
        border-left-color: #ffd700;
      }

      .section-title.section-b {
        background: linear-gradient(90deg, #ffccff 40%, #ffcc99 100%);
        border-left-color: #ff99cc;
      }

      .section-title.section-c {
        background: linear-gradient(90deg, #ccccff 40%, #ccffff 100%);
        border-left-color: #9933ff;
      }

      .section-title.section-duration {
        background: linear-gradient(90deg, #ffcc99 50%, #ffff66 100%);
        border-left-color: #d2691e;
        color: #8b4513;
      }

      table.rosa-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 18px;
        background: #fafcff;
      }

      .rosa-table.section-a {
        background: #f0fff0;
      }

      .rosa-table.section-b {
        background: #fff0f5;
      }

      .rosa-table.section-c {
        background: #e6e6fa;
      }

      .rosa-table th,
      .rosa-table td {
        border: 1px solid #000066;
        padding: 9px 8px;
        text-align: center;
        vertical-align: middle;
      }

      .rosa-table th {
        background: #99ccff;
        font-size: 1rem;
        color: #000000;
        letter-spacing: 0.5px;
      }

      .rosa-table.section-a th {
        background: #fffacd;
      }

      .rosa-table.section-b th {
        background: #ffe4b5;
      }

      .rosa-table.section-c th {
        background: #b3e5fc;
      }

      .rosa-table td img {
        max-width: 88px;
        max-height: 80px;
        border-radius: 8px;
        background: #fff;
        margin-bottom: 5px;
        border: 1.5px solid #e6e6e6;
      }

      .option-group {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 14px;
      }

      .option-group div {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin: 7px;
      }

      .option-group label {
        display: flex;
        align-items: center;
        margin-top: 5px;
        padding: 8px 12px;
        border-radius: 8px;
        border: 2px solid #000099;
        background: #fff;
        color: #000000;
        font-weight: bold;
        cursor: pointer;
        transition: background 0.2s, color 0.2s, border 0.2s;
        font-size: 0.98rem;
        min-width: 120px;
        min-height: 36px;
        text-align: center;
        justify-content: center;
      }

      .option-group input[type="checkbox"] {
        margin-right: 8px;
        transform: scale(1.2);
      }

      .option-group label:has(input:checked) {
        background: #71cdff;
        color: #fff;
        border: 2px solid #009bf5;
      }

      .option-btn {
        display: block;
        margin: 7px auto 0 auto;
        padding: 8px 18px;
        border-radius: 8px;
        border: 2px solid #000099;
        background: #fff;
        color: #000000;
        font-weight: bold;
        cursor: pointer;
        transition: background 0.2s, color 0.2s, border 0.2s;
        font-size: 0.98rem;
        min-width: 120px;
        min-height: 36px;
      }

      .option-btn.selected,
      .option-btn:focus {
        background: #71cdff;
        color: #fff;
        border: 2px solid #009bf5;
        outline: 0;
      }

      .score-box {
        font-size: 1.08rem;
        color: #ff6f00;
        font-weight: bold;
        margin: 10px 0;
        letter-spacing: 0.5px;
        text-align: right;
      }

      .total-score {
        font-size: 1.22rem;
        color: #0077b6;
        font-weight: bold;
        margin: 20px 0 8px 0;
        text-align: center;
      }

      .next-btn,
      .prev-btn {
        background-color: #00a878;
        color: white;
        font-weight: bold;
        font-size: 1rem;
        padding: 11px 30px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        margin: 18px 8px;
        transition: background 0.18s;
        letter-spacing: 1px;
      }

      .next-btn:hover,
      .prev-btn:hover {
        background: #079e71;
      }

      .prev-btn {
        background-color: #7b1fa2;
      }

      .prev-btn:hover {
        background: #68238b;
      }

      .navigation {
        text-align: center;
        margin: 20px 0;
      }

      .progress-bar {
        width: 100%;
        height: 8px;
        background: #e0e0e0;
        border-radius: 4px;
        margin: 20px 0;
        overflow: hidden;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #00a878, #0077b6);
        transition: width 0.3s ease;
        border-radius: 4px;
      }

      .form-row {
        margin-bottom: 15px;
        display: flex;
        flex-direction: column;
        align-items: flex-start;
      }

      .form-row label {
        font-weight: bold;
        color: #20435c;
        margin-right: 10px;
        font-size: 1rem;
      }

      .form-row input,
      .form-row select {
        padding: 6px;
        font-size: 1.1rem;
        border-radius: 6px;
        border: 1.5px solid #b6d5f1;
        text-align: center;
        background: #fafcff;
      }
      /* Summary Page Styles */
      .summary-page .container {
        max-width: 700px;
        background: #fff;
        padding: 28px 22px 36px 22px;
        border-radius: 13px;
        box-shadow: 0 2px 18px rgba(0, 0, 0, 0.13);
      }

      .summary-page h1 {
        color: #0077b6;
        text-align: center;
        margin-bottom: 23px;
        font-size: 2rem;
        letter-spacing: 1px;
      }

      .auto-result {
        background: #e8f4fd;
        border: 2px solid #0077b6;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 30px;
        text-align: center;
      }

      /* Risk Level Specific Styles */
      .auto-result.low-risk {
        background: #e8f5e8;
        border-color: #00a878;
      }

      .auto-result.high-risk {
        background: #ffeaea;
        border-color: #c62828;
      }

      .score-display {
        font-size: 2.5rem;
        font-weight: bold;
        color: #0077b6;
        margin: 15px 0;
      }

      .score-display.low-risk {
        color: #00a878;
      }

      .score-display.high-risk {
        color: #c62828;
      }

      .risk-display {
        font-size: 1.3rem;
        font-weight: bold;
        margin: 10px 0;
      }

      .breakdown {
        background: #f8fbfd;
        border: 1px solid #b6d5f1;
        border-radius: 8px;
        padding: 15px;
        margin: 20px 0;
      }

      .breakdown h3 {
        margin-top: 0;
        color: #0077b6;
      }

      .score-item {
        display: flex;
        justify-content: space-between;
        margin: 8px 0;
        padding: 5px 0;
        border-bottom: 1px solid #e0e0e0;
      }

      .btn {
        background-color: #00a878;
        color: white;
        font-weight: bold;
        font-size: 1rem;
        padding: 11px 34px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        margin: 30px auto 0 auto;
        display: block;
        transition: background 0.18s;
        letter-spacing: 1px;
      }

      .btn:hover {
        background: #079e71;
      }

      .actions {
        text-align: center;
        margin-top: 30px;
      }
      .hidden {
        display: none !important;
      }

      /* Success Message Styles */
      .success-message {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
        border-radius: 8px;
        padding: 15px;
        margin: 20px 0;
        text-align: center;
        font-weight: bold;
        animation: fadeIn 0.5s ease-in;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Pain Assessment Styles */
      .pain-gradient-title-box {
        background: linear-gradient(90deg, #ffcc99, #ff99cc);
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 20px;
        text-align: center;
      }

      .pain-gradient-title-box h2 {
        margin: 0;
        color: #333;
        font-size: 1.5rem;
      }

      .pain-instructions {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        border-left: 4px solid #007bff;
      }

      .pain-section {
        margin-bottom: 25px;
      }

      .pain-flex-img-table {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        align-items: flex-start;
      }

      .pain-body-img {
        max-width: 200px;
        border-radius: 8px;
        border: 1px solid #ddd;
      }

      .pain-assessment-table-container {
        flex: 1;
        min-width: 300px;
      }

      .pain-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.9rem;
      }

      .pain-table th,
      .pain-table td {
        border: 1px solid #ddd;
        padding: 6px;
        text-align: center;
      }

      .pain-table th {
        background-color: #f2f2f2;
        font-weight: bold;
      }

      .pain-severity-head {
        background-color: #fff3cd !important;
      }

      .pain-freq-head {
        background-color: #d1ecf1 !important;
      }

      .pain-severity-mild {
        background-color: #d4edda;
      }

      .pain-severity-mod {
        background-color: #fff3cd;
      }

      .pain-severity-severe {
        background-color: #f8d7da;
      }

      .pain-severity-extreme {
        background-color: #f5c6cb;
      }

      .pain-freq-1-2wk {
        background-color: #d1ecf1;
      }

      .pain-freq-3-4wk {
        background-color: #bee5eb;
      }

      .pain-freq-daily {
        background-color: #abdde5;
      }

      .pain-freq-often {
        background-color: #97d4e0;
      }

      .pain-note {
        background-color: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        border-left: 4px solid #ffc107;
        margin-bottom: 20px;
      }

      /* Stretching Page Styles */
      .stretching-page .container {
        background-color: #f9f9f9;
        padding: 20px;
        max-width: 1200px;
      }

      .stretching-page h1 {
        color: #0077b6;
        text-align: center;
        margin-bottom: 20px;
      }

      .poses-row {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        justify-content: center;
        margin-bottom: 30px;
      }

      .pose-card {
        width: 200px;
        background: white;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s;
      }

      .pose-card:hover {
        transform: translateY(-5px);
      }

      .pose-card img {
        width: 100%;
        height: 150px;
        object-fit: cover;
      }

      .pose-card div {
        padding: 15px;
        text-align: center;
        font-weight: bold;
      }

      .video-section {
        text-align: center;
        margin: 30px 0;
        padding: 20px;
        background: #f0f8ff;
        border-radius: 10px;
      }

      .note {
        background: #fff8e1;
        padding: 15px;
        border-radius: 8px;
        margin: 20px 0;
        border-left: 4px solid #ffc107;
      }

      .source-cite {
        font-size: 0.9rem;
        color: #666;
        margin-top: 20px;
        text-align: right;
      }

      .qr-section {
        text-align: center;
        margin: 30px 0;
        padding: 20px;
        background: #f5f5f5;
        border-radius: 10px;
      }

      .qr-info {
        margin-bottom: 20px;
      }

      .qr-img-wrap {
        display: flex;
        justify-content: center;
        margin-bottom: 20px;
      }

      .qr-img-box {
        width: 200px;
        height: 200px;
        border: 1px solid #ddd;
        padding: 10px;
        background: white;
        border-radius: 8px;
      }

      .qr-img-box img {
        width: 100%;
        height: 100%;
        object-fit: contain;
      }

      .qr-hint {
        font-size: 0.9rem;
        color: #666;
      }

      .btn-group {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-top: 30px;
      }

      .btn-secondary {
        background-color: #6c757d;
      }

      .btn-secondary:hover {
        background-color: #5a6268;
      }

      /* Ergonomic Recommendations Styles */
      .ergonomic-section {
        margin-bottom: 30px;
      }

      .ergonomic-section h2 {
        color: #0077b6;
        border-bottom: 2px solid #0077b6;
        padding-bottom: 5px;
        margin-bottom: 15px;
      }

      .custom-images {
        display: flex;
        justify-content: space-around;
        margin: 20px 0;
        flex-wrap: wrap;
      }

      .custom-images figure {
        text-align: center;
        margin: 0 10px 15px;
        width: 150px;
      }

      .custom-images img {
        width: 100%;
        height: auto;
        border-radius: 8px;
        border: 1px solid #ddd;
      }

      .custom-images figcaption {
        margin-top: 8px;
        font-size: 0.9rem;
        color: #555;
      }

      .recommendations {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        border-left: 4px solid #007bff;
      }

      .recommendations ul {
        padding-left: 20px;
      }

      .recommendations li {
        margin-bottom: 8px;
      }

      .risk-warning {
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
      }

      .risk-warning.high-risk {
        background-color: #f8d7da;
        border-left: 4px solid #dc3545;
      }

      .assessment-result-warning {
        font-weight: bold;
        margin-top: 10px;
      }

      .section-divider {
        height: 1px;
        background: #ddd;
        margin: 30px 0;
      }

      /* Pain Assessment Display Styles */
      .pain-assessment-display {
        background: #fff;
        border-radius: 12px;
        padding: 20px;
        margin: 20px 0;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        border: 1px solid #e0e0e0;
      }

      /* Pain Risk Summary Styles from pain-risk-summary.html */
      .pain-risk-summary {
        background: #fff2ee;
        border-left: 5px solid #ff6b35;
        margin-bottom: 18px;
        padding: 15px 18px 11px 15px;
        border-radius: 0 10px 10px 0;
        box-shadow: 0 1px 4px rgba(0, 0, 0, 0.04);
      }

      .risk-level-badge {
        display: inline-block;
        background: #c0392b;
        color: #fff;
        font-size: 1.05em;
        font-weight: bold;
        border-radius: 5px;
        padding: 3px 18px;
        margin-left: 10px;
        margin-right: 3px;
        vertical-align: middle;
        letter-spacing: 1px;
      }

      .top-risk-bodyparts {
        margin-top: 2px;
        font-size: 1.03em;
        color: #333;
      }

      .top-risk-bodyparts span {
        font-weight: bold;
        color: #c0392b;
        margin-right: 6px;
        letter-spacing: 1px;
      }

      .pain-assessment-display h3 {
        color: #ff6b35;
        margin: 0 0 20px 0;
        font-size: 1.3rem;
        text-align: center;
        border-bottom: 2px solid #ff6b35;
        padding-bottom: 10px;
      }

      .pain-score-value {
        font-size: 2.5rem;
        font-weight: bold;
        color: #ff6b35;
        text-align: center;
        margin: 20px 0;
        padding: 15px;
        background: #fff8f5;
        border-radius: 10px;
        border: 2px solid #ffe0d6;
      }

      .pain-score-table-container {
        margin: 20px 0;
        overflow-x: auto;
      }

      .pain-score-table {
        width: 100%;
        border-collapse: collapse;
        margin: 15px 0;
        background: white;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .pain-score-table th,
      .pain-score-table td {
        padding: 12px;
        text-align: center;
        border: 1px solid #ddd;
      }

      .pain-score-table thead tr {
        background-color: #ff6b35;
        color: white;
      }

      .pain-score-breakdown {
        margin-top: 20px;
      }

      .pain-score-section {
        background: #fff8f5;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 15px;
        border-left: 4px solid #ff6b35;
      }

      .pain-score-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin: 8px 0;
        padding: 5px 0;
        border-bottom: 1px solid #ffe0d6;
      }

      .pain-score-item:last-child {
        border-bottom: none;
      }

      .assessment-detail-card {
        background: #fff8f5;
        border-left: 4px solid #ff6b35;
        padding: 12px 15px;
        margin-bottom: 15px;
        border-radius: 0 8px 8px 0;
      }

      /* Modal Styles for Assessment Details */
      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.5);
      }

      .modal-content {
        background-color: #fefefe;
        margin: 5% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 90%;
        max-width: 800px;
        border-radius: 10px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        max-height: 85vh;
        overflow-y: auto;
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 1px solid #ddd;
      }

      .modal-title {
        font-size: 1.5rem;
        color: #0077b6;
        font-weight: bold;
      }

      .close {
        color: #aaa;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
      }

      .close:hover,
      .close:focus {
        color: black;
        text-decoration: none;
      }

      .modal-body {
        margin-bottom: 20px;
      }

      .modal-footer {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
        margin-top: 20px;
        padding-top: 10px;
        border-top: 1px solid #ddd;
      }

      .btn-detail {
        background-color: #007bff;
        color: white;
        padding: 6px 12px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.9rem;
        transition: background-color 0.3s;
      }

      .btn-detail:hover {
        background-color: #0056b3;
      }

      .btn-print {
        background-color: #28a745;
        color: white;
        padding: 6px 12px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.9rem;
        transition: background-color 0.3s;
      }

      .btn-print:hover {
        background-color: #1e7e34;
      }

      .assessment-info {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
      }

      .assessment-info h3 {
        margin-top: 0;
        color: #0077b6;
      }

      .info-row {
        display: flex;
        margin-bottom: 8px;
      }

      .info-label {
        font-weight: bold;
        width: 150px;
      }

      .info-value {
        flex: 1;
      }

      @media print {
        body * {
          visibility: hidden;
        }
        .modal,
        .modal * {
          visibility: visible;
        }
        .modal {
          position: static;
          width: 100%;
          height: auto;
          overflow: visible;
          background-color: white;
        }
        .modal-content {
          margin: 0;
          padding: 0;
          width: 100%;
          box-shadow: none;
          border: none;
          max-height: none;
        }
        .modal-header,
        .modal-footer {
          display: none;
        }
      }

      /* Responsive Design for Mobile and Tablet */
      @media screen and (max-width: 768px) {
        /* Container adjustments */
        .container {
          padding: 15px;
          margin: 0 10px;
          border-radius: 10px;
        }

        /* Landing page */
        .landing-page h1 {
          font-size: 1.8rem;
          margin-bottom: 20px;
        }

        .description {
          font-size: 1rem;
          margin-bottom: 30px;
        }

        .features {
          grid-template-columns: 1fr;
          gap: 15px;
          margin: 20px 0;
        }

        .btn-enter {
          padding: 12px 24px;
          font-size: 1rem;
          width: 100%;
          max-width: 300px;
        }

        /* Navigation tabs */
        .nav-tabs {
          flex-direction: column;
          margin: 15px 0;
        }

        .nav-tab {
          padding: 12px 15px;
          font-size: 1rem;
          border-right: none;
          border-bottom: 1px solid #dee2e6;
        }

        .nav-tab:last-child {
          border-bottom: none;
        }

        /* Assessment page */
        .assessment-page h1 {
          font-size: 1.6rem;
          margin-bottom: 15px;
        }

        .section-title {
          font-size: 1rem;
          padding: 8px 12px;
          margin-top: 20px;
          margin-bottom: 10px;
        }

        /* Tables */
        .rosa-table {
          font-size: 0.85rem;
        }

        .rosa-table th,
        .rosa-table td {
          padding: 6px 4px;
        }

        .rosa-table td img {
          max-width: 60px;
          max-height: 60px;
        }

        /* Option groups */
        .option-group {
          gap: 8px;
        }

        .option-group label {
          font-size: 0.85rem;
          padding: 6px 10px;
          min-width: 100px;
          min-height: 32px;
        }

        .option-btn {
          font-size: 0.85rem;
          padding: 6px 14px;
          min-width: 100px;
          min-height: 32px;
        }

        /* Buttons */
        .next-btn,
        .prev-btn {
          font-size: 0.9rem;
          padding: 10px 20px;
          margin: 12px 5px;
        }

        .btn {
          font-size: 0.9rem;
          padding: 10px 24px;
        }

        /* Summary page */
        .summary-page .container {
          max-width: 100%;
          padding: 20px 15px;
        }

        .summary-page h1 {
          font-size: 1.6rem;
          margin-bottom: 18px;
        }

        .score-display {
          font-size: 2rem;
        }

        .risk-display {
          font-size: 1.1rem;
        }

        /* Data management */
        .data-management-page h1 {
          font-size: 1.6rem;
          margin-bottom: 20px;
        }

        .summary-stats {
          grid-template-columns: 1fr;
          gap: 15px;
        }

        .stat-number {
          font-size: 2rem;
        }

        .data-controls {
          flex-direction: column;
          gap: 10px;
        }

        .search-container {
          width: 100%;
          min-width: auto;
        }

        .filter-container {
          width: 100%;
          flex-direction: column;
        }

        .filter-container select {
          width: 100%;
        }

        .action-buttons {
          width: 100%;
          flex-direction: column;
        }

        .btn-action {
          width: 100%;
        }

        .data-table-container {
          padding: 10px;
        }

        .data-table {
          font-size: 0.85rem;
        }

        .data-table th,
        .data-table td {
          padding: 8px 4px;
        }

        /* Pain assessment */
        .pain-flex-img-table {
          flex-direction: column;
        }

        .pain-body-img {
          max-width: 100%;
          margin: 0 auto 15px;
        }

        .pain-assessment-table-container {
          width: 100%;
          min-width: auto;
        }

        .pain-table {
          font-size: 0.8rem;
        }

        .pain-table th,
        .pain-table td {
          padding: 4px 2px;
        }

        /* Stretching page */
        .poses-row {
          gap: 15px;
        }

        .pose-card {
          width: 150px;
        }

        .pose-card img {
          height: 120px;
        }

        /* Form elements */
        .form-row {
          margin-bottom: 12px;
        }

        .form-row label {
          font-size: 0.9rem;
          margin-bottom: 5px;
        }

        .form-row input,
        .form-row select {
          font-size: 1rem;
          padding: 8px;
          width: 100%;
          max-width: 300px;
        }

        /* Modal */
        .modal-content {
          width: 95%;
          margin: 5% auto;
          padding: 15px;
        }

        .modal-header h2 {
          font-size: 1.3rem;
        }

        .modal-body {
          font-size: 0.9rem;
        }
      }

      @media screen and (max-width: 480px) {
        /* Extra small screens */
        .landing-page h1 {
          font-size: 1.5rem;
        }

        .description {
          font-size: 0.9rem;
        }

        .assessment-page h1,
        .summary-page h1,
        .data-management-page h1 {
          font-size: 1.4rem;
        }

        .section-title {
          font-size: 0.9rem;
          padding: 6px 10px;
        }

        .rosa-table {
          font-size: 0.75rem;
        }

        .rosa-table td img {
          max-width: 50px;
          max-height: 50px;
        }

        .option-group label {
          font-size: 0.75rem;
          padding: 5px 8px;
          min-width: 80px;
        }

        .option-btn {
          font-size: 0.75rem;
          padding: 5px 10px;
          min-width: 80px;
        }

        .score-display {
          font-size: 1.8rem;
        }

        .stat-number {
          font-size: 1.6rem;
        }

        .pose-card {
          width: 130px;
        }

        .pose-card img {
          height: 100px;
        }
      }
    </style>
  </head>
  <body>
    <!-- Landing Page -->
    <div class="page landing-page active" id="landingPage">
      <div class="landing-container">
        <h1>ME CHECK for Office staff</h1>
        <p class="description">ระบบจัดการข้อมูลการประเมินและส่งออกไฟล์ CSV</p>
        <div class="features">
          <div class="feature">
            <h3>ประเมินง่าย</h3>
            <p>ทำแบบประเมินได้ด้วยตนเองในเวลาอันสั้น</p>
          </div>
          <div class="feature">
            <h3>แม่นยำ</h3>
            <p>อ้างอิงจากหลักการยศาสตร์และงานวิจัย</p>
          </div>
          <div class="feature">
            <h3>คำแนะนำ</h3>
            <p>รับคำแนะนำเฉพาะบุคคลเพื่อปรับปรุง</p>
          </div>
        </div>
        <!-- Navigation Tabs -->
        <div class="nav-tabs">
          <button class="nav-tab active" id="assessmentTab">
            เริ่มการประเมิน
          </button>
          <button class="nav-tab" id="dataManagementTab">จัดการข้อมูล</button>
        </div>
      </div>
    </div>

    <!-- Assessment Page -->
    <div class="page assessment-page" id="assessmentPage">
      <div class="container">
        <h1>แบบประเมิน ROSA (Rapid Office Strain Assessment)</h1>
        <!-- Personal Information Section -->
        <div class="section-content" id="personalInfoContent">
          <div class="section-title">ข้อมูลส่วนบุคคล</div>
          <form autocomplete="off" id="personalInfoForm">
            <div class="form-row">
              <label for="age">อายุ:</label>
              <input
                id="age"
                max="100"
                min="1"
                name="age"
                placeholder="ปี"
                type="number"
              />
            </div>
            <div class="form-row">
              <label for="gender">เพศ:</label>
              <select id="gender" name="gender" style="width: 120px">
                <option value="">เลือกเพศ</option>
                <option value="male">ชาย</option>
                <option value="female">หญิง</option>
                <option value="other">อื่นๆ</option>
              </select>
            </div>
            <div class="form-row">
              <label for="jobDuration">อายุงาน:</label>
              <input
                id="jobDuration"
                name="jobDuration"
                placeholder="เช่น 5 ปี 3 เดือน"
                type="text"
              />
            </div>
            <div class="form-row">
              <label for="department">แผนก:</label>
              <input
                id="department"
                name="department"
                placeholder="เช่น ฝ่ายสนับสนุน"
                type="text"
              />
            </div>
            <div class="form-row">
              <label for="affiliation">สังกัด:</label>
              <input
                id="affiliation"
                name="affiliation"
                placeholder="เช่น คณะ"
                type="text"
              />
            </div>
          </form>
          <div style="text-align: center; margin-top: 20px">
            <button class="next-btn" id="startAssessmentBtn" type="button">
              เริ่มการประเมิน
            </button>
          </div>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" id="progressBarFill"></div>
        </div>
        <!-- User Guide Section -->
        <div
          class="section-content"
          id="userGuideContent"
          style="display: none"
        >
          <div class="section-title">
            คู่มือแนะนำการใช้งานโปรแกรม Me check for Office Staff
          </div>
          <div
            style="
              background: #f8fafc;
              padding: 20px;
              border-radius: 15px;
              margin: 20px 0;
            "
          >
            <div
              style="
                text-align: left;
                margin: 0.8em 0 1.5em 0;
                color: #444;
                font-size: 0.95em;
                font-weight: 500;
                line-height: 1.5;
              "
            >
              • รู้ระดับความเสี่ยงจากท่าทางการทำงาน<br />
              • ทราบอาการปวด/ชา/เมื่อยล้าที่เกิดขึ้น<br />
              • ได้รับคำแนะนำและท่าบริหารร่างกายเพื่อลดความเสี่ยง<br />
            </div>
            <div
              style="
                width: 100%;
                display: flex;
                justify-content: center;
                align-items: center;
                margin: 18px 0 22px 0;
              "
            >
              <img
                src="https://www.dropbox.com/scl/fi/mr0glv792a2upcijc67hr/_20251003_174334_0000.png?rlkey=bckpm2gwk08wzp6zyhjw0i9eo&st=gr4h7sjv&dl=1"
                alt="ภาพประกอบโปรแกรม Me check"
                loading="lazy"
                style="
                  max-width: 400px;
                  width: 100%;
                  height: auto;
                  border-radius: 16px;
                  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
                  border: 2.5px solid #e6eaef;
                  background: #f7f7f7;
                  display: block;
                  margin: 0 auto;
                  transition: box-shadow 0.15s;
                "
              />
            </div>
            <div
              style="
                margin-top: 2em;
                background: linear-gradient(90deg, #e7f7fa 80%, #e7eefa);
                padding: 15px 10px 14px 10px;
                border-radius: 13px;
                color: #f73636;
                font-size: 0.85em;
                font-weight: bold;
                text-align: center;
                line-height: 1.7;
                width: 100%;
                box-shadow: 0 2px 8px rgba(41, 128, 185, 0.07);
              "
            >
              - ควรตอบตามสภาพจริงเพื่อผลการประเมินที่ถูกต้อง<br />
              - ใช้ผลการประเมินเป็นแนวทางปรับปรุงท่าทางและสภาพการทำงาน<br />
              - หากอาการรุนแรงหรือมีอาการเรื้อรัง
              ควรปรึกษาผู้เชี่ยวชาญด้านสุขภาพ<br />
            </div>
          </div>
          <div style="text-align: center; margin-top: 20px">
            <button class="next-btn" id="fromGuideToSectionA" type="button">
              เริ่มการประเมิน
            </button>
          </div>
        </div>
        <div class="progress-bar"></div>
        <div class="progress-fill" id="progressBarFill"></div>

        <div class="section-content" id="sectionAContent" style="display: none">
          <div class="section-title section-a" id="titleA">
            SECTION A : เก้าอี้
          </div>
          <form id="sectionAForm" autocomplete="off">
            <table class="rosa-table section-a">
              <tr>
                <th>ความสูงของเก้าอี้</th>
                <th>คะแนน</th>
              </tr>
              <tr>
                <td>
                  <div class="option-group" id="seatHeightGroup">
                    <div>
                      <img
                        src="https://www.dropbox.com/scl/fi/92haw8lbm95qps627ufgw/file_0000000048d4622f8bdfbbd95900d620.png?rlkey=1et5560nua8yu9g590a2gee1j&st=0t4dn5ux&dl=1"
                        alt="พอดี"
                      />
                      <label
                        ><input
                          type="checkbox"
                          class="option-checkbox"
                          data-score="1"
                        />
                        เก้าอี้สูงพอเหมาะ (เข่าตั้งฉาก 90 องศา)</label
                      >
                    </div>
                    <div>
                      <img
                        src="https://www.dropbox.com/scl/fi/17ux0iysb0dm40076skaq/file_00000000729c622fbc94a646dd77d007.png?rlkey=odevll1zk9fgtzhg4ixw8s8nx&st=1d87oou6&dl=1"
                        alt="เตี้ยเกินไป"
                      />
                      <label
                        ><input
                          type="checkbox"
                          class="option-checkbox"
                          data-score="2"
                        />
                        เก้าอี้ต่ำเกินไป (มุมเข่า &lt;90 องศา)</label
                      >
                    </div>
                    <div>
                      <img
                        src="https://www.dropbox.com/scl/fi/efgv4lyplj3bratcp13hu/file_00000000ed2c622fb09082d7603abc39.png?rlkey=9bzesw2p0nkd4f29ey0n1bwhn&st=5eg8rfzl&dl=1"
                        alt="สูงเกินไป"
                      />
                      <label
                        ><input
                          type="checkbox"
                          class="option-checkbox"
                          data-score="2"
                        />
                        เก้าอี้สูงเกินไป (มุมเข่า &gt;90 องศา)</label
                      >
                    </div>
                    <div>
                      <img
                        src="https://www.dropbox.com/scl/fi/7jbt9k3en2iqvqvaevg0h/file_00000000f10c622fb2508ea42e2a18f1.png?rlkey=uxnnfycy6g3kq6tdgoy2k3y8r&st=0zuxth31&dl=1"
                        alt="เท้าลอย"
                      />
                      <label
                        ><input
                          type="checkbox"
                          class="option-checkbox"
                          data-score="3"
                        />
                        เก้าอี้สูงเกินไปเท้าไม่ถึงพื้น</label
                      >
                    </div>
                    <div>
                      <img
                        src="https://www.dropbox.com/scl/fi/c1114gv925h2n5xz3ic1t/file_000000009724622fa1bca31b3134d725.png?rlkey=8odkiexteykhmfind8snl5769&st=jixxbl4z&dl=1"
                        alt="พื้นที่ใต้โต๊ะคับแคบ"
                      />
                      <label
                        ><input
                          type="checkbox"
                          class="option-checkbox"
                          data-score="1"
                        />
                        พื้นที่ใต้โต๊ะคับแคบ ไม่สามารถไขว้ขาได้ (+1)</label
                      >
                    </div>
                    <div>
                      <label
                        ><input
                          type="checkbox"
                          class="option-checkbox"
                          data-score="1"
                        />
                        เก้าอี้ไม่สามารถปรับความสูงได้ (+1)</label
                      >
                    </div>
                  </div>
                </td>
                <td id="seatHeightScore">0</td>
              </tr>
              <tr>
                <th>ความลึกของเบาะนั่ง</th>
                <th>คะแนน</th>
              </tr>
              <tr>
                <td>
                  <div class="option-group" id="seatDepthGroup">
                    <div>
                      <img
                        src="https://www.dropbox.com/scl/fi/9mzwdf8in84w1lhdv77yz/file_000000006ea4622f8c9218a9af2c855d.png?rlkey=guvp144nz4nt7faj37iw761ct&st=jajls08h&dl=1"
                        alt="พอดี"
                      />
                      <label
                        ><input
                          type="checkbox"
                          class="option-checkbox"
                          data-score="1"
                        />
                        พอดี (ช่องว่างระหว่างข้อพับเข่ากับขอบเก้าอี้ 8
                        ซม.)</label
                      >
                    </div>
                    <div>
                      <img
                        src="https://www.dropbox.com/scl/fi/2svaxqt5aebyse9zit804/file_00000000cef861f5a16ceac2af2620eb.png?rlkey=guzz05q97ect9xc8wym0dgx94&st=sq7fg9fe&dl=1"
                        alt="ลึกเกินไป"
                      />
                      <label
                        ><input
                          type="checkbox"
                          class="option-checkbox"
                          data-score="2"
                        />
                        ยาวเกินไป (ช่องว่าง &lt;8 ซม.)</label
                      >
                    </div>
                    <div>
                      <img
                        src="https://www.dropbox.com/scl/fi/yo64nm9t8z9kb00nd42lo/file_000000007b8861f59812be14900615be.png?rlkey=t74scpmz2k9tjayqh7pwfha2f&st=13jd14sf&dl=1"
                        alt="ตื้นเกินไป"
                      />
                      <label
                        ><input
                          type="checkbox"
                          class="option-checkbox"
                          data-score="2"
                        />
                        สั้นเกินไป (ช่องว่าง &gt;8 ซม.)</label
                      >
                    </div>
                    <div>
                      <label
                        ><input
                          type="checkbox"
                          class="option-checkbox"
                          data-score="1"
                        />
                        ไม่สามารถปรับระยะระหว่างข้อพับเข่า และขอบที่นั่งได้
                        (+1)</label
                      >
                    </div>
                  </div>
                </td>
                <td id="seatDepthScore">0</td>
              </tr>
              <tr>
                <th>ที่รองแขน</th>
                <th>คะแนน</th>
              </tr>
              <tr>
                <td>
                  <div class="option-group" id="armrestGroup">
                    <div>
                      <img
                        src="https://www.dropbox.com/scl/fi/zgnbu2jtjpzuxhaax6cnj/file_000000004e6062309be8262daa2003d5.png?rlkey=wutgmkphbe7w8295jtttmmu01&st=90r29wk2&dl=1"
                        alt="รองรับข้อศอกดี"
                      />
                      <label
                        ><input
                          type="checkbox"
                          class="option-checkbox"
                          data-score="1"
                        />
                        มีที่รองแขนพอดีข้อศอก (ไหล่ดูผ่อนคลาย)</label
                      >
                    </div>
                    <div>
                      <img
                        src="https://www.dropbox.com/scl/fi/tyf94mfbcv8zjhb59ro6g/file_00000000131c61fb982cd2da2f4c78e1.png?rlkey=kyq6vftdib5umd7sd05hj13h9&st=3lsmyumy&dl=1"
                        alt="สูงหรือต่ำเกินไป"
                      />
                      <label
                        ><input
                          type="checkbox"
                          class="option-checkbox"
                          data-score="2"
                        />
                        มีที่รองแขนสูง-ไหล่ยกสูง /
                        ต่ำเกินไป-ไม่มีที่วางแขน</label
                      >
                    </div>
                    <div>
                      <img
                        src="https://www.dropbox.com/scl/fi/0nbakak65s3cwrksnmqmr/file_00000000c16461f8a76ff010cb668b37-1.png?rlkey=8uivyrl4541iixu8vx04z7hrz&st=pfcehpne&dl=1"
                        alt="ที่วางแขนแข็ง"
                      />
                      <label
                        ><input
                          type="checkbox"
                          class="option-checkbox"
                          data-score="1"
                        />
                        ที่วางแขนแข็ง/พื้นผิวเสียหาย (+1)</label
                      >
                    </div>
                    <div>
                      <img
                        src="https://www.dropbox.com/scl/fi/cbag4pskmkzufnv6j9utl/file_000000006d006230bca9f31c12a9ed14.png?rlkey=t8pwxcozusad2c43wctnodmpo&st=hrdgn3om&dl=1"
                        alt="ห่างลำตัว"
                      />
                      <label
                        ><input
                          type="checkbox"
                          class="option-checkbox"
                          data-score="1"
                        />
                        ที่วางแขนกว้างเกินไป (+1)</label
                      >
                    </div>
                    <div>
                      <label
                        ><input
                          type="checkbox"
                          class="option-checkbox"
                          data-score="1"
                        />
                        ที่วางแขนปรับระดับไม่ได้ (+1)</label
                      >
                    </div>
                  </div>
                </td>
                <td id="armrestScore">0</td>
              </tr>
              <tr>
                <th>พนักพิง</th>
                <th>คะแนน</th>
              </tr>
              <tr>
                <td>
                  <div class="option-group" id="backrestGroup">
                    <div>
                      <img
                        src="https://www.dropbox.com/scl/fi/rxm1vwomfzfyojhhgplwk/file_00000000a89861f590fe210ab30d5057.png?rlkey=mfxvrqcuskjb8b14hof4ytxqi&st=g71l6yh4&dl=1"
                        alt="รองรับหลังดี"
                      />
                      <label
                        ><input
                          type="checkbox"
                          class="option-checkbox"
                          data-score="1"
                        />
                        พนักพิงเหมาะสม มีที่รองเอว-พนักเก้าอี้ปรับเอนได้ 95-110
                        องศา</label
                      >
                    </div>
                    <div>
                      <img
                        src="https://www.dropbox.com/scl/fi/2svaxqt5aebyse9zit804/file_00000000cef861f5a16ceac2af2620eb.png?rlkey=guzz05q97ect9xc8wym0dgx94&st=ghwrjqc1&dl=1"
                        alt="รองรับหลังไม่ดี"
                      />
                      <label
                        ><input
                          type="checkbox"
                          class="option-checkbox"
                          data-score="2"
                        />
                        ไม่มีที่รองเอว/ที่รองเอวไม่โค้งรับกับหลัง</label
                      >
                    </div>
                    <div>
                      <img
                        src="https://www.dropbox.com/scl/fi/feu3it7vhfvekmyxjpvpz/file_00000000e9a061f5954c8085ab864b8e.png?rlkey=iuvbscsxb7dd1zsjmtbl7mgke&st=ynulcl94&dl=1"
                        alt="เอนไม่เหมาะสม"
                      />
                      <label
                        ><input
                          type="checkbox"
                          class="option-checkbox"
                          data-score="2"
                        />
                        พนักเก้าอี้เอนปรับได้ &lt;95 หรือ &gt;110 องศา</label
                      >
                    </div>
                    <div>
                      <img
                        src="https://www.dropbox.com/scl/fi/o8wjm0iap7cmhjk6qsu59/file_0000000017f0622fb5ca95ddd222a83b.png?rlkey=7y4b4h77utim3gqtn9uz8ld45&st=wule7gct&dl=1"
                        alt="ไม่มีพนักพิง"
                      />
                      <label
                        ><input
                          type="checkbox"
                          class="option-checkbox"
                          data-score="2"
                        />
                        ไม่มีพนักพิง/นั่งเอนตัวไปข้างหน้า</label
                      >
                    </div>
                    <div>
                      <img
                        src="https://www.dropbox.com/scl/fi/ujqc1179ie5w5lf03q97x/file_00000000845461f881b37a5343d8d52d.png?rlkey=q07l34jpmfnvsm238ekpx6awg&st=q8o9naww&dl=1"
                        alt="พื้นที่ทำงานสูงเกินไป"
                      />
                      <label
                        ><input
                          type="checkbox"
                          class="option-checkbox"
                          data-score="1"
                        />
                        พื้นโต๊ะทำงานสูงเกินไป (ไหล่ยก) (+1)</label
                      >
                    </div>
                    <div>
                      <label
                        ><input
                          type="checkbox"
                          class="option-checkbox"
                          data-score="1"
                        />
                        พนักพิงปรับระดับไม่ได้ (+1)</label
                      >
                    </div>
                  </div>
                </td>
                <td id="backrestScore">0</td>
              </tr>
            </table>
            <div class="score-box" id="totalScoreA">คะแนนรวม Section A: 0</div>
          </form>
          <div style="text-align: center">
            <button type="button" class="prev-btn" id="backToUserGuideSection">
              ย้อนกลับ คู่มือแนะนำการใช้งานโปรแกรม
            </button>
            <button type="button" class="next-btn" id="toSectionB">
              ไป Section B
            </button>
          </div>
        </div>
        <div class="section-content" id="sectionBContent" style="display: none">
          <div class="section-title section-b" id="titleB">
            SECTION B : หน้าจอและโทรศัพท์
          </div>
          <form autocomplete="off" id="sectionBForm">
            <table class="rosa-table section-b">
              <tr>
                <th>หน้าจอ</th>
                <th>คะแนน</th>
              </tr>
              <tr>
                <td>
                  <div class="option-group" id="monitorGroup">
                    <div>
                      <img
                        src="https://www.dropbox.com/scl/fi/017wjo3x6qp1xxcc8xjhn/file_0000000001586230bb09b9d52344bfbf.png?rlkey=7hzqvqj6c9nwku8bjc3677rcl&st=hu6khsc1&dl=1"
                        alt="หน้าจออยู่ระดับสายตา(ห่างระช่วงแขน 40-75ซม.)"
                      />
                      <label
                        ><input
                          type="checkbox"
                          class="option-checkbox"
                          data-score="1"
                        />
                        หน้าจออยู่ระดับสายตา (ห่างประมาณความยาวแขน 40-75
                        ซม.)</label
                      >
                    </div>
                    <div>
                      <img
                        src="https://www.dropbox.com/scl/fi/xgemat4k1z1s7h7688skg/file_0000000012d86230be0a08751b038585.png?rlkey=bh98qrq9dyz4w6j6eis31zm8x&st=amjrvjkd&dl=1"
                        alt="ต่ำเกินไป/อยู่ไกลเกินไป(>30องศา)"
                      />
                      <label
                        ><input
                          type="checkbox"
                          class="option-checkbox"
                          data-score="2"
                        />
                        หน้าจอต่ำเกินไป (ต้องก้มคอเพื่อมองจอ)</label
                      >
                    </div>
                    <div>
                      <img
                        src="https://www.dropbox.com/scl/fi/zh45396uym1tfda7xy8qq/file_00000000235c61f8997c2da3c4a9c62c.png?rlkey=7w2vby9ljucs9uwn47ig8e8ig&st=t4gusl81&dl=1"
                        alt="สูงเกินไป"
                      />
                      <label
                        ><input
                          type="checkbox"
                          class="option-checkbox"
                          data-score="3"
                        />
                        หน้าจอสูงเกินไป (ต้องแหงนคอเพื่อมองจอ)</label
                      >
                    </div>
                    <div>
                      <img
                        src="https://www.dropbox.com/scl/fi/1lox2ytwnm2abfxfshahp/file_00000000589061f8ae5201cc60da6af5.png?rlkey=qim2m33diuxk6w9dzo6fcwqkh&st=r9kdv41c&dl=1"
                        alt="เอี้ยวคอมากกว่า 30 องศา"
                      />
                      <label
                        ><input
                          type="checkbox"
                          class="option-checkbox"
                          data-score="1"
                        />
                        ผู้ใช้ต้องหมุนคอเพื่อมองจอ (+1)</label
                      >
                    </div>
                    <div>
                      <img
                        src="https://www.dropbox.com/scl/fi/efcbg8ik28a182j0gr3dl/file_00000000611c61f8bbe1d9d9372a031d.png?rlkey=etot61qj8p0obizbngen2tbai&st=w0ksgm75&dl=1"
                        alt="จอภาพมีแสงจ้า"
                      />
                      <label
                        ><input
                          type="checkbox"
                          class="option-checkbox"
                          data-score="1"
                        />
                        มีแสงสะท้อนบนจอ (+1)</label
                      >
                    </div>
                    <div>
                      <img
                        src="https://www.dropbox.com/scl/fi/fj6xgmgaaiyko7xs6zmlr/file_00000000d96861f8a5e78264e7a56d39-1.png?rlkey=rwvflsteligt1zn07y6kluka7&st=skctcmg5&dl=1"
                        alt="ไม่มีที่จับ/วางเอกสาร"
                      />
                      <label
                        ><input
                          type="checkbox"
                          class="option-checkbox"
                          data-score="1"
                        />
                        ไม่มีที่จับ/วางเอกสาร(+1)</label
                      >
                    </div>
                  </div>
                </td>
                <td id="monitorScore">0</td>
              </tr>
              <tr>
                <th>โทรศัพท์</th>
                <th>คะแนน</th>
              </tr>
              <tr>
                <td>
                  <div class="option-group" id="phoneGroup">
                    <div>
                      <img
                        src="https://www.dropbox.com/scl/fi/wizyzwxsyt0qhnobgg0v3/file_0000000009b86230bdd0147ce1467ab2.png?rlkey=rj9w2imja6mldkecd14rj6i78&st=lnhqh69s&dl=1"
                        alt="ใช้ชุดหูฟัง/ใช้โทรศัพท์มือถือข้างเดียว คอไม่เอียง"
                      />
                      <label
                        ><input
                          type="checkbox"
                          class="option-checkbox"
                          data-score="1"
                        />
                        ใช้ชุดหูฟัง/ใช้โทรศัพท์มือถือข้างเดียว คอไม่เอียง</label
                      >
                    </div>
                    <div>
                      <img
                        src="https://www.dropbox.com/scl/fi/7t8ecfu41cn9eol7cj0cd/file_000000008ae061f681837ce39e3b5c5d.png?rlkey=uxhg0or9gdc6pbfnu8bos0wt4&st=abo53m3d&dl=1"
                        alt="อยู่ไกลเกินเอื้อม(อยู่นอกระยะเอื้อม 30 ซม.)"
                      />
                      <label
                        ><input
                          type="checkbox"
                          class="option-checkbox"
                          data-score="2"
                        />
                        อยู่ไกลเกินเอื้อม(อยู่นอกระยะเอื้อม 30 ซม.)</label
                      >
                    </div>
                    <div>
                      <img
                        src="https://www.dropbox.com/scl/fi/0y98yk19kx9sjzyp47ua6/file_00000000a27861f4bb8e4608d9d87047.png?rlkey=ynat6cpbn7btym5krx88ub05u&st=3uyqmy54&dl=1"
                        alt="ใช้คอและไหล่ถือโทรศัพท์"
                      />
                      <label
                        ><input
                          type="checkbox"
                          class="option-checkbox"
                          data-score="2"
                        />
                        ใช้คอและไหล่ถือโทรศัพท์ (+2)</label
                      >
                    </div>
                    <div>
                      <label
                        ><input
                          type="checkbox"
                          class="option-checkbox"
                          data-score="1"
                        />
                        ไม่มีชุดหูฟังให้เลือกใช้ (+1)</label
                      >
                    </div>
                  </div>
                </td>
                <td id="phoneScore">0</td>
              </tr>
            </table>
            <div class="score-box" id="totalScoreB">คะแนนรวม Section B : 0</div>
          </form>
          <div style="text-align: center">
            <button class="prev-btn" id="backToSectionA" type="button">
              ย้อนกลับ Section A
            </button>
            <button class="next-btn" id="toSectionC" type="button">
              ไป Section C
            </button>
          </div>
        </div>
        <div class="section-content" id="sectionCContent" style="display: none">
          <div class="section-title section-c" id="titleC">
            SECTION C : เมาส์และแป้นพิมพ์
          </div>
          <form autocomplete="off" id="sectionCForm">
            <table class="rosa-table section-c">
              <tr>
                <th>เมาส์</th>
                <th>คะแนน</th>
              </tr>
              <tr>
                <td>
                  <div class="option-group" id="mouseGroup">
                    <div>
                      <img
                        src="https://www.dropbox.com/scl/fi/h5f3xugniirur98o1mbys/file_000000008e04622fb5c3ebfdcd4e8789.png?rlkey=ma3awkh6cvmkou2yvqge9iqoj&st=mtlga9qd&dl=1"
                        alt="เมาส์อยู่ในแนวเดียวกับไหล่"
                      />
                      <label
                        ><input
                          type="checkbox"
                          class="option-checkbox"
                          data-score="1"
                        />
                        เมาส์อยู่ในแนวเดียวกับไหล่</label
                      >
                    </div>
                    <div>
                      <img
                        src="https://www.dropbox.com/scl/fi/vmriaxe8qwp71sdgq13qo/file_00000000072461fd975225d5a4ba5fb6.png?rlkey=58039tccye70pjlsd6jlqe0ss&st=nbfo6v5e&dl=1"
                        alt="ต้องเอื้อมเมาส์"
                      />
                      <label
                        ><input
                          type="checkbox"
                          class="option-checkbox"
                          data-score="2"
                        />
                        ต้องเอื้อมแขนใช้เมาส์</label
                      >
                    </div>
                    <div>
                      <img
                        src="https://www.dropbox.com/scl/fi/53v9jaxno9obrs2zlin90/file_000000007ae461f5b4a092ad76eb7898.png?rlkey=zo47lk7qypqlr6juzxh24oa92&st=vnecbxj1&dl=1"
                        alt="เมาส์/แป้นอยู่ต่างระดับกัน"
                      />
                      <label
                        ><input
                          type="checkbox"
                          class="option-checkbox"
                          data-score="2"
                        />
                        เมาส์/แป้นพิมพ์ อยู่ต่างระดับกัน (+2)</label
                      >
                    </div>
                    <div>
                      <img
                        src="https://www.dropbox.com/scl/fi/8xdvl503j7b9maj6aavs8/file_000000007bec61fdbb68f9398f1b0116.png?rlkey=svz813ek2x80fssvq37u3p0cj&st=sruusx99&dl=1"
                        alt="จับเมาส์แน่น"
                      />
                      <label
                        ><input
                          type="checkbox"
                          class="option-checkbox"
                          data-score="1"
                        />
                        เมาส์มีขนาดเล็กเกินไป
                        ต้องใช้นิ้วมือในการเคลื่อนที่เมาส์มากกว่าการใช้ฝ่ามือ(+1)</label
                      >
                    </div>
                    <div>
                      <img
                        src="https://www.dropbox.com/scl/fi/jmxeqm39cc4fo7osfhgc8/file_0000000085b8622faa95659f13c8f489.png?rlkey=azkq20xl4jtm5szdzfuujfvrd&st=85ic61qh&dl=1"
                        alt="มีที่พักหรือที่วางข้อมือ"
                      />
                      <label
                        ><input
                          type="checkbox"
                          class="option-checkbox"
                          data-score="1"
                        />
                        ไม่มีที่รองข้อมือหรือที่วางข้อมือมีพื้นผิวแข็ง/ไม่มีเมาส์
                        (+1)</label
                      >
                    </div>
                  </div>
                </td>
                <td id="mouseScore">0</td>
              </tr>
              <tr>
                <th>แป้นพิมพ์</th>
                <th>คะแนน</th>
              </tr>
              <tr>
                <td>
                  <div class="option-group" id="keyboardGroup">
                    <div>
                      <img
                        src="https://www.dropbox.com/scl/fi/n1pgaoodxh2riws4wq956/file_00000000dabc61fa842debd3a28ffa75.png?rlkey=zk81ceu2uafb4d4rpxu431gcs&st=sm0sj95v&dl=1"
                        alt="ข้อมืออยู่ในแนวตรง ไหล่ผ่อนคลาย"
                      />
                      <label
                        ><input
                          type="checkbox"
                          class="option-checkbox"
                          data-score="1"
                        />
                        ข้อมือตรงและไหล่ผ่อนคลาย</label
                      >
                    </div>
                    <div>
                      <img
                        src="https://www.dropbox.com/scl/fi/ez4sn98w3kw03uv8nxxb4/file_00000000b7b862439c671c2c80c5a525.png?rlkey=agu60le7zmvsc13dffemv30l4&st=bvd17ft1&dl=1"
                        alt="ข้อมือกระดก/แป้นพิมพ์เอียงมากกว่า 15 องศา"
                      />
                      <label
                        ><input
                          type="checkbox"
                          class="option-checkbox"
                          data-score="2"
                        />
                        ข้อมือกระดก/ข้อมืองอขึ้นมากกว่า 15 องศา (+2)</label
                      >
                    </div>
                    <div>
                      <img
                        src="https://www.dropbox.com/scl/fi/n6bwu95dilt2n3dtmlblr/file_00000000009061faab7bd67b203ed2a1.png?rlkey=13vf9vdc4i4p4ose81i1hycau&st=cwgj22pq&dl=1"
                        alt="ข้อมือบิดขนะพิมพ์"
                      />
                      <label
                        ><input
                          type="checkbox"
                          class="option-checkbox"
                          data-score="1"
                        />
                        ข้อมือเบี่ยงออกซ้าย-ขวาขนะพิมพ์ (+1)</label
                      >
                    </div>
                    <div>
                      <img
                        src="https://www.dropbox.com/scl/fi/o828f4bdpecvgg57c3p1z/file_00000000e8c461f5954557ab29bcaf58-1.png?rlkey=v5pf09ly4i2d9d5ed8s6th7li&st=vru4eu3e&dl=1"
                        alt="แป้นพิมพ์สูงเกินไป ทำให้ไหล่ยก"
                      />
                      <label
                        ><input
                          type="checkbox"
                          class="option-checkbox"
                          data-score="1"
                        />
                        ระดับแป้นพิมพ์สูงเกินไป ทำให้ไหล่ยก (+1)</label
                      >
                    </div>
                    <div>
                      <img
                        src="https://www.dropbox.com/scl/fi/qehl3r3km4n0hcm15c39c/file_0000000079a061f5805aed373c922906.png?rlkey=i44ftal3gse5iz6r0s3wfrli2&st=66axk18q&dl=1"
                        alt="ต้องเอื้อมหยิบของเหนือศีรษะ"
                      />
                      <label
                        ><input
                          type="checkbox"
                          class="option-checkbox"
                          data-score="1"
                        />
                        ต้องมีการใช้งาน/หยิบของที่อยู่เหนือศีรษะ (+1)</label
                      >
                    </div>
                    <div>
                      <label
                        ><input
                          type="checkbox"
                          class="option-checkbox"
                          data-score="1"
                        />
                        ฐานแป้นพิมพ์ปรับระดับไม่ได้(+1)</label
                      >
                    </div>
                  </div>
                </td>
                <td id="keyboardScore">0</td>
              </tr>
            </table>
            <div class="score-box" id="totalScoreC">คะแนนรวม Section C : 0</div>
          </form>
          <div style="text-align: center">
            <button class="prev-btn" id="backToSectionB" type="button">
              ย้อนกลับ Section B
            </button>
            <button class="next-btn" id="toDurationSection" type="button">
              ไปส่วนระยะเวลา
            </button>
          </div>
        </div>
        <div class="section-content" id="durationContent" style="display: none">
          <div class="section-title section-duration">ระยะเวลาการทำงาน</div>
          <form autocomplete="off" id="durationForm">
            <table class="rosa-table">
              <tr>
                <th>ระยะเวลาการทำงานต่อเนื่อง</th>
                <th>คะแนน</th>
              </tr>
              <tr>
                <td>
                  <div class="option-group" id="durationGroup">
                    <div>
                      <button class="option-btn" data-score="-1" type="button">
                        น้อยกว่า 1 ชั่วโมง/วัน (ไม่ต่อเนื่อง) หรือใช้ต่ำกว่า 30
                        นาทีอย่างต่อเนื่อง
                      </button>
                    </div>
                    <div>
                      <button class="option-btn" data-score="0" type="button">
                        1-4 ชั่วโมง/วัน (ไม่ต่อเนื่อง) หรือใช้ 30 นาทีถึง 1
                        ชั่วโมงอย่างต่อเนื่อง
                      </button>
                    </div>
                    <div>
                      <button class="option-btn" data-score="1" type="button">
                        มากกว่า 4 ชั่วโมง/วัน (ไม่ต่อเนื่อง) หรือใช้มากกว่า 1
                        ชั่วโมงอย่างต่อเนื่อง
                      </button>
                    </div>
                  </div>
                </td>
                <td id="durationScore">0</td>
              </tr>
            </table>
            <div class="score-box" id="totalScoreDuration">
              คะแนนระยะเวลา : 0
            </div>
          </form>
          <div style="text-align: center">
            <button class="prev-btn" id="backToSectionC" type="button">
              ย้อนกลับ Section C
            </button>
            <button class="next-btn" id="toPainAssessment" type="button">
              ไปแบบประเมินอาการปวด
            </button>
          </div>
        </div>
        <div
          class="section-content"
          id="painAssessmentContent"
          style="display: none"
        >
          <div class="pain-assessment-container">
            <div class="pain-gradient-title-box">
              <h2>แบบประเมินอาการปวด/ชา/เมื่อยล้า</h2>
            </div>
            <div class="pain-instructions">
              <strong>คำชี้แจง :</strong>
              โปรดดูจากภาพร่างกายประกอบ เพื่อระบุอาการของท่าน <br />
              หากท่าน
              <b><u>เคยมีอาการในรอบ 1 เดือนที่ผ่านมา</u></b> ให้ทำเครื่องหมาย
              <span style="color: green">✓</span>
              ในช่องระดับอาการปวดรุนแรงแค่ไหน (<b>ข้อ 1</b>)
              และระดับอาการนี้เกิดขึ้นบ่อยแค่ไหน(<b>ข้อ 2</b>)
              ให้ตรงกับส่วนของร่างกายที่เคยมีอาการ
            </div>
            <div class="pain-section">
              <div class="pain-flex-img-table">
                <img
                  src="https://www.dropbox.com/scl/fi/zh8p7jpc30ra5p22on02z/SmartSelect_20250818_163424_Samsung-Notes.jpg?rlkey=bj6wrz61d1nh3m8twm5t1mgwt&st=hda8whny&dl=1"
                  alt="body parts image"
                  class="pain-body-img"
                />
                <div class="pain-assessment-table-container">
                  <table class="pain-table">
                    <tr>
                      <th style="width: 180px"></th>
                      <th colspan="5" class="pain-severity-head">  
                       ข้อ 1.อาการปวดรุนแรงแค่ไหน      
                      </th>
                      <th colspan="5" class="pain-freq-head">
                       ข้อ 2. อาการนี้เกิดขึ้นบ่อยแค่ไหน       
                      </th>
                    </tr>
                    <tr>
                      <th>ส่วนของร่างกายที่เคยมีอาการ</th>
                       <th class="pain-severity-none">ไม่มีอาการปวด</th>
                      <th class="pain-severity-mild">เล็กน้อย</th>
                      <th class="pain-severity-mod">ปานกลาง</th>
                      <th class="pain-severity-severe">มาก</th>
                      <th class="pain-severity-extreme">มากเกินทนไหว</th>
                      <th class="pain-freq-1-2wk">1-2 ครั้ง/สัปดาห์</th>
                      <th class="pain-freq-3-4wk">3-4 ครั้ง/สัปดาห์</th>
                      <th class="pain-freq-daily">1 ครั้งในทุกๆวัน</th>
                      <th class="pain-freq-often">หลายครั้งในทุกๆวัน</th>
                    </tr>
                    <tr>
                      <td>1. คอ</td>
                      <td class="pain-severity-none">
                        <input type="checkbox" name="neck_mild" />
                      <td class="pain-severity-mild">
                        <input type="checkbox" name="neck_mild" />
                      </td>
                      <td class="pain-severity-mod">
                        <input type="checkbox" name="neck_mod" />
                      </td>
                      <td class="pain-severity-severe">
                        <input type="checkbox" name="neck_severe" />
                      </td>
                      <td class="pain-severity-extreme">
                        <input type="checkbox" name="neck_extreme" />
                      </td>
                      <td class="pain-freq-1-2wk">
                        <input type="checkbox" name="neck_1_2wk" />
                      </td>
                      <td class="pain-freq-3-4wk">
                        <input type="checkbox" name="neck_3_4wk" />
                      </td>
                      <td class="pain-freq-daily">
                        <input type="checkbox" name="neck_daily" />
                      </td>
                      <td class="pain-freq-often">
                        <input type="checkbox" name="neck_often" />
                      </td>
                    </tr>
                    <tr>
                      <td>2. ไหล่</td>
                      <td class="pain-severity-none">
                        <input type="checkbox" name="shoulder_mild" />
                      <td class="pain-severity-mild">
                        <input type="checkbox" name="shoulder_mild" />
                      </td>
                      <td class="pain-severity-mod">
                        <input type="checkbox" name="shoulder_mod" />
                      </td>
                      <td class="pain-severity-severe">
                        <input type="checkbox" name="shoulder_severe" />
                      </td>
                      <td class="pain-severity-extreme">
                        <input type="checkbox" name="shoulder_extreme" />
                      </td>
                      <td class="pain-freq-1-2wk">
                        <input type="checkbox" name="shoulder_1_2wk" />
                      </td>
                      <td class="pain-freq-3-4wk">
                        <input type="checkbox" name="shoulder_3_4wk" />
                      </td>
                      <td class="pain-freq-daily">
                        <input type="checkbox" name="shoulder_daily" />
                      </td>
                      <td class="pain-freq-often">
                        <input type="checkbox" name="shoulder_often" />
                      </td>
                    </tr>
                    <tr>
                      <td>3. หลังส่วนบน</td>
                      <td class="pain-severity-none">
                        <input type="checkbox" name="upperback_mild" />
                      <td class="pain-severity-mild">
                        <input type="checkbox" name="upperback_mild" />
                      </td>
                      <td class="pain-severity-mod">
                        <input type="checkbox" name="upperback_mod" />
                      </td>
                      <td class="pain-severity-severe">
                        <input type="checkbox" name="upperback_severe" />
                      </td>
                      <td class="pain-severity-extreme">
                        <input type="checkbox" name="upperback_extreme" />
                      </td>
                      <td class="pain-freq-1-2wk">
                        <input type="checkbox" name="upperback_1_2wk" />
                      </td>
                      <td class="pain-freq-3-4wk">
                        <input type="checkbox" name="upperback_3_4wk" />
                      </td>
                      <td class="pain-freq-daily">
                        <input type="checkbox" name="upperback_daily" />
                      </td>
                      <td class="pain-freq-often">
                        <input type="checkbox" name="upperback_often" />
                      </td>
                    </tr>
                    <tr>
                      <td>4. หลังส่วนล่าง</td>
                      <td class="pain-severity-none">
                           <input type="checkbox" name="lowerback_mild" />
                      <td class="pain-severity-mild">
                        <input type="checkbox" name="lowerback_mild" />
                      </td>
                      <td class="pain-severity-mod">
                        <input type="checkbox" name="lowerback_mod" />
                      </td>
                      <td class="pain-severity-severe">
                        <input type="checkbox" name="lowerback_severe" />
                      </td>
                      <td class="pain-severity-extreme">
                        <input type="checkbox" name="lowerback_extreme" />
                      </td>
                      <td class="pain-freq-1-2wk">
                        <input type="checkbox" name="lowerback_1_2wk" />
                      </td>
                      <td class="pain-freq-3-4wk">
                        <input type="checkbox" name="lowerback_3_4wk" />
                      </td>
                      <td class="pain-freq-daily">
                        <input type="checkbox" name="lowerback_daily" />
                      </td>
                      <td class="pain-freq-often">
                        <input type="checkbox" name="lowerback_often" />
                      </td>
                    </tr>
                    <tr>
                      <td>5. แขนท่อนล่าง</td>
                      <td class="pain-severity-none">
                        <input type="checkbox" name="arm_mild" />
                      <td class="pain-severity-mild">
                        <input type="checkbox" name="arm_mild" />
                      </td>
                      <td class="pain-severity-mod">
                        <input type="checkbox" name="arm_mod" />
                      </td>
                      <td class="pain-severity-severe">
                        <input type="checkbox" name="arm_severe" />
                      </td>
                      <td class="pain-severity-extreme">
                        <input type="checkbox" name="arm_extreme" />
                      </td>
                      <td class="pain-freq-1-2wk">
                        <input type="checkbox" name="arm_1_2wk" />
                      </td>
                      <td class="pain-freq-3-4wk">
                        <input type="checkbox" name="arm_3_4wk" />
                      </td>
                      <td class="pain-freq-daily">
                        <input type="checkbox" name="arm_daily" />
                      </td>
                      <td class="pain-freq-often">
                        <input type="checkbox" name="arm_often" />
                      </td>
                    </tr>
                    <tr>
                      <td>6. มือและข้อมือ</td>
                      <td class="pain-severity-none">
                          <input type="checkbox" name="hand_mild" />
                      <td class="pain-severity-mild">
                        <input type="checkbox" name="hand_mild" />
                      </td>
                      <td class="pain-severity-mod">
                        <input type="checkbox" name="hand_mod" />
                      </td>
                      <td class="pain-severity-severe">
                        <input type="checkbox" name="hand_severe" />
                      </td>
                      <td class="pain-severity-extreme">
                        <input type="checkbox" name="hand_extreme" />
                      </td>
                      <td class="pain-freq-1-2wk">
                        <input type="checkbox" name="hand_1_2wk" />
                      </td>
                      <td class="pain-freq-3-4wk">
                        <input type="checkbox" name="hand_3_4wk" />
                      </td>
                      <td class="pain-freq-daily">
                        <input type="checkbox" name="hand_daily" />
                      </td>
                      <td class="pain-freq-often">
                        <input type="checkbox" name="hand_often" />
                      </td>
                    </tr>
                    <tr>
                      <td>7. สะโพก</td>
                      <td class="pain-severity-none">
                         <input type="checkbox" name="hip_mild" />
                      <td class="pain-severity-mild">
                        <input type="checkbox" name="hip_mild" />
                      </td>
                      <td class="pain-severity-mod">
                        <input type="checkbox" name="hip_mod" />
                      </td>
                      <td class="pain-severity-severe">
                        <input type="checkbox" name="hip_severe" />
                      </td>
                      <td class="pain-severity-extreme">
                        <input type="checkbox" name="hip_extreme" />
                      </td>
                      <td class="pain-freq-1-2wk">
                        <input type="checkbox" name="hip_1_2wk" />
                      </td>
                      <td class="pain-freq-3-4wk">
                        <input type="checkbox" name="hip_3_4wk" />
                      </td>
                      <td class="pain-freq-daily">
                        <input type="checkbox" name="hip_daily" />
                      </td>
                      <td class="pain-freq-often">
                        <input type="checkbox" name="hip_often" />
                      </td>
                    </tr>
                    <tr>
                      <td>8. เข่า</td>
                      <td class="pain-severity-none">
                        <input type="checkbox" name="knee_mild" />
                      <td class="pain-severity-mild">
                        <input type="checkbox" name="knee_mild" />
                      </td>
                      <td class="pain-severity-mod">
                        <input type="checkbox" name="knee_mod" />
                      </td>
                      <td class="pain-severity-severe">
                        <input type="checkbox" name="knee_severe" />
                      </td>
                      <td class="pain-severity-extreme">
                        <input type="checkbox" name="knee_extreme" />
                      </td>
                      <td class="pain-freq-1-2wk">
                        <input type="checkbox" name="knee_1_2wk" />
                      </td>
                      <td class="pain-freq-3-4wk">
                        <input type="checkbox" name="knee_3_4wk" />
                      </td>
                      <td class="pain-freq-daily">
                        <input type="checkbox" name="knee_daily" />
                      </td>
                      <td class="pain-freq-often">
                        <input type="checkbox" name="knee_often" />
                      </td>
                    </tr>
                    <tr>
                      <td>9. น่อง</td>
                      <td class="pain-severity-none">
                        <input type="checkbox" name="calf_mild" />
                      <td class="pain-severity-mild">
                        <input type="checkbox" name="calf_mild" />
                      </td>
                      <td class="pain-severity-mod">
                        <input type="checkbox" name="calf_mod" />
                      </td>
                      <td class="pain-severity-severe">
                        <input type="checkbox" name="calf_severe" />
                      </td>
                      <td class="pain-severity-extreme">
                        <input type="checkbox" name="calf_extreme" />
                      </td>
                      <td class="pain-freq-1-2wk">
                        <input type="checkbox" name="calf_1_2wk" />
                      </td>
                      <td class="pain-freq-3-4wk">
                        <input type="checkbox" name="calf_3_4wk" />
                      </td>
                      <td class="pain-freq-daily">
                        <input type="checkbox" name="calf_daily" />
                      </td>
                      <td class="pain-freq-often">
                        <input type="checkbox" name="calf_often" />
                      </td>
                    </tr>
                    <tr>
                      <td>10. เท้าและข้อเท้า</td>
                       <td class="pain-severity-none">
                         <input type="checkbox" name="foot_mild" />
                      <td class="pain-severity-mild">
                        <input type="checkbox" name="foot_mild" />
                      </td>
                      <td class="pain-severity-mod">
                        <input type="checkbox" name="foot_mod" />
                      </td>
                      <td class="pain-severity-severe">
                        <input type="checkbox" name="foot_severe" />
                      </td>
                      <td class="pain-severity-extreme">
                        <input type="checkbox" name="foot_extreme" />
                      </td>
                      <td class="pain-freq-1-2wk">
                        <input type="checkbox" name="foot_1_2wk" />
                      </td>
                      <td class="pain-freq-3-4wk">
                        <input type="checkbox" name="foot_3_4wk" />
                      </td>
                      <td class="pain-freq-daily">
                        <input type="checkbox" name="foot_daily" />
                      </td>
                      <td class="pain-freq-often">
                        <input type="checkbox" name="foot_often" />
                      </td>
                    </tr>
                  </table>
                </div>
              </div>
              <div class="pain-note">
                <b>หมายเหตุ:</b><br />
                <strong>ปวดเล็กน้อย</strong> = ปวดเบาๆ หรือปวดๆ หายๆ
                ระหว่างทำงาน
                <br />
                <strong>ปวดปานกลาง</strong> = ปวดต้องเปลี่ยนแปลงท่าทาง
                หรือปวดต่อเนื่องเป็นพักๆ <br />
                <strong>ปวดมาก</strong> = ปวดจนต้องหยุดการทำงานชั่วขณะ <br />
                <strong>ปวดมากเกินทนไหว</strong> = ถึงขั้นหยุดงานอย่างน้อย 1 วัน
              </div>
            </div>
            <div class="pain-section">
              <div style="margin-bottom: 10px">
                <strong>ข้อ 3.</strong>
                ในระยะเวลา 7 วันที่ผ่านมา
                ท่านเคยมีอาการปวด/ชา/เมื่อยล้าตามส่วนของร่างกาย ข้างต้น
                ที่เกิดจาก<b><u>การทำงาน </u></b>
                หรือไม่
              </div>
              <div style="margin-bottom: 15px">
                <label style="margin-right: 20px"
                  ><input type="radio" name="q3" value="0" /> ไม่เคย</label
                >
                <label style="margin-right: 10px"
                  ><input type="radio" name="q3" value="1" /> เคย
                  บริเวณ...</label
                >
                <input
                  type="text"
                  style="
                    width: 130px;
                    border-radius: 7px;
                    border: 1px solid #ffcc33;
                    padding: 6px 8px;
                    font-size: 1em;
                    margin-left: 8px;
                  "
                  name="q3_area"
                  placeholder="ระบุ..."
                />
              </div>
            </div>
            <div class="pain-section">
              <div style="margin-bottom: 10px">
                <strong>ข้อ 4.</strong>
                ท่านคิดว่าอาการปวด/ชา/เมื่อยล้า ที่กล่าวนั้นเกิดจาก
                <b><u>การทำงาน</u></b> ในที่ทำงานเท่านั้น หรือไม่
              </div>
              <div style="margin-bottom: 10px">
                <label style="margin-right: 15px"
                  ><input type="radio" name="q4" value="1" /> ใช่</label
                >
                <label style="margin-right: 15px"
                  ><input type="radio" name="q4" value="2" /> ไม่แน่ใจ</label
                >
                <label style="margin-right: 15px"
                  ><input type="radio" name="q4" value="3" /> ไม่ใช่</label
                >
                <span style="margin-left: 15px">คิดว่าเกิดจากสาเหตุใด :</span>
              </div>
              <div
                style="
                  display: flex;
                  flex-wrap: wrap;
                  gap: 18px;
                  margin-top: 8px;
                  margin-bottom: 8px;
                "
              >
                <label
                  style="
                    margin-right: 0;
                    background: #ffffee;
                    border-radius: 7px;
                    padding: 6px 10px 6px 6px;
                    font-size: 1em;
                  "
                  ><input type="checkbox" name="cause" value="31" />
                  งานเสริม</label
                >
                <label
                  style="
                    margin-right: 0;
                    background: #ffffee;
                    border-radius: 7px;
                    padding: 6px 10px 6px 6px;
                    font-size: 1em;
                  "
                  ><input type="checkbox" name="cause" value="32" />
                  เล่นกีฬา</label
                >
                <label
                  style="
                    margin-right: 0;
                    background: #ffffee;
                    border-radius: 7px;
                    padding: 6px 10px 6px 6px;
                    font-size: 1em;
                  "
                  ><input type="checkbox" name="cause" value="33" />
                  งานบ้าน</label
                >
                <label
                  style="
                    margin-right: 0;
                    background: #ffffee;
                    border-radius: 7px;
                    padding: 6px 10px 6px 6px;
                    font-size: 1em;
                  "
                  ><input type="checkbox" name="cause_other" value="34" /> อื่นๆ
                  ระบุ
                  <input
                    type="text"
                    name="cause_other"
                    style="
                      width: 130px;
                      border-radius: 7px;
                      border: 1px solid #ffcc33;
                      padding: 6px 8px;
                      font-size: 1em;
                      margin-left: 8px;
                    "
                /></label>
              </div>
            </div>
            <div
              style="
                text-align: right;
                font-size: 0.95em;
                color: #696969;
                margin-top: 24px;
                margin-bottom: 8px;
              "
            >
              ที่มา: สุชินา ชายเกลี้ยง พรนภา สุกรเวชศิริ วิภารัตน์ โพธิ์ธี
              (2558)
            </div>
          </div>
          <div style="text-align: center">
            <button class="prev-btn" id="backToDuration" type="button">
              ย้อนกลับระยะเวลา
            </button>
            <button class="next-btn" id="toSummary" type="button">
              ดูผลการประเมิน
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Summary Page -->
    <div class="page summary-page" id="summaryPage">
      <div class="container">
        <h1>ผลการประเมิน ROSA</h1>
        <div class="auto-result" id="resultContainer">
          <h2>คะแนนรวม</h2>
          <div class="score-display" id="finalScore">0</div>
          <div class="risk-display" id="riskLevel">ระดับความเสี่ยง : ต่ำ</div>
        </div>
        <div class="breakdown">
          <h3>รายละเอียดคะแนน</h3>
          <div class="score-item">
            <span>Section A (เก้าอี้) :</span>
            <span id="summaryScoreA">0</span>
          </div>
          <div class="score-item">
            <span>Section B (หน้าจอและโทรศัพท์) :</span>
            <span id="summaryScoreB">0</span>
          </div>
          <div class="score-item">
            <span>Section C (เมาส์และแป้นพิมพ์) :</span>
            <span id="summaryScoreC">0</span>
          </div>
          <div class="score-item">
            <span>ระยะเวลาการทำงาน :</span>
            <span id="summaryDuration">0</span>
          </div>
        </div>
        <div class="pain-assessment-display">
          <!-- <h3>ผลรวมคะแนนแบบประเมินอาการปวด/ชา/เมื่อยล้า</h3>
      <div class="pain-score-value" id="painAssessmentScore">0</div> -->

          <!-- ส่วนแสดงผลด้านบน: ระดับความเสี่ยงและอวัยวะที่มีความเสี่ยงสูงสุด -->
          <div
            class="pain-risk-summary"
            id="painRiskSummary"
            style="
              background: #fff2ee;
              border-left: 5px solid #ff6b35;
              margin-bottom: 18px;
              padding: 15px 18px 11px 15px;
              border-radius: 0 10px 10px 0;
              box-shadow: 0 1px 4px rgba(0, 0, 0, 0.04);
            "
          >
            <div
              style="font-size: 1.15rem; font-weight: bold; margin-bottom: 8px"
            >
              ระดับความเสี่ยง:
              <span
                id="totalRiskLevel"
                style="
                  font-size: 1.35rem;
                  padding: 4px 12px;
                  border-radius: 6px;
                  background: #ffffff;
                  color: #000000;
                "
                >ไม่มีข้อมูล</span
              >
              <span id="totalRiskScore" style="display: none">0</span>
            </div>
            <div style="font-size: 1.03rem; color: #333">
              ส่วนของร่างกายที่มีความเสี่ยง 3 อันดับแรก:
              <span
                id="topRiskBodyParts"
                style="font-weight: bold; color: #000000"
                >-</span
              >
            </div>
          </div>

          <!-- New table for body part scores -->
          <div
            class="pain-score-table-container"
            style="margin: 20px 0; overflow-x: auto"
          >
            <table
              class="pain-score-table"
              style="
                width: 100%;
                border-collapse: collapse;
                margin: 15px 0;
                background: white;
                border-radius: 8px;
                overflow: hidden;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
              "
            >
              <thead>
                <tr style="background-color: #f89c7a; color: rgb(8, 0, 0)">
                  <th
                    style="
                      padding: 12px;
                      text-align: center;
                      border: 1px solid #130101;
                    "
                  >
                    ส่วนของร่างกาย
                  </th>
                  <th
                    style="
                      padding: 12px;
                      text-align: center;
                      border: 1px solid #030000;
                    "
                  >
                    ระดับความรุนแรง
                  </th>
                  <th
                    style="
                      padding: 12px;
                      text-align: center;
                      border: 1px solid #110000;
                    "
                  >
                    คะแนนความรุนแรง
                  </th>
                  <th
                    style="
                      padding: 12px;
                      text-align: center;
                      border: 1px solid #0a0000;
                    "
                  >
                    ระดับความถี่
                  </th>
                  <th
                    style="
                      padding: 12px;
                      text-align: center;
                      border: 1px solid #0e0000;
                    "
                  >
                    คะแนนความถี่
                  </th>
                  <th
                    style="
                      padding: 12px;
                      text-align: center;
                      border: 1px solid #110000;
                    "
                  >
                    คะแนนความเสี่ยง<br />(รุนแรง × ถี่)
                  </th>
                </tr>
              </thead>
              <tbody id="painScoreTableBody">
                <!-- Table rows will be populated by JavaScript -->
                <tr>
                  <td
                    colspan="6"
                    style="
                      padding: 20px;
                      text-align: center;
                      color: #666;
                      border: 1px solid #ddd;
                    "
                  >
                    ไม่มีข้อมูลอาการปวด/ชา/เมื่อยล้า
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="pain-score-breakdown" id="painScoreBreakdown">
            <!-- ส่วนคะแนนและระดับความเสี่ยงถูกนำออก -->
            <div class="pain-score-section" style="margin-top: 15px">
              <h4
                style="
                  color: #ff6b35;
                  margin: 0 0 15px 0;
                  font-size: 1.1rem;
                  text-align: center;
                  border-bottom: 1px solid #ff6b35;
                  padding-bottom: 5px;
                "
              >
                รายละเอียดการประเมิน
              </h4>
              <!-- รายละเอียดการคำนวณแต่ละส่วน -->
              <div
                class="assessment-detail-card"
                style="
                  background: #fff8f5;
                  border-left: 4px solid #ff6b35;
                  padding: 12px 15px;
                  margin-bottom: 15px;
                  border-radius: 0 8px 8px 0;
                "
              >
                <div
                  style="display: flex; align-items: center; margin-bottom: 8px"
                >
                  <span
                    style="
                      color: #ff6b35;
                      font-weight: bold;
                      font-size: 1rem;
                      margin-right: 8px;
                    "
                    >🔍</span
                  >
                  <span
                    style="color: #ff6b35; font-weight: bold; font-size: 1rem"
                    >การวิเคราะห์สาเหตุอาการ (ข้อ 3-4)</span
                  >
                </div>
                <div
                  style="
                    background: #fff;
                    padding: 10px 12px;
                    border-radius: 6px;
                    border: 1px solid #ffe0d6;
                  "
                >
                  <span
                    id="painCauseAnalysis"
                    style="font-size: 0.95rem; line-height: 1.4; color: #333"
                    >ไม่ระบุ</span
                  >
                </div>
                <div
                  style="
                    font-size: 0.85rem;
                    color: #666;
                    margin-top: 6px;
                    font-style: italic;
                  "
                >
                  ข้อ 3: สาเหตุจากการทำงาน | ข้อ 4: สาเหตุอื่นๆ
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- Low Risk Recommendations (คะแนน < 5) -->
        <div id="lowScoreRecommendation" style="display: none">
          <div class="risk-warning">
            <h3>ผลการประเมิน: ระดับความเสี่ยงต่ำ</h3>
            <div class="assessment-result-warning">
              "ท่าทางการทำงานของคุณอยู่ในเกณฑ์ที่ดี
              แต่ยังควรปฏิบัติตามคำแนะนำเพื่อป้องกันปัญหาในอนาคต"
            </div>
          </div>
          <div class="ergonomic-section">
            <section aria-labelledby="sit-posture">
              <h2 id="sit-posture">ข้อแนะนำท่านั่งจากผู้เชี่ยวชาญ</h2>
              <div class="custom-images">
                <figure>
                  <img
                    alt="คำอธิบายรูปภาพ"
                    src="https://www.dropbox.com/scl/fi/zwsndwjcrexjvigopw7qn/file_000000006d3061f7b1dbbbdb936c67e1.png?rlkey=ux4qewcith25lw66lpfmrowar&st=23li5tnw&dl=1"
                  />
                  <figcaption>นั่งหลังตรง</figcaption>
                </figure>
                <figure>
                  <img
                    alt="เท้าวางราบกับพื้น"
                    src="https://www.dropbox.com/scl/fi/5pmcgbo7c0xou09pz1c60/file_00000000420861f5927395ae62889bff.png?rlkey=yzupfc8ure9dmlz2sbo5qy1qa&st=o9dl2u60&dl=1"
                  />
                  <figcaption>เท้าตั้งอยู่บนพื้น</figcaption>
                </figure>
                <figure>
                  <img
                    alt="มุมแขน 90°"
                    src="https://www.dropbox.com/scl/fi/hs76j9igkrkcm4goctoxm/file_000000005a3461fa8a1039d5f9aca32b.png?rlkey=39eqyv91g9izcdzpi9o1ry00q&st=bdirdap7&dl=1"
                  />
                  <figcaption>มุมแขน 90°</figcaption>
                </figure>
              </div>
              <div class="recommendations">
                <ul>
                  <li>
                    ให้ตั้งหลังตรงและพิงพนักเก้าอี้เพื่อรองรับกระดูกสันหลังลดอาการปวดคอและหลังจากการนั่งนานๆ
                  </li>
                  <li>
                    ควรรักษามุมกระดูกสันหลังให้ตรงและไม่โค้งงอ
                    เพื่อไม่ให้เกิดแรงกดที่กระดูกสันหลังและลดความเมื่อยล้าจากการนั่งนานๆ
                  </li>
                  <li>
                    เท้าควรแตะพื้นเต็มที่หรือใช้ที่รองเท้าเพื่อปรับตำแหน่งเท้าให้ถูกต้อง
                    เพื่อให้ขาไม่เกร็งหรือลอยจากพื้น
                  </li>
                  <li>
                    แขนควรตั้งมุม 90 องศาเมื่อใช้แป้นพิมพ์และเมาส์
                    เพื่อให้ข้อมือไม่ต้องยืดหรือบิด
                    ซึ่งจะช่วยลดอาการเมื่อยล้าของกล้ามเนื้อแขนและข้อมือ
                  </li>
                </ul>
              </div>
            </section>
          </div>
          <div class="ergonomic-section">
            <section aria-labelledby="desk-setup">
              <h2 id="desk-setup">การจัดโต๊ะทำงานที่ถูกต้อง</h2>
              <div class="custom-images">
                <figure>
                  <img
                    alt="ระดับข้อมือสอดคล้องกับโต๊ะ"
                    src="https://www.dropbox.com/scl/fi/8mjpaztw99ykp017u4pp/file_0000000086d461f5bb271eba1831c589.png?rlkey=18navrqryiyxhrvfhkuqykjc9&st=gbqk21pm&dl=1"
                  />
                  <figcaption>ระดับโต๊ะที่เหมาะสม</figcaption>
                </figure>
                <figure>
                  <img
                    alt="หน้าจอคอมฯ อยู่ในระดับสายตา"
                    src="https://www.dropbox.com/scl/fi/ts29i20d3i37w9efmzx4v/file_000000007abc61f4984cad90895d94cc.png?rlkey=yra6e95skrh90y49jx2ojglxr&st=cvx3rrdw&dl=1"
                  />
                  <figcaption>หน้าจอในระดับสายตา</figcaption>
                </figure>
              </div>
              <div class="recommendations">
                <ul>
                  <li>
                    โต๊ะทำงานควรมีความสูงประมาณ 75 ซม.
                    ซึ่งเป็นความสูงมาตรฐานที่สามารถใช้ได้กับผู้ใช้ส่วนใหญ่
                  </li>
                  <li>
                    หน้าจอควรห่างจากตาประมาณ 50-75 ซม.
                    เพื่อป้องกันอาการตาล้าและหลีกเลี่ยงความตึงเครียดที่คอ
                  </li>
                  <li>
                    เทคนิค 20-20-20: ทุกๆ 20
                    นาทีให้หยุดมองไปที่วัตถุที่ห่างประมาณ 6 เมตร เป็นเวลา 20
                    วินาที
                  </li>
                </ul>
              </div>
            </section>
          </div>
          <div class="ergonomic-section">
            <section aria-labelledby="stretch-rest">
              <h2 id="stretch-rest">การยืดเหยียดและพักผ่อน</h2>
              <div class="custom-images">
                <figure>
                  <img
                    alt="การยืดเหยียด"
                    src="https://www.dropbox.com/scl/fi/ry8q1tdioo1ioqjgnyvek/file_00000000481061f7a75d9bd01f033544.png?rlkey=wdxkvs7hfy2pgr6a83xl5zflb&st=j2jgag3q&dl=1"
                  />
                  <figcaption>ยืดเหยียด</figcaption>
                </figure>
                <figure>
                  <img
                    alt="พักผ่อน"
                    src="https://www.dropbox.com/scl/fi/bdhp8rbnapjzulfglmdio/file_00000000b2706230a8263fdb4d9e2018.png?rlkey=mcabpsuda0bizem6gw809y1dx&st=yvfi2iii&dl=1"
                  />
                  <figcaption>พักผ่อน</figcaption>
                </figure>
              </div>
              <div class="recommendations">
                <ul>
                  <li>
                    ควรลุกยืดเหยียดทุกๆ 30-60 นาที
                    เพื่อคลายความตึงจากการนั่งทำงานนานๆ
                  </li>
                  <li>
                    ควรยืดกล้ามเนื้อคอ ไหล่ หลัง
                    และขาเพื่อป้องกันการเจ็บปวดจากการนั่งในท่าทางเดียวกันเป็นเวลานาน
                  </li>
                  <li>
                    การพักบ่อยๆ
                    ยังช่วยเพิ่มความสามารถในการทำงานและเพิ่มความกระปรี้กระเปร่าในการทำงาน
                  </li>
                </ul>
              </div>
            </section>
          </div>
          <div class="section-divider"></div>
          <section aria-labelledby="environment">
            <h2 id="environment">การจัดสภาพแวดล้อมการทำงาน</h2>
            <div class="custom-images">
              <figure>
                <img
                  src="https://www.dropbox.com/scl/fi/9tpxrmxf2eoeen5rsdbw4/file_00000000b4286230993135f0724e089b.png?rlkey=wj4qqgzh0xvbccy3f5j6n9bfq&st=e3bmn180&dl=1"
                  alt="แสงสว่าง"
                />
                <figcaption>แสงสว่าง</figcaption>
              </figure>
            </div>
            <div class="recommendations">
              <ul>
                <li>
                  ใช้แสงธรรมชาติหรือติดไฟในห้องที่มีแสงเพียงพอ
                  เพื่อลดความเครียดจากการทำงานหน้าจอ
                  โดยหลีกเลี่ยงแสงสะท้อนที่อาจทำให้ตาล้า
                </li>
                <li>
                  ควรทำงานในห้องที่มีอุณหภูมิพอเหมาะ ไม่ร้อนหรือเย็นเกินไป
                  โดยควรรักษาอุณหภูมิในห้องให้อยู่ในระดับที่ทำให้ผู้ใช้งานรู้สึกสบาย
                  ซึ่งจะช่วยเพิ่มความสะดวกสบายในการทำงานและลดความเครียดจากสภาพแวดล้อม
                </li>
              </ul>
            </div>
          </section>
        </div>
        <!-- High Risk Recommendations (คะแนน >= 5) -->
        <div id="highScoreRecommendation" style="display: none">
          <div class="risk-warning high-risk">
            <h3>ผลการประเมิน: ระดับความเสี่ยงสูง</h3>
            <div class="assessment-result-warning">
              "ท่าทางการทำงานของคุณจำเป็นต้องมีการปรับปรุงเพื่อป้องกันความเสี่ยงจากปัญหาสุขภาพในอนาคต"
            </div>
          </div>
          <div class="ergonomic-section">
            <section aria-labelledby="urgent-adjustments">
              <h2 id="urgent-adjustments">1. การปรับท่าทางการทำงานเร่งด่วน</h2>
              <div class="custom-images">
                <figure>
                  <img
                    alt="เก้าอี้ที่เหมาะสม"
                    src="https://www.dropbox.com/scl/fi/r89chgfs43xgvdcwbfkf7/file_000000003910622f9be04b55c1ec6b64.png?rlkey=vkk6q6cawqt95esnnboztsukv&st=pqw7d5sk&dl=1"
                  />
                  <figcaption>เก้าอี้ที่เหมาะสม</figcaption>
                </figure>
                <figure>
                  <img
                    alt="โต๊ะทำงาน"
                    src="https://www.dropbox.com/scl/fi/o4baz1ir91g90d7byu0w4/file_000000001c2861f895e93f2bbd672b4c.png?rlkey=qilpdvs0bombst5ycvaezdq4c&st=hsai373w&dl=1"
                  />
                  <figcaption>โต๊ะทำงาน</figcaption>
                </figure>
              </div>
              <div class="recommendations">
                <ul>
                  <li>
                    <strong>การปรับความสูงของเก้าอี้และโต๊ะทำงาน:</strong><br />
                    <strong>เก้าอี้:</strong>
                    ควรปรับให้สะโพกอยู่สูงกว่าหัวเข่า 1-2 นิ้ว
                    และสามารถปรับมุมพนักพิงให้รองรับหลังส่วนล่างได้ดี
                    โดยการปรับพนักพิงให้อยู่ในมุม 90-110 องศา<br />
                    <strong>โต๊ะ:</strong> ควรปรับโต๊ะให้ข้อมืออยู่ในมุม 90
                    องศาเมื่อวางข้อมือบนโต๊ะ
                    เพื่อไม่ให้เกิดความเมื่อยล้าหรือบาดเจ็บจากการทำงาน
                  </li>
                </ul>
              </div>
            </section>
          </div>
          <div class="ergonomic-section">
            <section aria-labelledby="monitor-setup">
              <h2 id="monitor-setup">2. การตั้งหน้าจอคอมพิวเตอร์</h2>
              <div class="custom-images">
                <figure>
                  <img
                    alt="หน้าจอคอมพิวเตอร์"
                    src="https://www.dropbox.com/scl/fi/7gfgohakd6mj37ldkgcy3/file_0000000025b46230807f602463f41880.png?rlkey=85h2ge7222x2sz8o8k8jmd6fr&st=nh80f7fo&dl=1"
                  />
                  <figcaption>หน้าจอคอมพิวเตอร์</figcaption>
                </figure>
              </div>
              <div class="recommendations">
                <ul>
                  <li>
                    ตั้งหน้าจอคอมพิวเตอร์ในระดับที่สายตาสามารถมองตรงไปที่หน้าจอได้โดยไม่ต้องเงยคอหรือก้มหน้า
                  </li>
                  <li>
                    หน้าจอควรห่างจากตาประมาณ 50-75 ซม.
                    เพื่อป้องกันอาการตาล้าและหลีกเลี่ยงความตึงเครียดที่คอ
                  </li>
                  <li>
                    เทคนิค 20-20-20: ทุกๆ 20
                    นาทีที่ทำงานกับคอมพิวเตอร์ให้หยุดมองไปที่วัตถุที่ห่างประมาณ
                    6 เมตร เป็นเวลา 20 วินาที
                  </li>
                </ul>
              </div>
            </section>
          </div>
          <div class="ergonomic-section">
            <section aria-labelledby="tools-support">
              <h2 id="tools-support">3. การใช้เครื่องมือเสริม</h2>
              <div class="custom-images">
                <figure>
                  <img
                    alt="แป้นพิมพ์"
                    src="https://www.dropbox.com/scl/fi/pyqdwb96nfx41373l7efz/file_000000007dec62309d785ce1852a696a.png?rlkey=xvx9hcdk1vs189vexvjlzbkv7&st=fxd2yanu&dl=1"
                  />
                  <figcaption>แป้นพิมพ์</figcaption>
                </figure>
                <figure>
                  <img
                    alt="เมาส์"
                    src="https://www.dropbox.com/scl/fi/a6iorqk7mwuk3z7o6fs8d/file_0000000085206230a3c4a2478aa291aa.png?rlkey=dotuingd0p5vcjzdricol1vdt&st=y4cbxvxs&dl=1"
                  />
                  <figcaption>เมาส์</figcaption>
                </figure>
              </div>
              <div class="recommendations">
                <ul>
                  <li>
                    <strong>แป้นพิมพ์ที่รองข้อมือ:</strong>
                    การใช้ที่รองข้อมือจะช่วยลดการเกร็งข้อมือและป้องกันการบาดเจ็บจากการพิมพ์ในระยะยาว
                  </li>
                  <li>
                    <strong>เมาส์:</strong>
                    วางเมาส์ให้อยู่ใกล้กับแป้นพิมพ์เพื่อไม่ให้ต้องยืดแขนไปข้างหน้า
                    เลือกใช้เมาส์ที่มีขนาดพอดีกับมือ
                  </li>
                </ul>
              </div>
            </section>
          </div>
          <div class="ergonomic-section">
            <section aria-labelledby="frequent-breaks">
              <h2 id="frequent-breaks">4. การพักจากการนั่งบ่อยขึ้น</h2>
              <div class="custom-images">
                <figure>
                  <img
                    alt="การพักจากการนั่ง"
                    src="https://www.dropbox.com/scl/fi/bdhp8rbnapjzulfglmdio/file_00000000b2706230a8263fdb4d9e2018.png?rlkey=mcabpsuda0bizem6gw809y1dx&st=dbhbovi8&dl=1"
                  />
                  <figcaption>การพักจากการนั่ง</figcaption>
                </figure>
                <figure>
                  <img
                    alt="การยืดเหยียด"
                    src="https://www.dropbox.com/scl/fi/ry8q1tdioo1ioqjgnyvek/file_00000000481061f7a75d9bd01f033544.png?rlkey=wdxkvs7hfy2pgr6a83xl5zflb&st=4ek0le67&dl=1"
                  />
                  <figcaption>การยืดเหยียด</figcaption>
                </figure>
              </div>
              <div class="recommendations">
                <ul>
                  <li>
                    ควรลุกจากเก้าอี้ทุก 30 นาที
                    เพื่อให้ร่างกายได้พักและลดการเกิดอาการเมื่อยล้าจากการนั่งในท่าทางเดิมนานๆ
                  </li>
                  <li>
                    การยืดเหยียดหรือเดินช่วยกระตุ้นการไหลเวียนของเลือดและลดความตึงเครียดของกล้ามเนื้อ
                  </li>
                  <li>
                    ควรใช้เวลาพักเป็นโอกาสในการยืดเหยียดกล้ามเนื้อ เช่น
                    การยืดกล้ามเนื้อขา คอ หรือไหล่
                  </li>
                </ul>
              </div>
            </section>
          </div>
          <div class="section-divider"></div>
          <section aria-labelledby="environment">
            <h2 id="environment">การจัดสภาพแวดล้อมการทำงาน</h2>
            <div class="custom-images">
              <figure>
                <img
                  src="https://www.dropbox.com/scl/fi/9tpxrmxf2eoeen5rsdbw4/file_00000000b4286230993135f0724e089b.png?rlkey=wj4qqgzh0xvbccy3f5j6n9bfq&st=e3bmn180&dl=1"
                  alt="แสงสว่าง"
                />
                <figcaption>แสงสว่าง</figcaption>
              </figure>
            </div>
            <div class="recommendations">
              <ul>
                <li>
                  ใช้แสงธรรมชาติหรือติดไฟในห้องที่มีแสงเพียงพอ
                  เพื่อลดความเครียดจากการทำงานหน้าจอ
                  โดยหลีกเลี่ยงแสงสะท้อนที่อาจทำให้ตาล้า
                </li>
                <li>
                  ควรทำงานในห้องที่มีอุณหภูมิพอเหมาะ ไม่ร้อนหรือเย็นเกินไป
                  โดยควรรักษาอุณหภูมิในห้องให้อยู่ในระดับที่ทำให้ผู้ใช้งานรู้สึกสบาย
                  ซึ่งจะช่วยเพิ่มความสะดวกสบายในการทำงานและลดความเครียดจากสภาพแวดล้อม
                </li>
              </ul>
            </div>
          </section>
        </div>
        <div class="actions">
          <button class="btn btn-primary" id="toStretchingPage" type="button">
            ดูท่าบริหาร
          </button>
        </div>
      </div>
    </div>
    <!-- Stretching Exercise Page -->
    <div class="page stretching-page" id="stretchingPage">
      <div class="container">
        <h1>ท่าบริหาร</h1>
        <div
          style="
            background: #f5f5f5;
            border-radius: 10px;
            padding: 16px;
            color: #3d2c00;
            margin-bottom: 10px;
          "
        >
          <b>คำแนะนำ :</b> ท่าบริหารเหล่านี้ควรทำเป็นประจำ
          เพื่อช่วยลดอาการปวดเมื่อยล้าตามส่วนต่างๆ
          ของร่างกายที่ประสบปัญหาในการทำงาน
        </div>
        <div class="poses-row">
          <div class="pose-card">
            <img
              src="https://www.dropbox.com/scl/fi/oj5gx8akwaoe833mdjvta/1_20250818_192900_0000.png?rlkey=b8tqns6vi3o2dst7m235mg35u&st=so6ftx0z&dl=1"
              alt="ท่ายืดคอและไหล่"
            />
            <div>ท่าที่ 1 : ยืดกล้ามเนื้อบ่า</div>
          </div>
          <div class="pose-card">
            <img
              src="https://www.dropbox.com/scl/fi/ax0x9m9dbkyr39q2fhq6i/2_20250818_192900_0001.png?rlkey=9vwsxr8rgjv2v0bpvfpar6fjx&st=4y9q5dzv&dl=1"
              alt="ท่าหมุนไหล่"
            />
            <div>ท่าที่ 2 : ท่ายืดกล้ามเนื้อไหล่</div>
          </div>
          <div class="pose-card">
            <img
              src="https://www.dropbox.com/scl/fi/j7f118o7pc2n96tlckxyu/3_20250818_192900_0002.png?rlkey=aff81ul6ojogpyn4ogbc228jt&st=p03gh25d&dl=1"
              alt="ท่าเหยียดแขนและข้อมือ"
            />
            <div>ท่าที่ 3 : ยืดกล้ามเนื้อแขน</div>
          </div>
          <div class="pose-card">
            <img
              src="https://www.dropbox.com/scl/fi/hgze025rn8xxbvoxv8cqr/4_20250818_192900_0003.png?rlkey=d4fvv2b5po61rxpffi2xql9fv&st=4ozx7uvr&dl=1"
              alt="ท่ายืดหลังส่วนบน"
            />
            <div>ท่าที่ 4 : ยืดข้างลำตัว</div>
          </div>
          <div class="pose-card">
            <img
              src="https://www.dropbox.com/scl/fi/fdtzwm98ybh22xthtv8wm/5_20250818_192900_0004.png?rlkey=foijt0mjk55bxd5mz6fe08bo&st=y4urmbpa&dl=1"
              alt="ท่ายืดหลังส่วนล่าง"
            />
            <div>ท่าที่ 5 : ยืดหลัง-เอว</div>
          </div>
        </div>
        <div class="poses-row">
          <div class="pose-card">
            <img
              src="https://www.dropbox.com/scl/fi/f9xp1e6llixrwczy32sd2/6_20250819_201848_0005.png?rlkey=h2v7jkwamhrfzdyr7qtt8nmj3&st=landekyg&dl=1"
              alt="ท่ายืดคอและไหล่"
            />
            <div>ท่าที่ 6 : ท่าลดปวดหลัง ปวดสะบัก</div>
          </div>
          <div class="pose-card">
            <img
              src="https://www.dropbox.com/scl/fi/4njnagpcelw2ob27vxupo/7_20250819_201848_0006.png?rlkey=6i3d9dgv0a4m3ohss5cujt0q5&st=9k84s7en&dl=1"
              alt="ท่าหมุนไหล่"
            />
            <div>ท่าที่ 7 : ท่ายืดหลังล่าง</div>
          </div>
          <div class="pose-card">
            <img
              src="https://www.dropbox.com/scl/fi/e3mzx7g10edi61jb5brs2/8_20250819_201848_0007.png?rlkey=svre60gtfyjdv1ltr830ny3q6&st=6aff8jva&dl=1"
              alt="ท่าเหยียดแขนและข้อมือ"
            />
            <div>ท่าที่ 8 : ท่าปรับระบบขับถ่าย สะโพก</div>
          </div>
          <div class="pose-card">
            <img
              src="https://www.dropbox.com/scl/fi/jkfhlij532dnzptygu25r/9_20250819_201848_0008.png?rlkey=b9vefwxw64nl54nsr9a2jnhvf&st=ma1vj6z7&dl=1"
              alt="ท่ายืดหลังส่วนบน"
            />
            <div>ท่าที่ 9 : ท่ายืดหลัง</div>
          </div>
          <div class="pose-card">
            <img
              src="https://www.dropbox.com/scl/fi/jzatb3ugvm0wkjknlnqdt/10_20250819_201848_0009.png?rlkey=7djvk0ya178uml8fmiiqxujwy&st=15s7063e&dl=1"
              alt="ท่ายืดหลังส่วนล่าง"
            />
            <div>ท่าที่ 10 : ท่ายืดกล้ามเนื้อขา</div>
          </div>
        </div>
        <div class="video-section">
          <b>คลิปวิดีโอแนะนำท่าบริหาร</b>
          <br />
          <video width="400" height="225" controls>
            <source
              src="https://www.dropbox.com/scl/fi/93uiphfixx48ptpsva889/1755522605680.mp4?rlkey=2bvzp3bztj5z0x0lisndshrt2&st=tfcljpak&raw=1"
              type="video/mp4"
            />
            ไม่สามารถแสดงวิดีโอได้ กรุณาดูที่
            <a
              href="https://youtube.com/watch?v=8Qg_kZbATQo&si=uH3Y2TWNVMZ8X1UT"
              target="_blank"
              >ลิงค์นี้</a
            >
          </video>
          <br />
          <a
            href="https://youtube.com/watch?v=8Qg_kZbATQo&si=uH3Y2TWNVMZ8X1UT"
            target="_blank"
            style="color: #00509e; text-decoration: underline; font-size: 1em"
          >
            ดูคลิปวิดีโอขนาดเต็ม
          </a>
        </div>
        <div class="note">
          <b>หมายเหตุ:</b> ควรหยุดทันทีหากรู้สึกเจ็บมากผิดปกติ
          และปรึกษาแพทย์หรือนักกายภาพบำบัด
        </div>
        <div class="source-cite">
          ที่มา:
          <a
            href="https://www.avatarclinic.com/5-stretching-poses/"
            target="_blank"
            >www.avatarclinic.com/5-stretching-poses/</a
          >
          <a
            href="https://www.wongnai.com/articles/back-pain-treatment-at-home"
            target="_blank"
            >www.wongnai.com/articles/back-pain-treatment-at-home/</a
          >
        </div>
      </div>
      <br /><br /><br />
      <div class="qr-section">
        <h2>ขอเรียนเชิญแสกน QR Code</h2>
        <div class="qr-info">
          เพื่อเข้าร่วมกลุ่มไลน์สำหรับรับข้อมูลข่าวสาร
          และคลิปวิดีโอที่เป็นประโยชน์ <br />
          เกี่ยวกับ การรักษาท่าทางการทำงานที่ถูกต้อง และการดูแลสุขภาพ
        </div>
        <div class="qr-img-wrap">
          <div class="qr-img-box">
            <img
              src="https://www.dropbox.com/scl/fi/v3vu9hee9cexy6bsfajmy/1758775595673.jpg?rlkey=wd64hj0sq91umyv7kjtna8uuv&st=iz733v8e&dl=1"
              alt="QR Code สำหรับเข้าร่วมไลน์กลุ่ม"
            />
          </div>
        </div>
        <div class="qr-hint">
          หากต้องการเข้าร่วมกลุ่ม <br />ให้เปิดแอป LINE แล้วเลือกเมนู<br />
          <b>สแกน QR Code</b>
        </div>
      </div>
      <div class="btn-group">
        <button class="btn btn-secondary" id="backToSummary" type="button">
          กลับหน้าสรุปผล
        </button>
        <button class="btn" id="restartAssessment" type="button">บันทึก</button>
      </div>
    </div>
    <!-- Data Management Page -->
    <div class="page data-management-page" id="dataManagementPage">
      <div class="container">
        <h1>จัดการข้อมูลการประเมิน</h1>

        <div class="data-summary">
          <h2>สรุปข้อมูล</h2>
          <div class="summary-stats">
            <div class="stat-card">
              <div class="stat-number" id="totalAssessments">0</div>
              <div class="stat-label">การประเมินทั้งหมด</div>
            </div>
            <div class="stat-card">
              <div class="stat-number" id="highRiskCount">0</div>
              <div class="stat-label">ความเสี่ยงสูง</div>
            </div>
            <div class="stat-card">
              <div class="stat-number" id="lowRiskCount">0</div>
              <div class="stat-label">ความเสี่ยงต่ำ</div>
            </div>
          </div>
        </div>

        <div class="data-controls">
          <div class="search-container">
            <input
              type="text"
              id="searchInput"
              placeholder="ค้นหาอายุ, วันที่, แผนก..."
            />
            <i class="fas fa-search"></i>
          </div>

          <div class="filter-container">
            <label for="riskFilter">กรองตามความเสี่ยง:</label>
            <select id="riskFilter">
              <option value="all">ทั้งหมด</option>
              <option value="low">ความเสี่ยงต่ำ</option>
              <option value="high">ความเสี่ยงสูง</option>
            </select>

            <label for="dateFilter">กรองตามวันที่:</label>
            <select id="dateFilter">
              <option value="all">ทั้งหมด</option>
              <option value="today">วันนี้</option>
              <option value="week">สัปดาห์นี้</option>
              <option value="month">เดือนนี้</option>
            </select>
          </div>

          <div class="action-buttons">
            <button class="btn-action btn-export" id="exportCSV">
              ส่งออกข้อมูล (CSV)
            </button>
            <button class="btn-action btn-clear" id="clearAllData">
              ลบข้อมูลทั้งหมด
            </button>
            <button
              class="btn-action"
              id="refreshData"
              style="background-color: #17a2b8"
            >
              <i class="fas fa-sync-alt"></i> รีเฟรชข้อมูล
            </button>
          </div>
        </div>

        <div class="data-table-container">
          <!-- ตารางข้อมูลจะถูกสร้างโดย JavaScript -->
        </div>

        <div class="pagination" id="pagination">
          <!-- ปุ่มการแบ่งหน้าจะถูกสร้างโดย JavaScript -->
        </div>

        <div style="text-align: center; margin-top: 30px">
          <button class="btn" id="backToLanding">กลับสู่หน้าหลัก</button>
          <button class="btn" id="startNewAssessment">
            เริ่มการประเมินใหม่
          </button>
        </div>
      </div>
    </div>
    <!-- Modal for Assessment Details -->
    <div id="assessmentModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title">รายละเอียดผลการประเมิน</h2>
          <span class="close">&times;</span>
        </div>
        <div class="modal-body" id="modalBody">
          <!-- ข้อมูลรายละเอียดผลการประเมินจะถูกแสดงที่นี่ -->
        </div>
        <div class="modal-footer">
          <button class="btn-print" id="printAssessment">
            พิมพ์ผลการประเมิน
          </button>
          <button
            class="btn-detail"
            id="saveModalImage"
            style="background-color: #17a2b8"
          >
            💾 บันทึกรูปภาพ
          </button>
          <button class="btn-detail" id="closeModal">ปิด</button>
        </div>
      </div>
    </div>
    <script>
      // JavaScript code for ROSA assessment functionality
      let currentPage = "landingPage";
      let scores = {
        sectionA: 0,
        sectionB: 0,
        sectionC: 0,
        duration: 0,
      };

      // Timer variables
      let assessmentStartTime = null;
      let assessmentEndTime = null;

      // เพิ่มตัวแปรสำหรับจัดเก็บข้อมูลการประเมิน
      let assessmentData = [];

      // ตัวแปรสำหรับการแบ่งหน้า
      let currentPageIndex = 0;
      const itemsPerPage = 10;
      let filteredData = [];

      // เพิ่มตัวแปรสำหรับจัดการกับฐานข้อมูล (backend)
      const API_BASE_URL = "/api"; // เปลี่ยนเป็น URL ของ backend จริง // เปลี่ยนเป็น URL ของ backend จริง

      // เพิ่มฟังก์ชันสำหรับดึงข้อมูลจาก backend
      // ดึงข้อมูลจาก Backend API
      async function fetchAssessmentData() {
        try {
          const response = await fetch("https://me-check.vercel.app/api/assessments");
          if (!response.ok) {
            throw new Error("Failed to load data from server");
          }
          const data = await response.json();
          console.log(data.data);
          return data.data;
        } catch (error) {
          console.error("Error loading data from API:", error);
          // Fallback to localStorage if API fails
          const localData = localStorage.getItem("assessmentData");
          return localData ? JSON.parse(localData) : [];
        }
      }

      // บันทึกข้อมูลไปยัง Backend API
      async function saveAssessmentDataToBackend(assessmentRecord) {
        try {
          console.log("กำลังบันทึกข้อมูลไปยัง Backend...");
          const response = await fetch(
            "https://me-check.vercel.app/api/assessments",
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(assessmentRecord),
            }
          );

          if (!response.ok) {
            throw new Error("Failed to save data to server");
          }

          const result = await response.json();
          console.log("บันทึกข้อมูลสำเร็จ:", result);
          return true;
        } catch (error) {
          console.error("Error saving data to API:", error);
          // Fallback to localStorage if API fails
          const localData = JSON.parse(
            localStorage.getItem("assessmentData") || "[]"
          );
          localData.push(assessmentRecord);
          localStorage.setItem("assessmentData", JSON.stringify(localData));
          console.log("บันทึกข้อมูลใน localStorage สำเร็จ (Fallback)");
          return false;
        }
      }

      // ลบข้อมูลทั้งหมดจาก Backend API
      async function deleteAllAssessmentData() {
        try {
          console.log("กำลังลบข้อมูลจาก Backend...");
          const response = await fetch(
            "https://me-check.vercel.app/api/assessments",
            {
              method: "DELETE",
            }
          );

          if (!response.ok) {
            throw new Error("Failed to delete data from server");
          }

          const result = await response.json();
          console.log("ลบข้อมูลทั้งหมดสำเร็จ:", result);

          // Also clear localStorage
          localStorage.removeItem("assessmentData");

          return true;
        } catch (error) {
          console.error("Error deleting data from API:", error);
          // Fallback to localStorage if API fails
          localStorage.removeItem("assessmentData");
          console.log("ลบข้อมูลใน localStorage สำเร็จ (Fallback)");
          return false;
        }
      }

      // เพิ่มฟังก์ชันโหลดข้อมูลจาก localStorage
      async function loadStoredData() {
        console.log("กำลังโหลดข้อมูลการประเมิน...");

        assessmentData = await fetchAssessmentData();
        filteredData = [...assessmentData];
        updateDataManagementPage();
      }

      // เพิ่มฟังก์ชันค้นหาและกรองข้อมูล
      function filterData() {
        const searchTerm = document
          .getElementById("searchInput")
          .value.toLowerCase();
        const riskFilter = document.getElementById("riskFilter").value;
        const dateFilter = document.getElementById("dateFilter").value;

        filteredData = assessmentData.filter((item) => {
          // ค้นหาตามคำค้นหา
          const matchesSearch =
            searchTerm === "" ||
            item.age.toLowerCase().includes(searchTerm) ||
            item.department.toLowerCase().includes(searchTerm) ||
            item.affiliation.toLowerCase().includes(searchTerm) ||
            item.date.includes(searchTerm);

          // กรองตามระดับความเสี่ยง
          const matchesRisk =
            riskFilter === "all" ||
            (riskFilter === "high" && item.finalScore >= 5) ||
            (riskFilter === "low" && item.finalScore < 5);

          // กรองตามวันที่
          let matchesDate = true;
          if (dateFilter !== "all") {
            const itemDate = new Date(item.date);
            const today = new Date();

            switch (dateFilter) {
              case "today":
                matchesDate = itemDate.toDateString() === today.toDateString();
                break;
              case "week":
                const weekAgo = new Date(today);
                weekAgo.setDate(weekAgo.getDate() - 7);
                matchesDate = itemDate >= weekAgo;
                break;
              case "month":
                const monthAgo = new Date(today);
                monthAgo.setMonth(monthAgo.getMonth() - 1);
                matchesDate = itemDate >= monthAgo;
                break;
            }
          }

          return matchesSearch && matchesRisk && matchesDate;
        });

        currentPageIndex = 0;
        renderTable();
        renderPagination();
      }

      // เพิ่มฟังก์ชันแสดงตารางข้อมูล
      function renderTable() {
        const container = document.querySelector(".data-table-container");
        if (!container) return;

        if (filteredData.length === 0) {
          container.innerHTML = `<div class="empty-state">
          <img src="https://cdn-icons-png.flaticon.com/512/4076/4076549.png">
          <h3>ไม่มีข้อมูลการประเมิน</h3>
          <p>ไม่พบข้อมูลการประเมิน ROSA ที่ตรงกับเงื่อนไขการค้นหา</p>
        </div>`;
          return;
        }

        const startIndex = currentPageIndex * itemsPerPage;
        const endIndex = Math.min(
          startIndex + itemsPerPage,
          filteredData.length
        );
        const pageData = filteredData.slice(startIndex, endIndex);

        let tableHtml = `<table class="data-table"><thead><tr>
        <th>วันที่</th><th>เวลา</th><th>อายุ</th><th>เพศ</th>
        <th>อายุงาน</th><th>แผนก</th><th>สังกัด</th><th>Section A</th><th>Section B</th><th>Section C</th>
        <th>ระยะเวลา</th><th>ROSA</th><th>ความเสี่ยง</th>
        <th>คอ</th><th>ไหล่</th><th>หลังบน</th><th>หลังล่าง</th><th>แขน</th><th>มือ</th><th>สะโพก</th><th>เข่า</th><th>น่อง</th><th>เท้า</th><th>เวลาประเมิน</th>
        <th>การดำเนินการ</th>
      </tr></thead><tbody>`;

        pageData.forEach((item, index) => {
          // กำหนดสีสำหรับระดับความเสี่ยง ROSA
          const rosaRiskClass = item.finalScore >= 5 ? "risk-high" : "risk-low";
          const rosaRiskText = item.finalScore >= 5 ? "สูง" : "ต่ำ";

          // กำหนดสีสำหรับระดับความเสี่ยงอาการปวด
          let painRiskClass = "risk-low";
          if (item.painRiskLevel === "สูง") {
            painRiskClass = "risk-high";
          } else if (item.painRiskLevel === "ปานกลาง") {
            painRiskClass = "risk-medium";
          }

          const actualIndex = assessmentData.findIndex(
            (a) =>
              a.date === item.date && a.time === item.time && a.age === item.age
          );

          // Get individual body part scores from painAssessmentDetails
          const bodyPartScores = {
            neck: 0,
            shoulder: 0,
            upperback: 0,
            lowerback: 0,
            arm: 0,
            hand: 0,
            hip: 0,
            knee: 0,
            calf: 0,
            foot: 0,
          };

          if (
            item.painAssessmentDetails &&
            Array.isArray(item.painAssessmentDetails)
          ) {
            item.painAssessmentDetails.forEach((part) => {
              bodyPartScores[part.part] = part.risk;
            });
          }

          tableHtml += `<tr>
          <td>${item.date}</td>
          <td>${item.time}</td>
          <td>${item.age}</td>
          <td>${
            item.gender === "male"
              ? "ชาย"
              : item.gender === "female"
              ? "หญิง"
              : "อื่นๆ"
          }</td>
          <td>${item.jobDuration || "-"}</td>
          <td>${item.department || "-"}</td>
          <td>${item.affiliation || "-"}</td>
          <td>${item.sectionA}</td>
          <td>${item.sectionB}</td>
          <td>${item.sectionC}</td>
          <td>${item.duration}</td>
          <td><strong>${item.finalScore}</strong></td>
          <td><span class="risk-badge ${rosaRiskClass}">${rosaRiskText}</span></td>
          <td>${bodyPartScores.neck || "-"}</td>
          <td>${bodyPartScores.shoulder || "-"}</td>
          <td>${bodyPartScores.upperback || "-"}</td>
          <td>${bodyPartScores.lowerback || "-"}</td>
          <td>${bodyPartScores.arm || "-"}</td>
          <td>${bodyPartScores.hand || "-"}</td>
          <td>${bodyPartScores.hip || "-"}</td>
          <td>${bodyPartScores.knee || "-"}</td>
          <td>${bodyPartScores.calf || "-"}</td>
          <td>${bodyPartScores.foot || "-"}</td>
          <td>${item.assessmentTime || "-"}</td>
          <td>
            <button class="btn-detail" onclick="showAssessmentDetails(${actualIndex})" style="margin-bottom: 5px;">ดูรายละเอียด</button><br>
            <button class="btn-detail" onclick="showFullAssessmentResults(${actualIndex})" style="background-color: #28a745;">ดูผลการประเมิน</button><br>
            <button class="btn-detail" onclick="saveAssessmentImage(${actualIndex})" style="background-color: #17a2b8; margin-top: 5px;">💾 บันทึกรูปภาพ</button>
          </td>
        </tr>`;
        });

        tableHtml += `</tbody></table>`;
        container.innerHTML = tableHtml;
      }

      // เพิ่มฟังก์ชันแสดงปุ่มการแบ่งหน้า
      function renderPagination() {
        const paginationContainer = document.getElementById("pagination");
        if (!paginationContainer) return;

        const totalPages = Math.ceil(filteredData.length / itemsPerPage);

        if (totalPages <= 1) {
          paginationContainer.innerHTML = "";
          return;
        }

        let paginationHTML = "";

        // ปุ่มก่อนหน้า
        paginationHTML += `<button ${
          currentPageIndex === 0 ? "disabled" : ""
        } onclick="changePage(${currentPageIndex - 1})">
        <i class="fas fa-chevron-left"></i> ก่อนหน้า
      </button>`;

        // แสดงหมายเลขหน้า
        for (let i = 0; i < totalPages; i++) {
          if (
            i === 0 ||
            i === totalPages - 1 ||
            (i >= currentPageIndex - 1 && i <= currentPageIndex + 1)
          ) {
            paginationHTML += `<button class="${
              i === currentPageIndex ? "active" : ""
            }" onclick="changePage(${i})">${i + 1}</button>`;
          } else if (i === currentPageIndex - 2 || i === currentPageIndex + 2) {
            paginationHTML += `<span>...</span>`;
          }
        }

        // ปุ่มถัดไป
        paginationHTML += `<button ${
          currentPageIndex === totalPages - 1 ? "disabled" : ""
        } onclick="changePage(${currentPageIndex + 1})">
        ถัดไป <i class="fas fa-chevron-right"></i>
      </button>`;

        paginationContainer.innerHTML = paginationHTML;
      }

      // เพิ่มฟังก์ชันเปลี่ยนหน้า
      function changePage(pageIndex) {
        currentPageIndex = pageIndex;
        renderTable();
        renderPagination();
      }

      // เพิ่มฟังก์ชันแสดงข้อมูลในหน้า "จัดการข้อมูล"
      function updateDataManagementPage() {
        const page = document.getElementById("dataManagementPage");
        if (!page) return;

        // Update summary statistics
        document.getElementById("totalAssessments").textContent =
          assessmentData.length;
        document.getElementById("highRiskCount").textContent =
          assessmentData.filter((item) => item.finalScore >= 5).length;
        document.getElementById("lowRiskCount").textContent =
          assessmentData.filter((item) => item.finalScore < 5).length;

        // เรียกใช้ฟังก์ชันค้นหาและกรองข้อมูลเพื่อแสดงผล
        filterData();
      }

      // เพิ่มฟังก์ชันบันทึกผลการประเมิน
      async function saveAssessmentResults() {
        // ดึงข้อมูลจากฟอร์ม
        const age = document.getElementById("age").value.trim();
        const gender = document.getElementById("gender").value;
        const jobDuration = document.getElementById("jobDuration").value.trim();
        const department = document.getElementById("department").value.trim();
        const affiliation = document.getElementById("affiliation").value.trim();

        // ดึงคะแนนจาก summary page
        const sectionA = document.getElementById("summaryScoreA").textContent;
        const sectionB = document.getElementById("summaryScoreB").textContent;
        const sectionC = document.getElementById("summaryScoreC").textContent;
        const duration = document.getElementById("summaryDuration").textContent;
        const finalScore = document.getElementById("finalScore").textContent;

        // คำนวณและดึงข้อมูลอาการปวดแบบละเอียด
        const painAssessmentDetails = calculatePainAssessmentScore();

        // ดึงระดับความเสี่ยงจาก element
        const totalRiskLevelElem = document.getElementById("totalRiskLevel");
        const painRiskLevel = totalRiskLevelElem
          ? totalRiskLevelElem.textContent
          : painAssessmentDetails.riskLevel;

        // ดึงคะแนนรวมอาการปวด
        const painAssessmentScore =
          painAssessmentDetails.totalRiskScore.toString();

        // ดึงรายละเอียดการประเมินอาการปวด
        const painCalculationDetailsElem = document.getElementById(
          "painCalculationDetails"
        );
        const painCalculationDetails = painCalculationDetailsElem
          ? painCalculationDetailsElem.innerHTML
          : "";

        const painCauseAnalysisElem =
          document.getElementById("painCauseAnalysis");
        const painCauseAnalysis = painCauseAnalysisElem
          ? painCauseAnalysisElem.textContent
          : "";

        // ดึงอวัยวะที่มีความเสี่ยงสูงสุด 3 อันดับแรก
        const topRiskBodyPartsElem =
          document.getElementById("topRiskBodyParts");
        const topRiskBodyParts = topRiskBodyPartsElem
          ? topRiskBodyPartsElem.textContent
          : "-";

        // เวลาบันทึก
        const now = new Date();
        const date = now.toLocaleDateString("th-TH");
        const time = now.toLocaleTimeString("th-TH");
        const parts = calculatePainAssessmentScore();
        // เวลาที่ใช้ในการประเมิน
        const assessmentTime = calculateAssessmentTime();

        // สร้าง object สำหรับบันทึก
        const assessmentRecord = {
          id: Date.now(),
          date,
          time,
          age,
          gender,
          jobDuration,
          department,
          affiliation,
          sectionA,
          sectionB,
          sectionC,
          duration,
          finalScore,
          painAssessmentScore : parts.totalRiskScore,
          painRiskLevel: parts.riskLevel,
          painCalculationDetails : parts.detailedBreakdown,
          painCauseAnalysis,
          painAssessmentDetails: parts.affectedParts, // บันทึกรายละเอียดแต่ละอวัยวะ
          topRiskBodyParts,
          assessmentTime,
        };

        // บันทึกข้อมูลลง backend (จำลองด้วย localStorage)
        const success = await saveAssessmentDataToBackend(assessmentRecord);

        if (success) {
          updateDataManagementPage();
          showSuccessMessage("บันทึกข้อมูลเรียบร้อยแล้ว");

          // Log สำหรับ debug
          console.log("บันทึกข้อมูลสำเร็จ:", assessmentRecord);
        } else {
          showErrorMessage("เกิดข้อผิดพลาดในการบันทึกข้อมูล");
        }
      }

      // เพิ่มฟังก์ชันแสดงข้อความสำเร็จ
      function showSuccessMessage(msg) {
        const div = document.createElement("div");
        div.className = "success-message";
        div.textContent = msg;
        document.body.appendChild(div);
        setTimeout(() => div.remove(), 2500);
      }

      // Timer functions
      function startAssessmentTimer() {
        assessmentStartTime = new Date();
      }

      function calculateAssessmentTime() {
        if (assessmentStartTime) {
          assessmentEndTime = new Date();
          const elapsedMs = assessmentEndTime - assessmentStartTime;
          return formatTime(elapsedMs);
        }
        return "00:00:00";
      }

      function formatTime(milliseconds) {
        const totalSeconds = Math.floor(milliseconds / 1000);
        const hours = Math.floor(totalSeconds / 3600);
        const minutes = Math.floor((totalSeconds % 3600) / 60);
        const seconds = totalSeconds % 60;

        return `${hours.toString().padStart(2, "0")}:${minutes
          .toString()
          .padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`;
      }

      // Validation function for personal information
      function validatePersonalInfo() {
        const age = document.getElementById("age").value.trim();
        const gender = document.getElementById("gender").value;
        const jobDuration = document.getElementById("jobDuration").value.trim();
        const department = document.getElementById("department").value.trim();
        const affiliation = document.getElementById("affiliation").value.trim();

        // Remove any existing error messages
        removeErrorMessages();

        let isValid = true;
        let errorFields = [];

        // Check if all fields are filled
        if (!age) {
          errorFields.push("อายุ");
          highlightErrorField("age");
          isValid = false;
        }
        if (!gender) {
          errorFields.push("เพศ");
          highlightErrorField("gender");
          isValid = false;
        }
        if (!jobDuration) {
          errorFields.push("อายุงาน");
          highlightErrorField("jobDuration");
          isValid = false;
        }
        if (!department) {
          errorFields.push("แผนก");
          highlightErrorField("department");
          isValid = false;
        }
        if (!affiliation) {
          errorFields.push("สังกัด");
          highlightErrorField("affiliation");
          isValid = false;
        }

        // Show error message if validation fails
        if (!isValid) {
          showErrorMessage(
            `กรุณากรอกข้อมูลให้ครบถ้วน: ${errorFields.join(", ")}`
          );
          return false;
        }

        return true;
      }

      // Function to remove error styling
      function removeErrorMessages() {
        // Remove error styling from all input fields
        const fields = [
          "age",
          "gender",
          "jobDuration",
          "department",
          "affiliation",
        ];
        fields.forEach((fieldId) => {
          const field = document.getElementById(fieldId);
          if (field) {
            field.style.borderColor = "";
            field.style.boxShadow = "";
          }
        });

        // Remove any existing error message
        const existingError = document.getElementById("validationError");
        if (existingError) {
          existingError.remove();
        }
      }

      // Function to highlight error fields
      function highlightErrorField(fieldId) {
        const field = document.getElementById(fieldId);
        if (field) {
          field.style.borderColor = "#ff4444";
          field.style.boxShadow = "0 0 5px rgba(255, 68, 68, 0.3)";
        }
      }

      // Function to show error message
      function showErrorMessage(message) {
        // Remove any existing error message first
        removeErrorMessages();

        // Create and show new error message
        const errorDiv = document.createElement("div");
        errorDiv.id = "validationError";
        errorDiv.style.cssText = `
        background-color: #ffe6e6;
        color: #cc0000;
        padding: 12px;
        border-radius: 8px;
        margin: 15px 0;
        border: 1px solid #ff9999;
        font-weight: bold;
        text-align: center;
        animation: shake 0.5s ease-in-out;
      `;
        errorDiv.textContent = message;

        // Insert error message after the form
        const form = document.getElementById("personalInfoForm");
        if (form && form.parentNode) {
          form.parentNode.insertBefore(errorDiv, form.nextSibling);
        } else {
          // Fallback: append to personal info content if form not found
          const personalInfoContent = document.getElementById(
            "personalInfoContent"
          );
          if (personalInfoContent) {
            personalInfoContent.appendChild(errorDiv);
          }
        }

        // Auto-remove error message after 5 seconds
        setTimeout(() => {
          if (errorDiv.parentNode) {
            errorDiv.remove();
          }
        }, 5000);
      }

      // Page navigation functions
      function showPage(pageId) {
        document.querySelectorAll(".page").forEach((page) => {
          page.classList.remove("active");
        });

        const targetPage = document.getElementById(pageId);
        if (targetPage) {
          targetPage.classList.add("active");
          currentPage = pageId;
          updateProgressBar();
        }
      }

      function updateProgressBar() {
        const progressFill = document.getElementById("progressBarFill");
        let progress = 0;

        switch (currentPage) {
          case "landingPage":
            progress = 0;
            break;
          case "assessmentPage":
            if (
              document.getElementById("personalInfoContent") &&
              document.getElementById("personalInfoContent").style.display !==
                "none"
            ) {
              progress = 10;
            } else if (
              document.getElementById("userGuideContent") &&
              document.getElementById("userGuideContent").style.display !==
                "none"
            ) {
              progress = 15;
            } else if (
              document.getElementById("sectionAContent") &&
              document.getElementById("sectionAContent").style.display !==
                "none"
            ) {
              progress = 25;
            } else if (
              document.getElementById("sectionBContent") &&
              document.getElementById("sectionBContent").style.display !==
                "none"
            ) {
              progress = 40;
            } else if (
              document.getElementById("sectionCContent") &&
              document.getElementById("sectionCContent").style.display !==
                "none"
            ) {
              progress = 60;
            } else if (
              document.getElementById("durationContent") &&
              document.getElementById("durationContent").style.display !==
                "none"
            ) {
              progress = 75;
            } else if (
              document.getElementById("painAssessmentContent") &&
              document.getElementById("painAssessmentContent").style.display !==
                "none"
            ) {
              progress = 90;
            }
            break;
          case "summaryPage":
            progress = 100;
            break;
          case "stretchingPage":
            progress = 100;
            break;
          case "dataManagementPage":
            progress = 0;
            break;
        }

        if (progressFill) {
          progressFill.style.width = progress + "%";
        }
      }

      // ROSA Lookup Tables for proper scoring
      const rosaLookupTables = {
        // Matrix 1: Chair (Section A) - Arm Support vs Chair Height
        matrix1: [
          [1, 2, 3, 4, 5, 6, 7, 8],
          [2, 2, 3, 4, 5, 6, 7, 8],
          [3, 3, 3, 4, 5, 6, 7, 8],
          [4, 4, 4, 4, 5, 6, 7, 8],
          [5, 5, 5, 5, 5, 6, 7, 8],
          [6, 6, 6, 6, 6, 6, 7, 8],
          [7, 7, 7, 7, 7, 7, 7, 8],
        ],

        // Matrix 2: Monitor and Phone (Section B) - Phone vs Screen
        matrix2: [
          [1, 1, 2, 2, 3, 3, 4, 4],
          [1, 1, 2, 2, 3, 3, 4, 4],
          [2, 2, 3, 3, 4, 4, 5, 5],
          [2, 2, 3, 3, 4, 4, 5, 5],
          [3, 3, 4, 4, 5, 5, 6, 6],
          [3, 3, 4, 4, 5, 5, 6, 6],
          [4, 4, 5, 5, 6, 6, 7, 7],
          [4, 4, 5, 5, 6, 6, 7, 7],
          [5, 5, 6, 6, 7, 7, 8, 8],
          [5, 5, 6, 6, 7, 7, 8, 8],
          [6, 6, 7, 7, 8, 8, 9, 9],
        ],

        // Matrix 3: Mouse and Keyboard (Section C) - Mouse vs Keyboard
        matrix3: [
          [1, 1, 2, 2, 3, 3, 4],
          [1, 1, 2, 2, 3, 3, 4],
          [2, 2, 3, 3, 4, 4, 5],
          [2, 2, 3, 3, 4, 4, 5],
          [3, 3, 4, 4, 5, 5, 6],
          [3, 3, 4, 4, 5, 5, 6],
          [4, 4, 5, 5, 6, 6, 7],
        ],

        // Matrix 4: Peripherals (Section D) - Screen vs Keyboard
        matrix4: [
          [1, 2, 3, 4, 5, 6, 7, 8, 9],
          [2, 2, 3, 4, 5, 6, 7, 8, 9],
          [3, 3, 3, 4, 5, 6, 7, 8, 9],
          [4, 4, 4, 4, 5, 6, 7, 8, 9],
          [5, 5, 5, 5, 5, 6, 7, 8, 9],
          [6, 6, 6, 6, 6, 6, 7, 8, 9],
          [7, 7, 7, 7, 7, 7, 7, 8, 9],
          [8, 8, 8, 8, 8, 8, 8, 8, 9, 10],
          [9, 9, 9, 9, 9, 9, 9, 9, 9, 10],
          [10, 10, 10, 10, 10, 10, 10, 10, 10, 10],
        ],

        // Matrix 5: Final Score - Chair (A) vs Peripherals (D)
        matrix5: [
          [1, 2, 3, 4, 5, 6, 7, 8, 9, 10],
          [2, 2, 3, 4, 5, 6, 7, 8, 9, 10],
          [3, 3, 3, 4, 5, 6, 7, 8, 9, 10],
          [4, 4, 4, 4, 5, 6, 7, 8, 9, 10],
          [5, 5, 5, 5, 5, 6, 7, 8, 9, 10],
          [6, 6, 6, 6, 6, 6, 7, 8, 9, 10],
          [7, 7, 7, 7, 7, 7, 7, 8, 9, 10],
          [8, 8, 8, 8, 8, 8, 8, 8, 9, 10],
          [9, 9, 9, 9, 9, 9, 9, 9, 9, 10],
          [10, 10, 10, 10, 10, 10, 10, 10, 10, 10],
        ],
      };

      // Score calculation functions
      function calculateSectionScore(sectionId) {
        const section = document.getElementById(sectionId);
        if (!section) return 0;

        const checkboxes = section.querySelectorAll(
          'input[type="checkbox"]:checked'
        );
        let score = 0;

        checkboxes.forEach((checkbox) => {
          score += parseInt(checkbox.dataset.score) || 0;
        });

        return score;
      }

      // Matrix lookup function (1-based indexing)
      function matrixLookup(matrix, row, col) {
        const rowIndex = Math.min(Math.max(row - 1, 0), matrix.length - 1);
        const colIndex = Math.min(Math.max(col - 1, 0), matrix[0].length - 1);
        return matrix[rowIndex][colIndex];
      }

      // Calculate ROSA score using proper methodology
      function calculateROSAScore(
        armSupport,
        chairHeight,
        phoneScore,
        screenScore,
        mouseScore,
        keyboardScore
      ) {
        // Section A: Chair (Arm Support vs Chair Height)
        const sectionA = matrixLookup(
          rosaLookupTables.matrix1,
          armSupport,
          chairHeight
        );

        // Section B: Monitor and Phone (Phone vs Screen)
        const sectionB = matrixLookup(
          rosaLookupTables.matrix2,
          phoneScore,
          screenScore
        );

        // Section C: Mouse and Keyboard (Mouse vs Keyboard)
        const sectionC = matrixLookup(
          rosaLookupTables.matrix3,
          mouseScore,
          keyboardScore
        );

        // Section D: Peripherals (Screen vs Keyboard)
        const sectionD = matrixLookup(
          rosaLookupTables.matrix4,
          screenScore,
          keyboardScore
        );

        // Final Score: Chair (A) vs Peripherals (D)
        const finalScore = matrixLookup(
          rosaLookupTables.matrix5,
          sectionA,
          sectionD
        );

        return {
          sectionA: sectionA,
          sectionB: sectionB,
          sectionC: sectionC,
          sectionD: sectionD,
          finalScore: finalScore,
          highRisk: finalScore >= 5,
        };
      }

      function updateScoreDisplay(sectionName, score) {
        const scoreElement = document.getElementById(sectionName + "Score");
        if (scoreElement) {
          scoreElement.textContent = score;
        }

        const totalElement = document.getElementById(
          "totalScore" +
            sectionName.charAt(sectionName.length - 1).toUpperCase()
        );
        if (totalElement) {
          totalElement.textContent = `คะแนนรวม Section ${sectionName
            .charAt(sectionName.length - 1)
            .toUpperCase()}: ${score}`;
        }
      }

      // Display recommendations based on risk level
      function displayRecommendations(totalScore) {
        const lowRec = document.getElementById("lowScoreRecommendation");
        const highRec = document.getElementById("highScoreRecommendation");
        const resultContainer = document.getElementById("resultContainer");
        const scoreDisplay = document.getElementById("finalScore");
        const riskDisplay = document.getElementById("riskLevel");

        // ROSA risk levels: 1 = no risk, 2-4 = low risk, 5+ = high risk
        if (totalScore <= 4) {
          // Low risk (scores 1-4)
          if (lowRec) lowRec.style.display = "block";
          if (highRec) highRec.style.display = "none";

          if (resultContainer)
            resultContainer.className = "auto-result low-risk";
          if (scoreDisplay) scoreDisplay.className = "score-display low-risk";
          if (riskDisplay) {
            riskDisplay.textContent = "ระดับความเสี่ยง: ต่ำ";
            riskDisplay.className = "risk-display risk-low";
          }
        } else {
          // High risk (scores 5+)
          if (lowRec) lowRec.style.display = "none";
          if (highRec) highRec.style.display = "block";

          if (resultContainer)
            resultContainer.className = "auto-result high-risk";
          if (scoreDisplay) scoreDisplay.className = "score-display high-risk";
          if (riskDisplay) {
            riskDisplay.textContent = "ระดับความเสี่ยง: สูง";
            riskDisplay.className = "risk-display risk-high";
          }
        }
      }

      // Function to update pain assessment table display
      function updatePainAssessmentTable(painAssessment) {
        const tableBody = document.getElementById("painScoreTableBody");
        if (!tableBody) return;

        // อัปเดตระดับความเสี่ยงรวม
        const totalRiskScoreElem = document.getElementById("totalRiskScore");
        const totalRiskLevelElem = document.getElementById("totalRiskLevel");
        const totalRiskScore = painAssessment.totalRiskScore;

        // อัปเดตคะแนนรวม
        if (totalRiskScoreElem) {
          totalRiskScoreElem.textContent = totalRiskScore;
        }

        // อัปเดตระดับความเสี่ยงและสีพื้นหลัง (ใช้สไตล์จาก pain-risk-summary.html)
        if (totalRiskLevelElem) {
          let riskLevel = "";
          let bgColor = "#ccc";

          if (totalRiskScore >= 10) {
            riskLevel = "สูง";
            bgColor = "#c0392b"; // สีแดงเข้ม
          } else if (totalRiskScore >= 5) {
            riskLevel = "ปานกลาง";
            bgColor = "#ff9800"; // สีส้ม
          } else if (totalRiskScore >= 1) {
            riskLevel = "ต่ำ";
            bgColor = "#f7c948"; // สีเหลือง
          } else {
            riskLevel = "ไม่มีความเสี่ยง";
            bgColor = "#ccc";
          }

          totalRiskLevelElem.textContent = riskLevel;
          totalRiskLevelElem.style.backgroundColor = bgColor;
          totalRiskLevelElem.style.color = "#ffffff";
          totalRiskLevelElem.style.padding = "4px 12px";
          totalRiskLevelElem.style.borderRadius = "6px";
          totalRiskLevelElem.style.fontWeight = "bold";
        }

        // อัปเดตอวัยวะที่มีความเสี่ยงสูงสุด 3 อันดับแรก พร้อมสี
        const topRiskBodyPartsElem =
          document.getElementById("topRiskBodyParts");
        if (topRiskBodyPartsElem) {
          const sortedParts = [...painAssessment.affectedParts]
            .sort((a, b) => b.risk - a.risk)
            .slice(0, 3);

          if (sortedParts.length > 0) {
            // ฟังก์ชันกำหนดสีตามคะแนนความเสี่ยง
            const getRiskColor = (score) => {
              if (score >= 10) return "#c0392b"; // สูง - แดง
              if (score >= 5) return "#ff9800"; // ปานกลาง - ส้ม
              if (score >= 1) return "#c39a2b"; // ต่ำ - เหลืองเข้ม
              return "#666";
            };

            topRiskBodyPartsElem.innerHTML = sortedParts
              .map(
                (item) =>
                  `<span style="color:${getRiskColor(item.risk)}">${
                    item.partName
                  }</span>`
              )
              .join(", ");
          } else {
            topRiskBodyPartsElem.textContent = "-";
          }
        }

        // Clear existing rows
        tableBody.innerHTML = "";

        if (painAssessment.affectedParts.length === 0) {
          // Show no data message
          const noDataRow = document.createElement("tr");
          noDataRow.innerHTML = `
          <td colspan="6" style="padding: 20px; text-align: center; color: #666; border: 1px solid #ddd;">
            ไม่มีข้อมูลอาการปวด/ชา/เมื่อยล้า
          </td>
        `;
          tableBody.appendChild(noDataRow);
        } else {
          // Add rows for each affected body part
          painAssessment.affectedParts.forEach((part) => {
            // กำหนดสีตามคะแนนความเสี่ยง
            let riskColor = "#000000"; // ตัวอักษรสีดำทั้งหมด
            let riskBgColor = "";

            if (part.risk >= 10) {
              // คะแนน 10+: ตัวอักษรสีดำ พื้นหลังสีแดง (สูง)
              riskBgColor = "#ff0000";
            } else if (part.risk >= 5) {
              // คะแนน 5-9: ตัวอักษรสีดำ พื้นหลังสีส้ม (ปานกลาง)
              riskBgColor = "#ffa500";
            } else if (part.risk >= 1) {
              // คะแนน 1-4: ตัวอักษรสีดำ พื้นหลังสีเหลืองอ่อน (ต่ำ)
              riskBgColor = "#ffff99";
            }

            const row = document.createElement("tr");
            row.innerHTML = `
            <td style="padding: 12px; text-align: center; border: 1px solid #ddd; font-weight: bold;">${part.partName}</td>
            <td style="padding: 12px; text-align: center; border: 1px solid #ddd;">${part.severityName}</td>
            <td style="padding: 12px; text-align: center; border: 1px solid #ddd; font-weight: bold; color: #ff6b35;">${part.severity}</td>
            <td style="padding: 12px; text-align: center; border: 1px solid #ddd;">${part.frequencyName}</td>
            <td style="padding: 12px; text-align: center; border: 1px solid #ddd; font-weight: bold; color: #ff6b35;">${part.frequency}</td>
            <td style="padding: 12px; text-align: center; border: 1px solid #ddd; font-weight: bold; color: ${riskColor}; background-color: ${riskBgColor};">${part.risk}</td>
          `;
            tableBody.appendChild(row);
          });
        }
      }

      // Function to calculate pain assessment score
      function calculatePainAssessmentScore() {
        const bodyParts = [
          "neck",
          "shoulder",
          "upperback",
          "lowerback",
          "arm",
          "hand",
          "hip",
          "knee",
          "calf",
          "foot",
        ];
        const bodyPartNames = {
          neck: "คอ",
          shoulder: "ไหล่",
          upperback: "หลังส่วนบน",
          lowerback: "หลังส่วนล่าง",
          arm: "แขน",
          hand: "มือ/ข้อมือ",
          hip: "สะโพก",
          knee: "เข่า",
          calf: "น่อง",
          foot: "เท้า",
        };
        const severityValues = { severity : 1, mild: 1, mod: 2, severe: 3, extreme: 4 };
        const severityNames = {
          severity : "ไม่มีอาการปวด",
          mild: "เล็กน้อย",
          mod: "ปานกลาง",
          severe: "มาก",
          extreme: "มากเกินทนไหว",
        };
        const frequencyValues = { "1_2wk": 1, "3_4wk": 2, daily: 3, often: 4 };
        const frequencyNames = {
          "1_2wk": "1-2 ครั้ง/สัปดาห์",
          "3_4wk": "3-4 ครั้ง/สัปดาห์",
          daily: "ทุกวัน",
          often: "บ่อยครั้งในวัน",
        };

        let totalRiskScore = 0;
        let affectedParts = [];
        let detailedBreakdown = [];

        bodyParts.forEach((part) => {
          let severityScore = 0;
          let frequencyScore = 0;
          let severityKey = "";
          let frequencyKey = "";

          // Check severity
          Object.keys(severityValues).forEach((severity) => {
            const checkbox = document.querySelector(
              `input[name="${part}_${severity}"]`
            );
            if (checkbox && checkbox.checked) {
              severityScore = severityValues[severity];
              severityKey = severity;
            }
          });

          // Check frequency
          Object.keys(frequencyValues).forEach((frequency) => {
            const checkbox = document.querySelector(
              `input[name="${part}_${frequency}"]`
            );
            if (checkbox && checkbox.checked) {
              frequencyScore = frequencyValues[frequency];
              frequencyKey = frequency;
            }
          });

          // Calculate risk score for this body part (severity × frequency)
          if (severityScore > 0 && frequencyScore > 0) {
            const partRiskScore = severityScore * frequencyScore;
            totalRiskScore += partRiskScore;
            affectedParts.push({
              part: part,
              partName: bodyPartNames[part],
              severity: severityScore,
              frequency: frequencyScore,
              severityName: severityNames[severityKey],
              frequencyName: frequencyNames[frequencyKey],
              risk: partRiskScore,
            });

            detailedBreakdown.push(
              `${bodyPartNames[part]}: ${severityNames[severityKey]} × ${frequencyNames[frequencyKey]} = ${partRiskScore} คะแนน`
            );
          }
        });

        return {
          totalRiskScore: totalRiskScore,
          affectedParts: affectedParts,
          detailedBreakdown: detailedBreakdown,
          riskLevel:
            totalRiskScore >= 10
              ? "สูง"
              : totalRiskScore >= 5
              ? "ปานกลาง"
              : "ต่ำ",
        };
      }

      // Function to analyze pain cause (Q3 and Q4)
      function analyzePainCause() {
        // Check question 3 - work-related causes (ข้อ 3)
        const q3Value = document.querySelector(
          'input[name="q3"]:checked'
        )?.value;
        const q3Area =
          document.querySelector('input[name="q3_area"]')?.value || "";

        // Check question 4 - other causes (ข้อ 4)
        const q4Value = document.querySelector(
          'input[name="q4"]:checked'
        )?.value;

        // Check other causes
        const otherCauses = [];
        if (document.querySelector('input[name="cause"][value="31"]')?.checked)
          otherCauses.push("งานเสริม");
        if (document.querySelector('input[name="cause"][value="32"]')?.checked)
          otherCauses.push("เล่นกีฬา");
        if (document.querySelector('input[name="cause"][value="33"]')?.checked)
          otherCauses.push("งานบ้าน");

        const otherCause = document.querySelector('input[name="cause_other"]');
        if (
          document.querySelector('input[name="cause_other"][value="34"]')
            ?.checked &&
          otherCause?.value
        ) {
          otherCauses.push(otherCause.value);
        }

        // Create detailed analysis
        let analysis = {
          q3Value: q3Value,
          q3Area: q3Area,
          q4Value: q4Value,
          otherCauses: otherCauses,
          isWorkRelated: q3Value === "1",
          hasOtherCauses: otherCauses.length > 0,
        };

        // Generate summary text
        let summaryText = "";

        if (q3Value === "0") {
          summaryText =
            "ไม่เคยมีอาการปวด/ชา/เมื่อยล้าจากการทำงานในรอบ 7 วันที่ผ่านมา";
        } else if (q3Value === "1") {
          summaryText = `เคยมีอาการปวด/ชา/เมื่อยล้าจากการทำงานบริเวณ: ${
            q3Area || "ไม่ระบุ"
          }`;
        }

        if (q4Value === "1") {
          summaryText += " | เชื่อว่าเกิดจากการทำงานเท่านั้น";
        } else if (q4Value === "2") {
          summaryText += " | ไม่แน่ใจว่าเกิดจากการทำงาน";
        } else if (q4Value === "3" && otherCauses.length > 0) {
          summaryText += ` | เชื่อว่าเกิดจาก: ${otherCauses.join(", ")}`;
        } else if (q4Value === "3") {
          summaryText += " | เชื่อว่าไม่ได้เกิดจากการทำงาน";
        }

        return {
          analysis: analysis,
          summaryText: summaryText,
        };
      }

      function updateIndividualScores() {
        // Section A scores - separate calculations for each group
        const seatHeightScore = calculateGroupScore("seatHeightGroup");
        const seatDepthScore = calculateGroupScore("seatDepthGroup");
        const armrestScore = calculateGroupScore("armrestGroup");
        const backrestScore = calculateGroupScore("backrestGroup");

        // Update individual score displays
        document.getElementById("seatHeightScore").textContent =
          seatHeightScore;
        document.getElementById("seatDepthScore").textContent = seatDepthScore;
        document.getElementById("armrestScore").textContent = armrestScore;
        document.getElementById("backrestScore").textContent = backrestScore;

        const totalA =
          seatHeightScore + seatDepthScore + armrestScore + backrestScore;
        document.getElementById(
          "totalScoreA"
        ).textContent = `คะแนนรวม Section A: ${totalA}`;

        // Section B scores
        const monitorScore = calculateGroupScore("monitorGroup");
        const phoneScore = calculateGroupScore("phoneGroup");

        document.getElementById("monitorScore").textContent = monitorScore;
        document.getElementById("phoneScore").textContent = phoneScore;

        const totalB = monitorScore + phoneScore;
        document.getElementById(
          "totalScoreB"
        ).textContent = `คะแนนรวม Section B: ${totalB}`;

        // Section C scores
        const mouseScore = calculateGroupScore("mouseGroup");
        const keyboardScore = calculateGroupScore("keyboardGroup");

        document.getElementById("mouseScore").textContent = mouseScore;
        document.getElementById("keyboardScore").textContent = keyboardScore;

        const totalC = mouseScore + keyboardScore;
        document.getElementById(
          "totalScoreC"
        ).textContent = `คะแนนรวม Section C: ${totalC}`;
      }

      // Function to calculate score for a specific group
      function calculateGroupScore(groupId) {
        const group = document.getElementById(groupId);
        if (!group) return 0;

        const checkedBoxes = group.querySelectorAll(
          'input[type="checkbox"]:checked'
        );
        let score = 0;

        checkedBoxes.forEach((checkbox) => {
          score += parseInt(checkbox.dataset.score) || 0;
        });

        return score;
      }

      // Helper function to check if all fields are filled
      function checkAllFieldsFilled() {
        const age = document.getElementById("age").value.trim();
        const gender = document.getElementById("gender").value;
        const jobDuration = document.getElementById("jobDuration").value.trim();
        const department = document.getElementById("department").value.trim();
        const affiliation = document.getElementById("affiliation").value.trim();

        return age && gender && jobDuration && department && affiliation;
      }

      // เพิ่มฟังก์ชันบันทึกรูปภาพสำหรับแต่ละรายการ
      async function saveAssessmentImage(index) {
        const item = assessmentData[index];
        if (!item) return;

        try {
          // โหลด html2canvas ถ้ายังไม่ได้โหลด
          if (typeof html2canvas === "undefined") {
            await loadHtml2Canvas();
          }

          // สร้างหน้าต่างใหม่สำหรับแสดงข้อมูลที่จะบันทึก
          const printWindow = window.open(
            "",
            "_blank",
            "width=1000,height=800"
          );

          const printContent = `
          <!DOCTYPE html>
          <html lang="th">
          <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>ผลการประเมิน ROSA - อายุ ${item.age}</title>
            <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght=400;700&display=swap" rel="stylesheet">
            <style>
              body {
                font-family: 'Sarabun', sans-serif;
                margin: 20px;
                padding: 20px;
                background-color: #ffffff;
                line-height: 1.6;
                color: #333;
              }
              .header {
                text-align: center;
                margin-bottom: 30px;
                border-bottom: 3px solid #007bff;
                padding-bottom: 20px;
              }
              .header h1 {
                color: #007bff;
                margin: 0;
                font-size: 2.2rem;
              }
              .info-section {
                background: #f8f9fa;
                padding: 20px;
                border-radius: 10px;
                margin-bottom: 20px;
                border-left: 5px solid #007bff;
              }
              .info-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 15px;
              }
              .info-item {
                background: white;
                padding: 12px;
                border-radius: 8px;
                border-left: 3px solid #007bff;
              }
              .info-label {
                font-weight: bold;
                color: #333;
                display: block;
                margin-bottom: 5px;
              }
              .info-value {
                color: #666;
                font-size: 1.1rem;
              }
              .score-section {
                background: ${item.finalScore >= 5 ? "#ffebee" : "#e8f5e8"};
                border-left: 5px solid ${
                  item.finalScore >= 5 ? "#c62828" : "#00a878"
                };
                padding: 20px;
                border-radius: 10px;
                margin: 20px 0;
                text-align: center;
              }
              .score-number {
                font-size: 4rem;
                font-weight: bold;
                color: ${item.finalScore >= 5 ? "#c62828" : "#00a878"};
                margin: 0;
              }
              .risk-level {
                font-size: 1.5rem;
                font-weight: bold;
                color: ${item.finalScore >= 5 ? "#c62828" : "#00a878"};
                margin: 10px 0;
              }
              .breakdown-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 15px;
                margin: 20px 0;
              }
              .breakdown-item {
                background: white;
                padding: 15px;
                border-radius: 8px;
                text-align: center;
                border: 2px solid #e0e0e0;
              }
              .breakdown-label {
                font-weight: bold;
                color: #333;
                margin-bottom: 8px;
              }
              .breakdown-score {
                font-size: 2rem;
                font-weight: bold;
                color: #007bff;
              }
              .pain-section {
                background: #fff8f5;
                border-left: 5px solid #ff6b35;
                padding: 20px;
                border-radius: 10px;
                margin: 20px 0;
              }
              .pain-score {
                font-size: 3rem;
                font-weight: bold;
                color: #ff6b35;
                text-align: center;
                margin: 15px 0;
              }
              .footer {
                text-align: center;
                margin-top: 30px;
                padding-top: 20px;
                border-top: 2px solid #e0e0e0;
                color: #666;
                font-size: 0.9rem;
              }
            </style>
          </head>
          <body>
            <div class="header">
              <h1>ผลการประเมิน ROSA</h1>
              <p>ระบบประเมินความเสี่ยงทางการยศาสตร์</p>
            </div>
            
            <div class="info-section">
              <h2 style="color: #007bff; margin-top: 0;">ข้อมูลส่วนบุคคล</h2>
              <div class="info-grid">
                <div class="info-item">
                  <span class="info-label">อายุ:</span>
                  <span class="info-value">${item.age} ปี</span>
                </div>
                <div class="info-item">
                  <span class="info-label">เพศ:</span>
                  <span class="info-value">${
                    item.gender === "male"
                      ? "ชาย"
                      : item.gender === "female"
                      ? "หญิง"
                      : "อื่นๆ"
                  }</span>
                </div>
                <div class="info-item">
                  <span class="info-label">อายุงาน:</span>
                  <span class="info-value">${item.jobDuration}</span>
                </div>
                <div class="info-item">
                  <span class="info-label">แผนก:</span>
                  <span class="info-value">${item.department || "-"}</span>
                </div>
                <div class="info-item">
                  <span class="info-label">สังกัด:</span>
                  <span class="info-value">${item.affiliation}</span>
                </div>
                <div class="info-item">
                  <span class="info-label">วันที่ประเมิน:</span>
                  <span class="info-value">${item.date}</span>
                </div>
                <div class="info-item">
                  <span class="info-label">เวลาที่ประเมิน:</span>
                  <span class="info-value">${item.time}</span>
                </div>
                <div class="info-item">
                  <span class="info-label">เวลาที่ใช้ในการประเมิน:</span>
                  <span class="info-value">${item.assessmentTime || "-"}</span>
                </div>
              </div>
            </div>
            
            <div class="score-section">
              <h2 style="margin-top: 0; color: ${
                item.finalScore >= 5 ? "#c62828" : "#00a878"
              };">ผลการประเมิน ROSA</h2>
              <div class="score-number">${item.finalScore}</div>
              <div class="risk-level">ระดับความเสี่ยง: ${
                item.finalScore >= 5 ? "สูง" : "ต่ำ"
              }</div>
              
              <div class="breakdown-grid">
                <div class="breakdown-item">
                  <div class="breakdown-label">Section A<br>(เก้าอี้)</div>
                  <div class="breakdown-score">${item.sectionA}</div>
                </div>
                <div class="breakdown-item">
                  <div class="breakdown-label">Section B<br>(หน้าจอและโทรศัพท์)</div>
                  <div class="breakdown-score">${item.sectionB}</div>
                </div>
                <div class="breakdown-item">
                  <div class="breakdown-label">Section C<br>(เมาส์และแป้นพิมพ์)</div>
                  <div class="breakdown-score">${item.sectionC}</div>
                </div>
                <div class="breakdown-item">
                  <div class="breakdown-label">ระยะเวลา<br>การทำงาน</div>
                  <div class="breakdown-score">${item.duration}</div>
                </div>
              </div>
            </div>
            
            <div class="pain-section">
              <h2 style="color: #ff6b35; margin-top: 0;">ผลการประเมินอาการปวด/ชา/เมื่อยล้า</h2>
              <div class="pain-score">${item.painAssessmentScore || "0"}</div>
              <div style="text-align: center;">
                <strong>ระดับความเสี่ยง: ${item.painRiskLevel || "ต่ำ"}</strong>
              </div>
            </div>
            
            <div class="footer">
              <p>สร้างโดยระบบประเมิน ROSA | วันที่สร้างรายงาน: ${new Date().toLocaleDateString(
                "th-TH"
              )}</p>
            </div>
          </body>
          </html>
        `;

          printWindow.document.write(printContent);
          printWindow.document.close();

          // รอให้หน้าโหลดเสร็จ
          await new Promise((resolve) => {
            printWindow.onload = resolve;
            setTimeout(resolve, 1000); // fallback timeout
          });

          // บันทึกเป็นรูปภาพ
          const canvas = await html2canvas(printWindow.document.body, {
            allowTaint: false,
            useCORS: true,
            scale: 1,
            backgroundColor: "#ffffff",
            logging: false,
          });

          // สร้างลิงค์ดาวน์โหลด
          const link = document.createElement("a");
          link.download = `ROSA-Assessment-${item.age}-${item.date.replace(
            /\//g,
            "-"
          )}.png`;
          link.href = canvas.toDataURL("image/png");
          link.click();

          // ปิดหน้าต่าง
          printWindow.close();

          alert("✅ บันทึกรูปภาพเรียบร้อยแล้ว!");
        } catch (error) {
          console.error("เกิดข้อผิดพลาดในการบันทึกรูปภาพ:", error);
          alert("❌ เกิดข้อผิดพลาดในการบันทึกรูปภาพ กรุณาลองใหม่อีกครั้ง");
        }
      }

      // เพิ่มฟังก์ชันบันทึกรูปภาพสำหรับ Modal
      async function saveModalAsImage() {
        try {
          // โหลด html2canvas ถ้ายังไม่ได้โหลด
          if (typeof html2canvas === "undefined") {
            await loadHtml2Canvas();
          }

          const modal = document.getElementById("assessmentModal");
          const modalContent = modal.querySelector(".modal-content");

          if (!modalContent) {
            throw new Error("ไม่พบเนื้อหา Modal");
          }

          // บันทึกเป็นรูปภาพ
          const canvas = await html2canvas(modalContent, {
            allowTaint: false,
            useCORS: true,
            scale: 1,
            backgroundColor: "#ffffff",
            logging: false,
          });

          // สร้างลิงค์ดาวน์โหลด
          const link = document.createElement("a");
          link.download = `ROSA-Assessment-Details-${new Date()
            .toISOString()
            .slice(0, 10)}.png`;
          link.href = canvas.toDataURL("image/png");
          link.click();

          alert("✅ บันทึกรูปภาพรายละเอียดเรียบร้อยแล้ว!");
        } catch (error) {
          console.error("เกิดข้อผิดพลาดในการบันทึกรูปภาพ Modal:", error);
          alert("❌ เกิดข้อผิดพลาดในการบันทึกรูปภาพ กรุณาลองใหม่อีกครั้ง");
        }
      }

      // เพิ่มฟังก์ชันโหลด html2canvas
      function loadHtml2Canvas() {
        return new Promise((resolve, reject) => {
          if (typeof html2canvas !== "undefined") {
            resolve();
            return;
          }

          const script = document.createElement("script");
          script.src =
            "https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js";
          script.onload = () => resolve();
          script.onerror = () =>
            reject(new Error("Failed to load html2canvas"));
          document.head.appendChild(script);
        });
      }

      // Export to CSV
      function exportToCSV() {
        if (assessmentData.length === 0) {
          alert("ไม่มีข้อมูลสำหรับส่งออก");
          return;
        }

        const headers = [
          "วันที่",
          "เวลา",
          "อายุ",
          "เพศ",
          "อายุงาน",
          "แผนก",
          "สังกัด",
          "คะแนน Section A",
          "คะแนน Section B",
          "คะแนน Section C",
          "ระยะเวลาการทำงาน",
          "คะแนนรวม ROSA",
          "ระดับความเสี่ยง ROSA",
          "คะแนนอาการปวดรวม",
          "ระดับความเสี่ยงอาการปวด",
          "อวัยวะที่มีความเสี่ยงสูงสุด",
          "คอ",
          "ไหล่",
          "หลังส่วนบน",
          "หลังส่วนล่าง",
          "แขน",
          "มือ/ข้อมือ",
          "สะโพก",
          "เข่า",
          "น่อง",
          "เท้า",
          "เวลาที่ใช้ในการประเมิน",
        ];

        const csvContent = [
          headers.join(","),
          ...assessmentData.map((item) => {
            // ดึงคะแนนอาการปวดแต่ละส่วน
            const bodyPartScores = {
              neck: 0,
              shoulder: 0,
              upperback: 0,
              lowerback: 0,
              arm: 0,
              hand: 0,
              hip: 0,
              knee: 0,
              calf: 0,
              foot: 0,
            };

            if (
              item.painAssessmentDetails &&
              Array.isArray(item.painAssessmentDetails)
            ) {
              item.painAssessmentDetails.forEach((part) => {
                if (part.part && bodyPartScores.hasOwnProperty(part.part)) {
                  bodyPartScores[part.part] = part.risk || 0;
                }
              });
            }

            return [
              item.date,
              item.time,
              item.age,
              item.gender === "male"
                ? "ชาย"
                : item.gender === "female"
                ? "หญิง"
                : "อื่นๆ",
              `"${item.jobDuration}"`,
              `"${item.department || ""}"`,
              `"${item.affiliation}"`,
              item.sectionA,
              item.sectionB,
              item.sectionC,
              item.duration,
              item.finalScore,
              item.finalScore >= 5 ? "สูง" : "ต่ำ",
              item.painAssessmentScore || "0",
              item.painRiskLevel || "ไม่มีความเสี่ยง",
              `"${item.topRiskBodyParts || "-"}"`,
              bodyPartScores.neck,
              bodyPartScores.shoulder,
              bodyPartScores.upperback,
              bodyPartScores.lowerback,
              bodyPartScores.arm,
              bodyPartScores.hand,
              bodyPartScores.hip,
              bodyPartScores.knee,
              bodyPartScores.calf,
              bodyPartScores.foot,
              item.assessmentTime || "00:00:00",
            ].join(",");
          }),
        ].join("\n");

        const blob = new Blob(["\ufeff" + csvContent], {
          type: "text/csv;charset=utf-8;",
        });
        const link = document.createElement("a");
        const url = URL.createObjectURL(blob);
        link.setAttribute("href", url);
        link.setAttribute(
          "download",
          `ROSA_Assessment_Data_${new Date().toISOString().split("T")[0]}.csv`
        );
        link.style.visibility = "hidden";
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

        showSuccessMessage("ส่งออกข้อมูลเป็น CSV เรียบร้อยแล้ว");
      }

      // Clear all data
      async function clearAllData() {
        if (
          confirm(
            "คุณแน่ใจหรือไม่ที่จะลบข้อมูลทั้งหมด? การดำเนินการนี้ไม่สามารถยกเลิกได้"
          )
        ) {
          // ลบข้อมูลจาก backend (จำลองด้วย localStorage)
          const success = await deleteAllAssessmentData();

          if (success) {
            assessmentData = [];
            filteredData = [...assessmentData];
            updateDataManagementPage();
            showSuccessMessage("ลบข้อมูลทั้งหมดเรียบร้อยแล้ว");
          }
        }
      }

      // Reset form
      function resetForm() {
        document.getElementById("personalInfoForm").reset();
        document.getElementById("sectionAScore").value = 1;
        document.getElementById("sectionBScore").value = 1;
        document.getElementById("sectionCScore").value = 1;
        document.getElementById("workDuration").value = 1;

        document.getElementById("personalInfoContent").style.display = "block";
        document.getElementById("assessmentContent").style.display = "none";
        document.getElementById("resultsContent").style.display = "none";
      }

      // Show full assessment results in a new page/window
      // Show assessment details in modal
      function showAssessmentDetails(index) {
        const item = assessmentData[index];
        if (!item) {
          alert("ไม่พบข้อมูลการประเมิน");
          return;
        }

        const modal = document.getElementById("assessmentModal");
        const modalBody = document.getElementById("modalBody");

        // สร้างตารางแสดงรายละเอียดอาการปวดแต่ละส่วน
        let painDetailsTable = "<p>ไม่มีข้อมูลอาการปวด</p>";

        if (
          item.painAssessmentDetails &&
          Array.isArray(item.painAssessmentDetails) &&
          item.painAssessmentDetails.length > 0
        ) {
          painDetailsTable = `
          <table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
            <thead>
              <tr style="background-color: #f89c7a; color: #000;">
                <th style="padding: 12px; text-align: center; border: 1px solid #ddd;">ส่วนของร่างกาย</th>
                <th style="padding: 12px; text-align: center; border: 1px solid #ddd;">ระดับความรุนแรง</th>
                <th style="padding: 12px; text-align: center; border: 1px solid #ddd;">คะแนนความรุนแรง</th>
                <th style="padding: 12px; text-align: center; border: 1px solid #ddd;">ระดับความถี่</th>
                <th style="padding: 12px; text-align: center; border: 1px solid #ddd;">คะแนนความถี่</th>
                <th style="padding: 12px; text-align: center; border: 1px solid #ddd;">คะแนนความเสี่ยง</th>
              </tr>
            </thead>
            <tbody>
        `;

          item.painAssessmentDetails.forEach((part) => {
            // กำหนดสีพื้นหลังตามคะแนนความเสี่ยง (3 ระดับ)
            let bgColor = "#ffffff";
            if (part.risk >= 10) {
              bgColor = "#ff0000"; // สีแดง - สูง
            } else if (part.risk >= 5) {
              bgColor = "#ffa500"; // สีส้ม - ปานกลาง
            } else if (part.risk >= 1) {
              bgColor = "#ffff99"; // สีเหลืองอ่อน - ต่ำ
            }

            painDetailsTable += `
            <tr>
              <td style="padding: 10px; text-align: center; border: 1px solid #ddd; font-weight: bold;">${
                part.partName
              }</td>
              <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">${
                part.severityName || "-"
              }</td>
              <td style="padding: 10px; text-align: center; border: 1px solid #ddd; color: #ff6b35; font-weight: bold;">${
                part.severity || "-"
              }</td>
              <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">${
                part.frequencyName || "-"
              }</td>
              <td style="padding: 10px; text-align: center; border: 1px solid #ddd; color: #ff6b35; font-weight: bold;">${
                part.frequency || "-"
              }</td>
              <td style="padding: 10px; text-align: center; border: 1px solid #ddd; background-color: ${bgColor}; color: #000000; font-weight: bold;">${
              part.risk
            }</td>
            </tr>
          `;
          });

          painDetailsTable += `
            </tbody>
          </table>
        `;
        }

        const content = `
        <div style="font-family: 'Sarabun', sans-serif;">
          <h3 style="color: #007bff; border-bottom: 2px solid #007bff; padding-bottom: 10px;">ข้อมูลส่วนบุคคล</h3>
          <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px;">
            <div><strong>วันที่ประเมิน:</strong> ${item.date}</div>
            <div><strong>เวลาที่ประเมิน:</strong> ${item.time}</div>
            <div><strong>อายุ:</strong> ${item.age} ปี</div>
            <div><strong>เพศ:</strong> ${
              item.gender === "male"
                ? "ชาย"
                : item.gender === "female"
                ? "หญิง"
                : "อื่นๆ"
            }</div>
            <div><strong>อายุงาน:</strong> ${item.jobDuration}</div>
            <div><strong>แผนก:</strong> ${item.department || "-"}</div>
            <div><strong>สังกัด:</strong> ${item.affiliation}</div>
            <div><strong>เวลาที่ใช้ในการประเมิน:</strong> ${
              item.assessmentTime || "ไม่ระบุ"
            }</div>
          </div>
          
          <h3 style="color: #007bff; border-bottom: 2px solid #007bff; padding-bottom: 10px; margin-top: 30px;">ผลการประเมิน ROSA</h3>
          <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px;">
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center;">
              <div style="font-size: 0.9rem; color: #666; margin-bottom: 5px;">Section A (เก้าอี้)</div>
              <div style="font-size: 2rem; font-weight: bold; color: #007bff;">${
                item.sectionA
              }</div>
            </div>
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center;">
              <div style="font-size: 0.9rem; color: #666; margin-bottom: 5px;">Section B (หน้าจอและโทรศัพท์)</div>
              <div style="font-size: 2rem; font-weight: bold; color: #007bff;">${
                item.sectionB
              }</div>
            </div>
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center;">
              <div style="font-size: 0.9rem; color: #666; margin-bottom: 5px;">Section C (เมาส์และแป้นพิมพ์)</div>
              <div style="font-size: 2rem; font-weight: bold; color: #007bff;">${
                item.sectionC
              }</div>
            </div>
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center;">
              <div style="font-size: 0.9rem; color: #666; margin-bottom: 5px;">ระยะเวลาการทำงาน</div>
              <div style="font-size: 2rem; font-weight: bold; color: #007bff;">${
                item.duration
              }</div>
            </div>
          </div>
          
          <div style="background: ${
            item.finalScore >= 5 ? "#ffebee" : "#e8f5e8"
          }; padding: 20px; border-radius: 10px; border-left: 5px solid ${
          item.finalScore >= 5 ? "#c62828" : "#00a878"
        }; text-align: center; margin: 20px 0;">
            <div style="font-size: 1.2rem; color: #666; margin-bottom: 10px;">คะแนน ROSA รวม</div>
            <div style="font-size: 4rem; font-weight: bold; color: ${
              item.finalScore >= 5 ? "#c62828" : "#00a878"
            };">${item.finalScore}</div>
            <div style="font-size: 1.5rem; font-weight: bold; color: ${
              item.finalScore >= 5 ? "#c62828" : "#00a878"
            }; margin-top: 10px;">
              ระดับความเสี่ยง: ${item.finalScore >= 5 ? "สูง" : "ต่ำ"}
            </div>
          </div>
          
          <h3 style="color: #ff6b35; border-bottom: 2px solid #ff6b35; padding-bottom: 10px; margin-top: 30px;">ผลการประเมินอาการปวด/ชา/เมื่อยล้า</h3>
          
          <div style="background: #fff2ee; padding: 20px; border-radius: 10px; border-left: 5px solid #ff6b35; margin-bottom: 20px;">
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
              <div style="text-align: center;">
                <div style="font-size: 1rem; color: #666; margin-bottom: 5px;">ระดับความเสี่ยง</div>
                <div style="font-size: 2rem; font-weight: bold; color: #ff6b35;">${
                  item.painRiskLevel || "ไม่มีข้อมูล"
                }</div>
              </div>
              <div style="text-align: center;">
                <div style="font-size: 1rem; color: #666; margin-bottom: 5px;">คะแนนรวม</div>
                <div style="font-size: 2rem; font-weight: bold; color: #ff6b35;">${
                  item.painAssessmentScore || "0"
                }</div>
              </div>
            </div>
            ${
              item.topRiskBodyParts && item.topRiskBodyParts !== "-"
                ? `
              <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #ffd4c4;">
                <div style="font-size: 1rem; color: #666; margin-bottom: 5px;">อวัยวะที่มีความเสี่ยงสูงสุด 3 อันดับแรก:</div>
                <div style="font-size: 1.2rem; font-weight: bold; color: #ff6b35;">${item.topRiskBodyParts}</div>
              </div>
            `
                : ""
            }
          </div>
          
          <h4 style="color: #ff6b35; margin-top: 20px;">รายละเอียดอาการปวดแต่ละส่วน</h4>
          ${painDetailsTable}
          
          ${
            item.painCauseAnalysis
              ? `
            <div style="background: #fff8f5; padding: 15px; border-radius: 8px; margin-top: 20px; border-left: 4px solid #ff6b35;">
              <h4 style="color: #ff6b35; margin-top: 0;">การวิเคราะห์สาเหตุ</h4>
              <p style="margin: 0; color: #333;">${item.painCauseAnalysis}</p>
            </div>
          `
              : ""
          }
          
          <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-top: 30px; border-left: 5px solid #007bff;">
            <h4 style="color: #007bff; margin-top: 0;">สรุปผลการประเมิน</h4>
            <p style="margin: 10px 0; line-height: 1.8;">
              <strong>คะแนน ROSA:</strong> ${item.finalScore} (${
          item.finalScore >= 5 ? "ความเสี่ยงสูง" : "ความเสี่ยงต่ำ"
        })<br>
              <strong>คะแนนอาการปวด:</strong> ${
                item.painAssessmentScore || "0"
              } (${item.painRiskLevel || "ต่ำ"})<br>
              <strong>คำแนะนำ:</strong> ${
                item.finalScore >= 5 ||
                (item.painAssessmentScore &&
                  parseInt(item.painAssessmentScore) >= 10)
                  ? "ควรปรับปรุงท่าทางการทำงานและปรึกษาผู้เชี่ยวชาญหากมีอาการรุนแรง"
                  : "ยังคงรักษาท่าทางการทำงานที่ดีและทำการประเมินซ้ำเป็นประจำ"
              }
            </p>
          </div>
        </div>
      `;

        modalBody.innerHTML = content;
        modal.style.display = "block";
      }
      function showFullAssessmentResults(index) {
        const item = assessmentData[index];
        if (!item) return;

        // Create a new window/tab with full assessment results
        const newWindow = window.open(
          "",
          "_blank",
          "width=1000,height=800,scrollbars=yes"
        );

        const fullResultsHTML = `
        <!DOCTYPE html>
        <html lang="th">
        <head>
          <meta charset="UTF-8">
          <meta name="viewport" content="width=device-width, initial-scale=1.0">
          <title>ผลการประเมิน ROSA - อายุ ${item.age}</title>
          <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght=400;700&display=swap" rel="stylesheet">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
          <style>
            body {
              font-family: 'Sarabun', sans-serif;
              margin: 0;
              padding: 20px;
              background-color: #f8f9fa;
              line-height: 1.6;
            }
            .container {
              max-width: 900px;
              margin: 0 auto;
              background: white;
              padding: 30px;
              border-radius: 15px;
              box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            }
            .header {
              text-align: center;
              margin-bottom: 30px;
              border-bottom: 3px solid #007bff;
              padding-bottom: 20px;
            }
            .header h1 {
              color: #007bff;
              margin: 0;
              font-size: 2.2rem;
            }
            .header p {
              color: #666;
              margin: 10px 0 0 0;
              font-size: 1.1rem;
            }
            .section {
              margin-bottom: 30px;
              padding: 20px;
              border-radius: 10px;
              border-left: 5px solid #007bff;
            }
            .section h2 {
              color: #007bff;
              margin-top: 0;
              font-size: 1.5rem;
            }
            .info-grid {
              display: grid;
              grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
              gap: 15px;
              margin-bottom: 20px;
            }
            .info-item {
              background: #f8f9fa;
              padding: 12px;
              border-radius: 8px;
              border-left: 3px solid #007bff;
            }
            .info-label {
              font-weight: bold;
              color: #333;
              display: block;
              margin-bottom: 5px;
            }
            .info-value {
              color: #666;
              font-size: 1.1rem;
            }
            .score-section {
              background: ${item.finalScore >= 5 ? "#ffebee" : "#e8f5e8"};
              border-left-color: ${
                item.finalScore >= 5 ? "#c62828" : "#00a878"
              };
            }
            .score-display {
              text-align: center;
              margin: 20px 0;
            }
            .score-number {
              font-size: 4rem;
              font-weight: bold;
              color: ${item.finalScore >= 5 ? "#c62828" : "#00a878"};
              margin: 0;
            }
            .risk-level {
              font-size: 1.5rem;
              font-weight: bold;
              color: ${item.finalScore >= 5 ? "#c62828" : "#00a878"};
              margin: 10px 0;
            }
            .breakdown-grid {
              display: grid;
              grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
              gap: 15px;
              margin: 20px 0;
            }
            .breakdown-item {
              background: white;
              padding: 15px;
              border-radius: 8px;
              text-align: center;
              border: 2px solid #e0e0e0;
            }
            .breakdown-label {
              font-weight: bold;
              color: #333;
              margin-bottom: 8px;
            }
            .breakdown-score {
              font-size: 2rem;
              font-weight: bold;
              color: #007bff;
            }
            .pain-section {
              background: #fff8f5;
              border-left-color: #ff6b35;
            }
            .pain-score {
              font-size: 3rem;
              font-weight: bold;
              color: #ff6b35;
              text-align: center;
              margin: 15px 0;
            }
            .recommendations {
              background: ${item.finalScore >= 5 ? "#ffebee" : "#e8f5e8"};
              padding: 20px;
              border-radius: 10px;
              border-left: 5px solid ${
                item.finalScore >= 5 ? "#c62828" : "#00a878"
              };
            }
            .recommendations h3 {
              color: ${item.finalScore >= 5 ? "#c62828" : "#00a878"};
              margin-top: 0;
            }
            .recommendations ul {
              padding-left: 20px;
            }
            .recommendations li {
              margin-bottom: 10px;
            }
            .print-btn {
              background: #007bff;
              color: white;
              padding: 12px 24px;
              border: none;
              border-radius: 8px;
              font-size: 1.1rem;
              cursor: pointer;
              margin: 20px 0;
              display: block;
              margin-left: auto;
              margin-right: auto;
            }
            .print-btn:hover {
              background: #0056b3;
            }
            .pain-details {
              background: white;
              padding: 15px;
              border-radius: 8px;
              margin-top: 15px;
            }
            .pain-details h4 {
              color: #ff6b35;
              margin-top: 0;
            }
            .cause-analysis {
              background: white;
              padding: 15px;
              border-radius: 8px;
              margin-top: 15px;
            }
            .cause-analysis h4 {
              color: #ff6b35;
              margin-top: 0;
            }
            @media print {
              body { background: white; }
              .print-btn { display: none; }
              .container { box-shadow: none; }
            }
          </style>
        </head>
        <body>
          <div class="container">
            <div class="header">
              <h1>ผลการประเมิน ROSA</h1>
              <p>ระบบประเมินความเสี่ยงทางการยศาสตร์</p>
            </div>
            
            <div class="section">
              <h2>ข้อมูลส่วนบุคคล</h2>
              <div class="info-grid">
                <div class="info-item">
                  <span class="info-label">อายุ:</span>
                  <span class="info-value">${item.age} ปี</span>
                </div>
                <div class="info-item">
                  <span class="info-label">เพศ:</span>
                  <span class="info-value">${
                    item.gender === "male"
                      ? "ชาย"
                      : item.gender === "female"
                      ? "หญิง"
                      : "อื่นๆ"
                  }</span>
                </div>
                <div class="info-item">
                  <span class="info-label">อายุงาน:</span>
                  <span class="info-value">${item.jobDuration}</span>
                </div>
                <div class="info-item">
                  <span class="info-label">แผนก:</span>
                  <span class="info-value">${item.department || "-"}</span>
                </div>
                <div class="info-item">
                  <span class="info-label">สังกัด:</span>
                  <span class="info-value">${item.affiliation}</span>
                </div>
                <div class="info-item">
                  <span class="info-label">วันที่ประเมิน:</span>
                  <span class="info-value">${item.date}</span>
                </div>
                <div class="info-item">
                  <span class="info-label">เวลาที่ประเมิน:</span>
                  <span class="info-value">${item.time}</span>
                </div>
                <div class="info-item">
                  <span class="info-label">เวลาที่ใช้ในการประเมิน:</span>
                  <span class="info-value">${
                    item.assessmentTime || "ไม่ระบุ"
                  }</span>
                </div>
              </div>
            </div>
            
            <div class="section score-section">
              <h2>ผลการประเมิน ROSA</h2>
              <div class="score-display">
                <div class="score-number">${item.finalScore}</div>
                <div class="risk-level">ระดับความเสี่ยง: ${
                  item.finalScore >= 5 ? "สูง" : "ต่ำ"
                }</div>
              </div>
              
              <div class="breakdown-grid">
                <div class="breakdown-item">
                  <div class="breakdown-label">Section A<br>(เก้าอี้)</div>
                  <div class="breakdown-score">${item.sectionA}</div>
                </div>
                <div class="breakdown-item">
                  <div class="breakdown-label">Section B<br>(หน้าจอและโทรศัพท์)</div>
                  <div class="breakdown-score">${item.sectionB}</div>
                </div>
                <div class="breakdown-item">
                  <div class="breakdown-label">Section C<br>(เมาส์และแป้นพิมพ์)</div>
                  <div class="breakdown-score">${item.sectionC}</div>
                </div>
                <div class="breakdown-item">
                  <div class="breakdown-label">ระยะเวลา<br>การทำงาน</div>
                  <div class="breakdown-score">${item.duration}</div>
                </div>
              </div>
            </div>
            
            
          </div>
        </div>
        
        ${
          item.finalScore >= 5
            ? `
        <div class="risk-warning high-risk">
          <h3>ผลการประเมิน ROSA: ระดับความเสี่ยงสูง</h3>
          <div class="assessment-result-warning">
            "ท่าทางการทำงานของคุณจำเป็นต้องมีการปรับปรุงเพื่อป้องกันความเสี่ยงจากปัญหาสุขภาพในอนาคต"
          </div>
          
          <div class="ergonomic-section" style="margin-top: 20px;">
            <h4 style="color: #c62828; margin-bottom: 15px;">คำแนะนำการปรับปรุงเร่งด่วน:</h4>
            <div class="recommendations" style="background: #ffebee; border-left: 4px solid #c62828; padding: 15px;">
              <ul style="margin: 0; padding-left: 20px;">
                <li><strong>การปรับความสูงของเก้าอี้และโต๊ะทำงาน:</strong> ปรับให้สะโพกอยู่สูงกว่าหัวเข่า 1-2 นิ้ว และข้อมืออยู่ในมุม 90 องศา</li>
                <li><strong>การตั้งหน้าจอคอมพิวเตอร์:</strong> ตั้งหน้าจอในระดับสายตา ห่างจากตา 50-75 ซม.</li>
                <li><strong>การใช้เครื่องมือเสริม:</strong> ใช้ที่รองข้อมือและวางเมาส์ให้อยู่ใกล้แป้นพิมพ์</li>
                <li><strong>การพักจากการนั่ง:</strong> ลุกจากเก้าอี้ทุก 30 นาที เพื่อยืดเหยียดและเดิน</li>
              </ul>
            </div>
          </div>
        `
            : `
        <div class="risk-warning">
          <h3>ผลการประเมิน ROSA: ระดับความเสี่ยงต่ำ</h3>
          <div class="assessment-result-warning">
            "ท่าทางการทำงานของคุณอยู่ในเกณฑ์ที่ดี แต่ยังควรปฏิบัติตามคำแนะนำเพื่อป้องกันปัญหาในอนาคต"
          </div>
          
          <div class="ergonomic-section" style="margin-top: 20px;">
            <h4 style="color: #00a878; margin-bottom: 15px;">คำแนะนำการป้องกัน:</h4>
            <div class="recommendations" style="background: #e8f5e8; border-left: 4px solid #00a878; padding: 15px;">
              <ul style="margin: 0; padding-left: 20px;">
                <li>ยังคงรักษาท่าทางการทำงานที่ดีอย่างต่อเนื่อง</li>
                <li>พักจากการนั่งทุก 1 ชั่วโมง เพื่อยืดเหยียดและเดิน</li>
                <li>ใช้เทคนิค 20-20-20 เพื่อป้องกันอาการตาล้า</li>
                <li>ตรวจสอบและปรับปรุงสภาพแวดล้อมการทำงานเป็นประจำ</li>
              </ul>
            </div>
          </div>
        `
        }
        </div>
        
        <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #007bff;">
          <h4 style="color: #007bff; margin: 0 0 10px 0;">สรุปผลการประเมิน</h4>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 10px;">
            <div>
              <strong>คะแนน ROSA:</strong> ${item.finalScore} (${
          item.finalScore >= 5 ? "ความเสี่ยงสูง" : "ความเสี่ยงต่ำ"
        })
            </div>
            <div>
              <strong>คะแนนอาการปวด:</strong> ${
                item.painAssessmentScore || "0"
              } (${item.painRiskLevel || "ต่ำ"})
            </div>
          </div>
          <div style="margin-top: 10px; font-size: 0.9rem; color: #666;">
            <strong>คำแนะนำ:</strong> ${
              item.finalScore >= 5 ||
              (item.painAssessmentScore && item.painAssessmentScore >= 10)
                ? "ควรปรับปรุงท่าทางการทำงานและปรึกษาผู้เชี่ยวชาญหากมีอาการรุนแรง"
                : "ยังคงรักษาท่าทางการทำงานที่ดีและทำการประเมินซ้ำเป็นประจำ"
            }
          </div>
        </div>
      `;

        modalBody.innerHTML = content;
        modal.style.display = "block";
      }

      // Print assessment details
      function printAssessmentDetails() {
        window.print();
      }

      // Close modal
      function closeModal() {
        document.getElementById("assessmentModal").style.display = "none";
      }

      // Event listeners
      document.addEventListener("DOMContentLoaded", function () {
        loadStoredData();

        // Tab navigation
        document
          .getElementById("assessmentTab")
          .addEventListener("click", function () {
            showPage("assessmentPage");
            console.log("Click assessmentTab botton");
          });

        document
          .getElementById("dataManagementTab")
          .addEventListener("click", async function () {
            showPage("dataManagementPage");
            // โหลดข้อมูลใหม่ทุกครั้งที่เข้าหน้า Data Management
            await loadStoredData();
          });

        // Landing page button
        const startBtn = document.getElementById("startAssessment");
        if (startBtn) {
          startBtn.addEventListener("click", function () {
            showPage("assessmentPage");
          });
        }

        // Personal info to User Guide
        const toSectionABtn = document.getElementById("startAssessmentBtn");
        if (toSectionABtn) {
          toSectionABtn.addEventListener("click", function () {
            // Validate personal information before proceeding
            if (validatePersonalInfo()) {
              document.getElementById("personalInfoContent").style.display =
                "none";
              document.getElementById("userGuideContent").style.display =
                "block";
              updateProgressBar();
            }
          });
        }

        // User Guide to Section A
        const fromGuideToSectionABtn = document.getElementById(
          "fromGuideToSectionA"
        );
        if (fromGuideToSectionABtn) {
          fromGuideToSectionABtn.addEventListener("click", function () {
            // Start the assessment timer
            startAssessmentTimer();

            document.getElementById("userGuideContent").style.display = "none";
            document.getElementById("sectionAContent").style.display = "block";
            updateProgressBar();
          });
        }

        // Section navigation buttons
        const toSectionBBtn = document.getElementById("toSectionB");
        if (toSectionBBtn) {
          toSectionBBtn.addEventListener("click", function () {
            scores.sectionA = calculateSectionScore("sectionAContent");
            document.getElementById("sectionAContent").style.display = "none";
            document.getElementById("sectionBContent").style.display = "block";
            updateProgressBar();
          });
        }

        const toSectionCBtn = document.getElementById("toSectionC");
        if (toSectionCBtn) {
          toSectionCBtn.addEventListener("click", function () {
            scores.sectionB = calculateSectionScore("sectionBContent");
            document.getElementById("sectionBContent").style.display = "none";
            document.getElementById("sectionCContent").style.display = "block";
            updateProgressBar();
          });
        }

        const toDurationBtn = document.getElementById("toDurationSection");
        if (toDurationBtn) {
          toDurationBtn.addEventListener("click", function () {
            scores.sectionC = calculateSectionScore("sectionCContent");
            document.getElementById("sectionCContent").style.display = "none";
            document.getElementById("durationContent").style.display = "block";
            updateProgressBar();
          });
        }

        // Pain Assessment navigation
        const toPainAssessmentBtn = document.getElementById("toPainAssessment");
        if (toPainAssessmentBtn) {
          toPainAssessmentBtn.addEventListener("click", function () {
            document.getElementById("durationContent").style.display = "none";
            document.getElementById("painAssessmentContent").style.display =
              "block";
            updateProgressBar();
          });
        }

        // Back buttons
        const backToUserGuideBtn = document.getElementById(
          "backToUserGuideSection"
        );
        if (backToUserGuideBtn) {
          backToUserGuideBtn.addEventListener("click", function () {
            document.getElementById("sectionAContent").style.display = "none";
            document.getElementById("userGuideContent").style.display = "block";
            updateProgressBar();
          });
        }

        const backToABtn = document.getElementById("backToSectionA");
        if (backToABtn) {
          backToABtn.addEventListener("click", function () {
            document.getElementById("sectionBContent").style.display = "none";
            document.getElementById("sectionAContent").style.display = "block";
            updateProgressBar();
          });
        }

        const backToBBtn = document.getElementById("backToSectionB");
        if (backToBBtn) {
          backToBBtn.addEventListener("click", function () {
            document.getElementById("sectionCContent").style.display = "none";
            document.getElementById("sectionBContent").style.display = "block";
            updateProgressBar();
          });
        }

        const backToCBtn = document.getElementById("backToSectionC");
        if (backToCBtn) {
          backToCBtn.addEventListener("click", function () {
            document.getElementById("durationContent").style.display = "none";
            document.getElementById("sectionCContent").style.display = "block";
            updateProgressBar();
          });
        }

        const backToDurationBtn = document.getElementById("backToDuration");
        if (backToDurationBtn) {
          backToDurationBtn.addEventListener("click", function () {
            document.getElementById("painAssessmentContent").style.display =
              "none";
            document.getElementById("durationContent").style.display = "block";
            updateProgressBar();
          });
        }

        // Summary button
        const toSummaryBtn = document.getElementById("toSummary");
        if (toSummaryBtn) {
          toSummaryBtn.addEventListener("click", function () {
            // Calculate individual component scores from each section
            scores.sectionA = calculateSectionScore("sectionAContent");
            scores.sectionB = calculateSectionScore("sectionBContent");
            scores.sectionC = calculateSectionScore("sectionCContent");

            // Get duration score
            const selectedDuration = document.querySelector(
              "#durationGroup .option-btn.selected"
            );
            scores.duration = selectedDuration
              ? parseInt(selectedDuration.dataset.score)
              : 0;

            // For proper ROSA calculation, we need to break down the scores by components
            // This is a simplified approach - in a real implementation, you would need
            // to track individual component scores separately

            // Estimate component scores based on section totals
            // Section A components: Arm Support and Chair Height (+ Duration)
            const armSupportScore = Math.max(1, Math.ceil(scores.sectionA / 2));
            const chairHeightScore = Math.max(
              1,
              Math.floor(scores.sectionA / 2) + scores.duration
            );

            // Section B components: Phone and Screen
            const phoneScore = Math.max(1, Math.ceil(scores.sectionB / 2));
            const screenScore = Math.max(1, Math.floor(scores.sectionB / 2));

            // Section C components: Mouse and Keyboard
            const mouseScore = Math.max(1, Math.ceil(scores.sectionC / 2));
            const keyboardScore = Math.max(1, Math.floor(scores.sectionC / 2));

            // Calculate ROSA score using proper methodology
            const rosaResult = calculateROSAScore(
              armSupportScore,
              chairHeightScore,
              phoneScore,
              screenScore,
              mouseScore,
              keyboardScore
            );

            const finalROSAScore = rosaResult.finalScore;

            // Calculate and display assessment time
            const assessmentTime = calculateAssessmentTime();

            // Calculate pain assessment score
            const painAssessment = calculatePainAssessmentScore();
            const painCauseResult = analyzePainCause();

            // Update pain assessment display
            const painAssessmentScoreEl = document.getElementById(
              "painAssessmentScore"
            );
            const painRiskScoreEl = document.getElementById("painRiskScore");
            const painRiskLevelEl = document.getElementById("painRiskLevel");

            if (painAssessmentScoreEl)
              painAssessmentScoreEl.textContent = painAssessment.totalRiskScore;
            if (painRiskScoreEl)
              painRiskScoreEl.textContent = painAssessment.totalRiskScore;
            if (painRiskLevelEl)
              painRiskLevelEl.textContent = painAssessment.riskLevel;

            // Update pain assessment table
            updatePainAssessmentTable(painAssessment);

            // Display detailed calculation breakdown
            const calculationDetailsElement = document.getElementById(
              "painCalculationDetails"
            );
            if (
              calculationDetailsElement &&
              painAssessment.detailedBreakdown.length > 0
            ) {
              // Format each body part calculation on separate lines
              const formattedDetails = painAssessment.detailedBreakdown
                .map((detail) => `• ${detail}`)
                .join("\n");
              calculationDetailsElement.innerHTML = formattedDetails.replace(
                /\n/g,
                "<br>"
              );
            } else if (calculationDetailsElement) {
              calculationDetailsElement.textContent =
                "ไม่มีอาการปวด/ชา/เมื่อยล้า";
            }

            // Display cause analysis
            const painCauseAnalysisEl =
              document.getElementById("painCauseAnalysis");
            if (painCauseAnalysisEl) {
              painCauseAnalysisEl.textContent = painCauseResult.summaryText;
            }

            // Update summary page with ROSA calculation results
            const finalScoreEl = document.getElementById("finalScore");
            const summaryScoreAEl = document.getElementById("summaryScoreA");
            const summaryScoreBEl = document.getElementById("summaryScoreB");
            const summaryScoreCEl = document.getElementById("summaryScoreC");
            const summaryDurationEl =
              document.getElementById("summaryDuration");

            if (finalScoreEl) finalScoreEl.textContent = finalROSAScore;
            if (summaryScoreAEl)
              summaryScoreAEl.textContent = rosaResult.sectionA;
            if (summaryScoreBEl)
              summaryScoreBEl.textContent = rosaResult.sectionB;
            if (summaryScoreCEl)
              summaryScoreCEl.textContent = rosaResult.sectionC;
            if (summaryDurationEl)
              summaryDurationEl.textContent = scores.duration;

            // Show calculation breakdown in console for debugging
            console.log("ROSA Calculation Breakdown:", {
              "Arm Support Score": armSupportScore,
              "Chair Height Score": chairHeightScore,
              "Phone Score": phoneScore,
              "Screen Score": screenScore,
              "Mouse Score": mouseScore,
              "Keyboard Score": keyboardScore,
              "Section A (Chair)": rosaResult.sectionA,
              "Section B (Monitor/Phone)": rosaResult.sectionB,
              "Section C (Mouse/Keyboard)": rosaResult.sectionC,
              "Section D (Peripherals)": rosaResult.sectionD,
              "Final ROSA Score": rosaResult.finalScore,
              "High Risk": rosaResult.highRisk,
            });

            console.log("Pain Assessment Results:", {
              "Total Pain Score": painAssessment.totalRiskScore,
              "Risk Level": painAssessment.riskLevel,
              "Affected Parts": painAssessment.affectedParts,
            });

            // Display appropriate recommendations based on ROSA score
            displayRecommendations(finalROSAScore);

            showPage("summaryPage");
          });
        }
        // Stretching page navigation buttons
        const toStretchingBtn = document.getElementById("toStretchingPage");
        if (toStretchingBtn) {
          toStretchingBtn.addEventListener("click", function () {
            showPage("stretchingPage");
          });
        }

        const backToSummaryBtn = document.getElementById("backToSummary");
        if (backToSummaryBtn) {
          backToSummaryBtn.addEventListener("click", function () {
            showPage("summaryPage");
          });
        }

        // Restart Assessment button
        const restartAssessmentBtn =
          document.getElementById("restartAssessment");
        if (restartAssessmentBtn) {
          restartAssessmentBtn.addEventListener("click", async function () {
            // บันทึกผลการประเมิน
            await saveAssessmentResults();

            // รอสักครู่เพื่อให้การบันทึกเสร็จสิ้น
            setTimeout(async () => {
              // รีเซ็ตฟอร์มและคะแนน
              resetAssessmentForm();

              // โหลดข้อมูลใหม่
              await loadStoredData();

              // นำทางไปยังหน้า Data Management
              showPage("dataManagementPage");
            }, 1000);
          });
        }

        // ฟังก์ชันรีเซ็ตฟอร์มการประเมิน
        function resetAssessmentForm() {
          // รีเซ็ตข้อมูลส่วนบุคคล
          const personalInfoForm = document.getElementById("personalInfoForm");
          if (personalInfoForm) {
            personalInfoForm.reset();
          }

          // รีเซ็ต checkbox ทั้งหมด
          document
            .querySelectorAll('input[type="checkbox"]')
            .forEach((cb) => (cb.checked = false));

          // รีเซ็ตปุ่มที่เลือก
          document
            .querySelectorAll(".option-btn.selected")
            .forEach((btn) => btn.classList.remove("selected"));

          // รีเซ็ตคะแนน
          scores = { sectionA: 0, sectionB: 0, sectionC: 0, duration: 0 };

          // รีเซ็ต radio buttons
          document
            .querySelectorAll('input[type="radio"]')
            .forEach((radio) => (radio.checked = false));

          // รีเซ็ต text inputs ในส่วนอาการปวด
          document.querySelectorAll('input[type="text"]').forEach((input) => {
            if (input.name === "q3_area" || input.name === "cause_other") {
              input.value = "";
            }
          });

          // รีเซ็ตหน้าจอกลับไปที่ Personal Info
          document.getElementById("personalInfoContent").style.display =
            "block";
          document.getElementById("userGuideContent").style.display = "none";
          document.getElementById("sectionAContent").style.display = "none";
          document.getElementById("sectionBContent").style.display = "none";
          document.getElementById("sectionCContent").style.display = "none";
          document.getElementById("durationContent").style.display = "none";
          document.getElementById("painAssessmentContent").style.display =
            "none";

          // รีเซ็ต timer
          assessmentStartTime = null;
          assessmentEndTime = null;

          console.log("รีเซ็ตฟอร์มการประเมินเรียบร้อยแล้ว");
        }

        // Data management actions
        document
          .getElementById("exportCSV")
          .addEventListener("click", exportToCSV);
        document
          .getElementById("clearAllData")
          .addEventListener("click", clearAllData);
        document
          .getElementById("backToLanding")
          .addEventListener("click", function () {
            showPage("landingPage");
          });

        document
          .getElementById("startNewAssessment")
          .addEventListener("click", function () {
            // รีเซ็ตฟอร์มก่อนเริ่มการประเมินใหม่
            resetAssessmentForm();
            showPage("assessmentPage");
          });

        // ปุ่มรีเฟรชข้อมูล
        document
          .getElementById("refreshData")
          .addEventListener("click", async function () {
            const btn = this;
            const originalText = btn.innerHTML;
            btn.innerHTML =
              '<i class="fas fa-spinner fa-spin"></i> กำลังโหลดข้อมูล...';
            btn.disabled = true;

            try {
              await loadStoredData();
              btn.innerHTML = '<i class="fas fa-check"></i> โหลดข้อมูลสำเร็จ';
              setTimeout(() => {
                btn.innerHTML = originalText;
                btn.disabled = false;
              }, 2000);
            } catch (error) {
              btn.innerHTML =
                '<i class="fas fa-exclamation-triangle"></i> โหลดข้อมูลล้มเหลว';
              setTimeout(() => {
                btn.innerHTML = originalText;
                btn.disabled = false;
              }, 2000);
            }
          });

        // Search and filter event listeners
        document
          .getElementById("searchInput")
          .addEventListener("input", filterData);
        document
          .getElementById("riskFilter")
          .addEventListener("change", filterData);
        document
          .getElementById("dateFilter")
          .addEventListener("change", filterData);

        // Modal event listeners
        document
          .getElementById("closeModal")
          .addEventListener("click", closeModal);
        document
          .getElementById("printAssessment")
          .addEventListener("click", printAssessmentDetails);
        document
          .getElementById("saveModalImage")
          .addEventListener("click", saveModalAsImage);

        // Close modal when clicking outside of it
        window.addEventListener("click", function (event) {
          const modal = document.getElementById("assessmentModal");
          if (event.target === modal) {
            closeModal();
          }
        });

        // Personal info field validation
        const personalInfoFields = [
          "age",
          "gender",
          "jobDuration",
          "department",
          "affiliation",
        ];
        personalInfoFields.forEach((fieldId) => {
          const field = document.getElementById(fieldId);
          if (field) {
            field.addEventListener("input", removeErrorMessages);
            field.addEventListener("change", removeErrorMessages);
          }
        });

        // Checkbox change handlers
        document.addEventListener("change", function (e) {
          if (e.target.classList.contains("option-checkbox")) {
            // Update individual scores immediately when checkbox changes
            updateIndividualScores();
          }
        });

        // Duration button handlers (keep existing functionality for duration section)
        document.addEventListener("click", function (e) {
          if (e.target.classList.contains("option-btn")) {
            // Remove selected class from all buttons in the same group
            const group = e.target.closest(".option-group");
            if (group) {
              group.querySelectorAll(".option-btn").forEach((btn) => {
                btn.classList.remove("selected");
              });

              // Add selected class to clicked button
              e.target.classList.add("selected");

              // Update duration score specifically
              if (group.id === "durationGroup") {
                const score = parseInt(e.target.dataset.score) || 0;
                document.getElementById("durationScore").textContent = score;
                document.getElementById(
                  "totalScoreDuration"
                ).textContent = `คะแนนระยะเวลา: ${score}`;
              }
            }
          }
        });

        // ตรวจสอบสถานะการเชื่อมต่ออินเทอร์เน็ต
        window.addEventListener("online", function () {
          console.log("เชื่อมต่ออินเทอร์เน็ตแล้ว กำลังอัปโหลดข้อมูล...");
          syncOfflineData();
        });

        window.addEventListener("offline", function () {
          console.log("ขาดการเชื่อมต่ออินเทอร์เน็ต");
        });
      });
    </script>
  </body>
</html>
